# This exists as a substitute for a cardinal title. Ownership of this story represents a Cardinal seat.

cardinal_story = {
	on_setup = {
		add_to_global_variable_list = {
			name = cardinals
			target = this
		}
		title:k_papal_state = {
			add_to_variable_list = {
				name = cardinals
				target = prev
			}
		}
		global_var:gui_storage = {
			add_to_variable_list = {
				name = cardinals
				target = prev
			}
		}
	}
	on_owner_death = {
		save_scope_as = cardinal_story
		story_owner = {
			save_scope_as = dead_cardinal
			trigger_event = {
				on_action = on_cardinal_death
			}
		}
		promote_new_cardinal = yes
		update_preferatus = yes
	}
}

story_saint_day = {
	# by Uber & Kaepora
	
	on_setup = {
		set_variable = {
			name = saint_day_saint
			value = story_owner.var:saint_day_saint
		}
		set_variable = {
			name = saint_day_saint_tomb_location
			value = story_owner.var:saint_day_saint_tomb_location
		}
	}
	
	on_owner_death = {
		scope:story.var:saint_day_saint.faith = { #debug
			every_in_list = {
				list = faith_saint_day_holders
				limit = {
					this = scope:story_owner
				}
			remove_from_list = faith_saint_day_holders
			}
		}

		create_character = {
			location = scope:story.var:saint_day_saint_tomb_location
			gender = male
			age = { 16 50 }
			trait = education_learning_2
			trait = devoted
			faith = scope:story.var:saint_day_saint.faith
			culture = scope:story.var:saint_day_saint_tomb_location.culture #time goes on
			learning = { 10 12 }
			save_scope_as = new_saint_day_holder
		}
		
		make_story_owner = scope:new_saint_day_holder
		faith = { #debug
			add_to_variable_list = {
				name = faith_saint_day_holders
				target = scope:new_saint_day_holder
			}
		}
		#trigger notification for new_saint_day_holder.liege: A monk has arrived!
		
	}

	on_end = {
		debug_log = "[localsaint.GetName] Saint Day Forgotten!:"
		debug_log_date = yes
	}

	effect_group = {
		years = 1
		
		triggered_effect = {
			trigger = { #safety checks
				exists = scope:story.var:saint_day_saint
				exists = scope:story.var:saint_day_saint_tomb_location
			}
			effect = {
				faith:catholic = {
					every_faith_ruler = {
						limit = {
							capital_county ?= {
								squared_distance = {
									target = scope:story.var:saint_day_saint_tomb_location
									value <= squared_distance_small #150 map-pixels. Roughly one Wales away (top to bottom).
								}
							}
						}
						trigger_event = { on_action = TCT_saint_day_real }
					}
				}
			}
		}
	}
}