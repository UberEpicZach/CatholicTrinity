investiture_controversy_struggle = {
	# Use fp3_struggle.9982 for nav
	#########################################################################
	# Feature Ownership and Implementation by Hugo Cortell
	# Design by Emil Tisander, Alexander Oltner, and Hugo Cortell
	# Additional Design by Eren Humphrey, Ola Jentzsch, and Nikola Stokić
	# Reworked by Maxence Voleau & Ewan Cowhig Croft
	#########################################################################

	##################################################
	# Setup
	##################################################
	cultures = {
		cisalpine
		italian
		saxon
		swabian
		bavarian
		franconian
	}
	faiths = {
		catholic
	}
	regions = {
		custom_investiture_struggle
	}

	involvement_prerequisite_percentage = 0.5 # Easier to join the struggle due to the nature of the conflict

	on_start = { #THIS ENTIRE BLOCK IS FAKE NEWS
 		# # # Start the over-time catalysts.
		# trigger_event = neutral_struggle.0001
		# trigger_event = tct_neutral_struggle.0001
		# # Tell the AI to change sides every now and then.
		# trigger_event = {
		# 	id = tct_investiture_struggle.0001
		# 	years = { 1 5 }
		# }
		# # title:e_hre.holder = {
		# # 	send_interface_toast = {
		# # 		type = event_toast_effect_bad
		# # 		title = HRE_DEBUG_TEST_THREE
		# # 		left_icon = ROOT
		# # 	}
		# # }
	}

	transition_state_duration = { months = 3 }

	on_change_phase = {
		# If relevant, gather data on when we changed phase.
		# if = {
		# 	limit = { gather_debug_variables_for_persian_struggle_trigger = yes }
		# 	# Are we switching out of the Concession phase?
		# 	if = {
		# 		limit = { is_struggle_phase = investiture_controversy_phase_stabilisation }
		# 		increment_global_variable_effect = {
		# 			VAL = 1
		# 			VAR = sp_phase_stabil
		# 		}
		# 	}
		# 	# Are we switching out of the Unrest phase?
		# 	else_if = {
		# 		limit = { is_struggle_phase = investiture_controversy_phase_unrest }
		# 		increment_global_variable_effect = {
		# 			VAL = 1
		# 			VAR = sp_phase_unrest
		# 		}
		# 	}
		# }
	}
	
	# Root = the character which has joined the struggle
 	on_join = {
		if = {
			limit = {
				NOT = {
					exists = global_var:investiture_struggle_initiation
				}
			}
			set_global_variable = investiture_struggle_initiation
			struggle:investiture_controversy_struggle = { 
				trigger_event = neutral_struggle.0001
				trigger_event = tct_neutral_struggle.0001
				trigger_event = {
					id = tct_investiture_struggle.0001
					years = { 1 5 }
				}
			}
		}

		#Joining the Imperial Supporter side
		if = {
			limit = {
				OR = {
					top_liege = title:e_hre.holder
					is_independent_ruler = yes
					liege = title:k_papal_state.holder
				}	
				NOR = {
					this = title:k_papal_state.holder
					has_trait = tct_imperial_supporter
					has_trait = tct_papal_supporter
				}
				any_character_struggle = { this = struggle:investiture_controversy_struggle }
				OR = {
					has_relation_friend = title:e_hre.holder
					has_relation_lover = title:e_hre.holder
					has_relation_rival = title:k_papal_state.holder
					has_relation_nemesis = title:k_papal_state.holder
					AND = {
						top_liege = {
							this = title:e_hre.holder 
							has_trait = loyal
							NOT = {
								OR = {
									has_relation_friend = title:k_papal_state.holder
									has_relation_lover = title:k_papal_state.holder
									has_relation_rival = title:e_hre.holder
									has_relation_nemesis = title:e_hre.holder
								}
							}
						}
					}
					AND = {
						OR = {
							has_vassal_stance = zealot
							ai_zeal >= 75
						}
						title:e_hre.holder = {
							piety_level > title:k_papal_state.holder.piety_level
						}
					}
					AND = {
						highest_held_title_tier >= tier_county
						exists = liege
						liege = {
							any_vassal = {
								NOT = { this = root }
								NOT = {
									OR = {
										has_relation_friend = root
										has_relation_lover = root
									}
								}
								OR = {
									opinion = { #They simply dislike you
										target = root
										value <= -30
									}
									#You dislike them
									reverse_opinion = {
										target = prev
										value <= -30
									}
								}
								has_trait = tct_papal_supporter
							}
						}
					}
				}
			}
			add_trait = tct_imperial_supporter
		}
		#Joining the Papal Supporter side
		else_if = {
			limit = {
				OR = {
					top_liege = title:e_hre.holder
					is_independent_ruler = yes
					liege = title:k_papal_state.holder
				}	
				NOR = {
					this = title:e_hre.holder
					has_trait = tct_imperial_supporter
					has_trait = tct_papal_supporter
				}
				any_character_struggle = { this = struggle:investiture_controversy_struggle }
				OR = {
					has_relation_friend = title:k_papal_state.holder
					has_relation_lover = title:k_papal_state.holder
					has_relation_rival = title:e_hre.holder
					has_relation_nemesis = title:e_hre.holder
					AND = {
						top_liege = {
							this = title:k_papal_state.holder 
							has_trait = loyal
							NOT = {
								OR = {
									has_relation_friend = title:e_hre.holder
									has_relation_lover = title:e_hre.holder
									has_relation_rival = title:k_papal_state.holder
									has_relation_nemesis = title:k_papal_state.holder
								}
							}
						}
					}
					AND = {
						OR = {
							has_vassal_stance = zealot
							ai_zeal >= 75
						}
						title:k_papal_state.holder = {
							piety_level >= title:e_hre.holder.piety_level
						}
					}
					AND = {
						top_liege = title:e_hre.holder 
						OR = {
							has_trait = arrogant
							has_trait = ambitious
						}
						opinion = {
							target = title:e_hre.holder
							value <= 0
						}
					}
					AND = {
						top_liege = title:e_hre.holder 
						is_powerful_vassal = yes
						NOR = {
							is_councillor_of = title:e_hre.holder
							has_trait = content
							has_trait = humble
						}
						opinion = {
							target = title:e_hre.holder
							value <= 0
						}
					}
					AND = {
						highest_held_title_tier >= tier_county
						exists = liege
						liege = {
							any_vassal = {
								NOT = { this = root }
								NOT = {
									OR = {
										has_relation_friend = root
										has_relation_lover = root
									}
								}
								OR = {
									opinion = { #They simply dislike you
										target = root
										value <= -30
									}
									#You dislike them
									reverse_opinion = {
										target = prev
										value <= -30
									}
								}
								has_trait = tct_imperial_supporter
							}
						}
					}
				}
			}
			add_trait = tct_papal_supporter
		}
		# Join Neither (Don't satisfy other two categories)
		else_if = {
			limit = {
				OR = {
					top_liege = title:e_hre.holder
					is_independent_ruler = yes
					liege = title:k_papal_state.holder
				}	
				NOR = {
					this = title:e_hre.holder
					this = title:k_papal_state.holder
					has_trait = tct_imperial_supporter
					has_trait = tct_papal_supporter
				}
				any_character_struggle = { this = struggle:investiture_controversy_struggle }
				
				has_trait = content

				NOR = {
					AND = {
						opinion = {
							target = title:e_hre.holder
							value >= 25
						}
						opinion = {
							target = title:e_hre.holder
							value <= -25
						}
					}
					AND = {
						opinion = {
							target = title:k_papal_state.holder
							value >= 25
						}
						opinion = {
							target = title:k_papal_state.holder
							value <= -25
						}
					}
				}
			}
			#No Action
			add_character_flag = not_interested_in_the_investiture_controversy
		}
		else_if = {
			limit = {
				this = title:e_hre.holder
			}
			add_trait = tct_imperial_supporter
		}
		else_if = {
			limit = {
				this = title:k_papal_state.holder
			}
			add_trait = tct_papal_supporter
		}
		else_if = {
			limit = {
				NOR = {
					this = title:k_papal_state.holder
					has_trait = tct_imperial_supporter
					has_trait = tct_papal_supporter
				}
				any_character_struggle = { this = struggle:investiture_controversy_struggle }

				AND = {
					top_liege = title:e_hre.holder
					opinion = {
						target = title:e_hre.holder
						value >= 25
					}
				}
			}
			add_trait = tct_imperial_supporter
		}


		# if = {
		# 	limit = { is_ai = no }
		# 	trigger_event = fp3_struggle.0051
		# }
 	}

	##################################################
	# Phases
	##################################################
	start_phase = investiture_controversy_phase_unrest
	
	phase_list = {

		investiture_controversy_phase_unrest = { # Unrest Phase
			duration = { points = 500 }

			future_phases = {
				investiture_controversy_phase_hostility = {
					catalysts = {
						# Win/Start a War against another involved ruler of the same tier or higher who has an opposing trait faction.(tct_papal_supporter vs tct_imperial_supporter)
						tct_catalyst_supporter_win_unfair_war_within_the_region = major_struggle_catalyst_gain
						tct_catalyst_supporter_win_fair_war_within_the_region = massive_struggle_catalyst_gain
						tct_catalyst_detractor_win_unfair_war_within_the_region = major_struggle_catalyst_gain
						tct_catalyst_detractor_win_fair_war_within_the_region = massive_struggle_catalyst_gain
						# Successfully use the Install a Supporter Caus Belli
						tct_catalyst_install_loyalist_cb = major_struggle_catalyst_gain

						# Yearly drift every year that the Pope and Emperor dislike eachother.
						tct_papal_hre_opinions = minor_struggle_catalyst_gain

						# Supporter is Murdered / Killed (by scheme or otherwise)
						tct_catalyst_unnatural_death_supporter = major_struggle_catalyst_gain

						# Convert a Ruler (Convert to side scheme.)

						# Obtain a Title within the Struggle Region from an Interloper or Uninvolved Ruler

						# Imprison any member of the opposing side.

						# Reveal a secret of the opposing side.

						# Break a truce of the opposing side.

						# A Papal Supporter and Imperial Supporter become Rivals or Nemeses 

						# Use a Hook of the opposing side. 

						# Gain a claim on a member of the opposing side
					}
				}
 
				investiture_controversy_phase_conciliation = {
					# Catalyst values are low here because we track this stuff across every phase, so they need to take _roughly_ ~100-120 years to build up, all else being equal.
					catalysts = {
						
					}
				}
			}

			war_effects = {
				name = WAR_EFFECTS_NAME

				involved_parameters = {
					# install_loyalist_cb_unlocked = yes # Change to unlocked for Papal Supporter
					offer_vassalization_removes_disloyalty = yes
					# fp3_caliph_gets_cheaper_subjugation_cb = yes # Change to Pope?
				}

				all_county_modifier = {
					# The region is more amenable for waging war.
					supply_limit_mult = 0.5
					levy_reinforcement_rate_friendly_territory = 0.5
				}

				involved_county_modifier = {
					# The region is more amenable for waging war.
					levy_size = 0.5
					garrison_size = -0.25
				}

				interloper_county_modifier = {
					# Interlopers get partial benefits for waging war.
					levy_size = 0.25
					garrison_size = -0.15
				}

				uninvolved_county_modifier = {
					# Uninvolved characters shouldn't be here (lookin' at you caliphs that lose Baghdad), so they get punished.
					levy_size = -0.5
					garrison_size = -0.75
				}

				involved_character_modifier = {
					# Fighting is encouraged, especially defensively.
					advantage_against_coreligionists = 5
					mercenary_hire_cost_mult = -0.35
					# Get out there and do your part.
					led_by_owner_extra_advantage_add = 10
					# This pumps some characters up.
					glory_hound_ai_energy = very_high_positive_ai_value
					glory_hound_ai_boldness = very_high_positive_ai_value
					ai_war_chance = 10
					ai_war_cooldown = -0.5
				}

				interloper_character_modifier = {
					# Interlopers'll have an easier time with hiring mercenaries.
					mercenary_hire_cost_mult = -0.25
					# But also benefit greatly from taking part personally.
					# Get out there and do your part.
					led_by_owner_extra_advantage_add = 5
					ai_war_chance = 2
					ai_war_cooldown = -0.25
				}
			}

			faith_effects = {
				name = FAITH_EFFECTS_NAME

				involved_parameters = {
					completing_building_in_temple_gives_piety = yes
					# demand_submission_interaction_unlocked = yes # Change to Pope?
					piety_level_affects_vassalage_acceptance = yes
					can_trade_piety_for_marriage_acceptance = yes
					piety_from_converting_county = yes
					piety_from_converting_involved_rulers = yes
				}

				involved_character_modifier = {
					# Zealots are ready to throw down.
					zealot_ai_vengefulness = very_high_positive_ai_value
					zealot_ai_zeal = very_high_positive_ai_value
					zealot_ai_boldness = high_positive_ai_value
				}
			}

			culture_effects = {
				name = CULTURE_EFFECTS_NAME

				involved_parameters = {

				}

				involved_character_modifier = {
					# Minorities within your realm want no part of whatever you're pushing.
					minority_opinion = -10
					minority_tax_contribution_mult = -0.5
					minority_levy_contribution_mult = -0.5
					minority_ai_energy = high_positive_ai_value
					# Diff-faith minorities _especially_ have no time for you.
					minority_different_faith_opinion = -10
				}
			}

			other_effects = {
				name = OTHER_EFFECTS_NAME

				# We don't immediately dunk on your economics too much: you get tools to build up in the other phase + tools to wage war here, so we want characters to injure themselves because of conflicts they start first and foremost rather than nebulous regional factors.

				all_county_modifier = {
					# Lotta armed folk on the road.
					travel_danger = 25
				}

				involved_county_modifier = {
					# If you're at war, there's chaos at home.
					monthly_county_control_change_at_war_add = -0.02
					# Manpower is devoted to fighting, less able bodies to farm/build
					build_speed = 0.35
					tax_mult = -0.25
					development_growth_factor = -0.2
				}

				interloper_county_modifier = {
					# If you're at war, there's chaos at home.
					monthly_county_control_change_at_war_add = -0.01
					# Manpower is devoted to fighting, less able bodies to farm/build
					build_speed = 0.3
					tax_mult = -0.2
					development_growth_factor = -0.15
				}

				uninvolved_county_modifier = {
					# Everyone's squabbling amongst themselves in your struggle lands.
					monthly_county_control_change_at_war_add = -0.03
					# Manpower is devoted to fighting, less able bodies to farm/build
					build_speed = 0.25
					tax_mult = -0.2
					development_growth_factor = -0.15
				}

				involved_character_modifier = {
					castle_holding_build_gold_cost = -0.3
					owned_hostile_scheme_success_chance_add = 20
					claim_throne_scheme_power_mult = 1
				}

				involved_parameters = {
					unlocks_abandon_hook_for_all = yes
					# unlocks_claim_throne_for_all = yes # Restrict to Papal/Imperial Supporter to opposite trait
					fp3_sway_scheme_more_powerful = yes 
					fp3_sway_vassals_removes_disloyalty = yes
					less_dissolution_more_claimants = yes

					# Note: this parameter doesn't _do_ anything, it's just for the tooltip.
					## You need to manually set/clear the "struggle_block_dissolution_faction" variable on affected titles instead.
					### We do it this way to save a bit on performance.
					# caliph_cant_be_dissolutioned = yes # Change to HRE
				}
			}

			ending_decisions = {
				investiture_controversy_ending_foundation_decision # renamed Tempering the Caliphate
				investiture_controversy_ending_assertion_decision # renamed Strenghten the Caliphate
				investiture_controversy_ending_rekindle_iran_decision #renamed to Rekindle Iran
			}
		}

		investiture_controversy_phase_hostility = { # Hostility Phase
			duration = { points = 500 }

			future_phases = {
				investiture_controversy_phase_unrest = {
					catalysts = {

					}
				}
 
				investiture_controversy_phase_conciliation = {
					# Catalyst values are low here because we track this stuff across every phase, so they need to take _roughly_ ~100-120 years to build up, all else being equal.
					catalysts = {
						
					}
				}
			}

			war_effects = {
				name = WAR_EFFECTS_NAME

				involved_parameters = {
					install_loyalist_cb_unlocked = yes
					offer_vassalization_removes_disloyalty = yes
					fp3_caliph_gets_cheaper_subjugation_cb = yes
					cheaper_incursions_vs_caliph = yes
				}

				all_county_modifier = {
					# The region is more amenable for waging war.
					supply_limit_mult = 1
					levy_reinforcement_rate_friendly_territory = 1
				}

				involved_county_modifier = {
					# The region is more amenable for waging war.
					levy_size = 1
					garrison_size = -0.5
				}

				interloper_county_modifier = {
					# Interlopers get partial benefits for waging war.
					levy_size = 0.5
					garrison_size = -0.25
				}

				uninvolved_county_modifier = {
					# Uninvolved characters shouldn't be here (lookin' at you caliphs that lose Baghdad), so they get punished.
					levy_size = -0.5
					garrison_size = -0.75
				}

				involved_character_modifier = {
					# Your Piety influences your martial/prowess
					martial_per_piety_level = 1
					prowess_per_piety_level = 1
					# Fighting is encouraged, especially defensively.
					same_heritage_county_advantage_add = 5
					mercenary_hire_cost_mult = -0.35
					# Get out there and do your part.
					led_by_owner_extra_advantage_add = 10
					ai_war_chance = 10
					ai_war_cooldown = -0.5
				}

				interloper_character_modifier = {
					# Interlopers'll have an easier time with hiring mercenaries.
					mercenary_hire_cost_mult = -0.25
					# But also benefit greatly from taking part personally.
					# Get out there and do your part.
					led_by_owner_extra_advantage_add = 5
					ai_war_chance = 2
					ai_war_cooldown = -0.25
				}
			}

			faith_effects = {
				name = FAITH_EFFECTS_NAME

				involved_parameters = {
					completing_building_in_temple_gives_piety = yes
					demand_submission_interaction_unlocked = yes
					piety_level_affects_vassalage_acceptance = yes
					can_trade_piety_for_marriage_acceptance = yes
					piety_from_converting_county = yes
					piety_from_converting_involved_rulers = yes
				}

				involved_character_modifier = {
					# Zealots are ready to throw down.
					zealot_ai_vengefulness = very_high_positive_ai_value
					zealot_ai_zeal = very_high_positive_ai_value
					zealot_ai_boldness = high_positive_ai_value
				}
			}

			culture_effects = {
				name = CULTURE_EFFECTS_NAME

				involved_parameters = {
				  struggle_prestige_from_befriending_same_culture = yes
				  struggle_prestige_install_same_culture_claimant = yes
				  struggle_different_culture_more_likely_to_use_minority_stance = yes
				}

				involved_character_modifier = {
					# Minorities within your realm want no part of whatever you're pushing.
					minority_opinion = -10
					minority_tax_contribution_mult = -0.5
					minority_levy_contribution_mult = -0.5
					minority_ai_energy = high_positive_ai_value
					# Diff-faith minorities _especially_ have no time for you.
					minority_different_faith_opinion = -10
				}
			}

			other_effects = {
				name = OTHER_EFFECTS_NAME

				# We don't immediately dunk on your economics too much: you get tools to build up in the other phase + tools to wage war here, so we want characters to injure themselves because of conflicts they start first and foremost rather than nebulous regional factors.

				all_county_modifier = {
					# Lotta armed folk on the road.
					travel_danger = 50
				}

				involved_county_modifier = {
					# If you're at war, there's chaos at home.
					monthly_county_control_change_at_war_add = -0.05
					# Manpower is devoted to fighting, less able bodies to farm/build
					build_speed = 0.5
					tax_mult = -0.35
					development_growth_factor = -0.3
				}

				interloper_county_modifier = {
					# If you're at war, there's chaos at home.
					monthly_county_control_change_at_war_add = -0.03
					# Manpower is devoted to fighting, less able bodies to farm/build
					build_speed = 0.35
					tax_mult = -0.25
					development_growth_factor = -0.2
				}

				uninvolved_county_modifier = {
					# Everyone's squabbling amongst themselves in your struggle lands.
					monthly_county_control_change_at_war_add = -0.1
				}

				involved_character_modifier = {
					vassal_levy_contribution_mult = 0.25 # Maybe remove
					vassal_tax_contribution_mult = -0.25 # Maybe remove
					owned_hostile_scheme_success_chance_add = 35
					claim_throne_scheme_power_mult = 1.5
				}

				involved_parameters = {
					unlocks_abandon_hook_for_all = yes
					unlocks_claim_throne_for_all = yes
					fp3_sway_scheme_more_powerful = yes 
					fp3_sway_vassals_removes_disloyalty = yes
					empowered_vizierate = yes
					unlocks_challenge_house_head_for_clans = yes
					less_dissolution_more_claimants = yes

					# Note: this parameter doesn't _do_ anything, it's just for the tooltip.
					## You need to manually set/clear the "struggle_block_dissolution_faction" variable on affected titles instead.
					### We do it this way to save a bit on performance.
					caliph_cant_be_dissolutioned = yes
				}
			}

			ending_decisions = {
				investiture_controversy_ending_foundation_decision # renamed Tempering the Caliphate
				investiture_controversy_ending_assertion_decision # renamed Strenghten the Caliphate
				investiture_controversy_ending_rekindle_iran_decision #renamed to Rekindle Iran
			}
		}

		investiture_controversy_phase_conciliation = {
			duration = { points = 500 }

			future_phases = {
				investiture_controversy_phase_unrest = {
					catalysts = {
						
					}
				}

				investiture_controversy_ending_phase_compromise = {
					# Catalyst values are low here because we track this stuff across every phase, so they need to take _roughly_ ~100-120 years to build up, all else being equal.
					catalysts = {
						
					}
				}
			}

			war_effects = {
				name = WAR_EFFECTS_NAME

				involved_parameters = {
					install_loyalist_cb_unlocked = yes
					offer_vassalization_removes_disloyalty = yes
					fp3_caliph_gets_cheaper_subjugation_cb = yes
					cheaper_incursions_vs_caliph = yes
				}

				all_county_modifier = {
					# The region is more amenable for waging war.
					supply_limit_mult = 1
					levy_reinforcement_rate_friendly_territory = 1
				}

				involved_county_modifier = {
					# The region is more amenable for waging war.
					levy_size = 1
					garrison_size = -0.5
				}

				interloper_county_modifier = {
					# Interlopers get partial benefits for waging war.
					levy_size = 0.5
					garrison_size = -0.25
				}

				uninvolved_county_modifier = {
					# Uninvolved characters shouldn't be here (lookin' at you caliphs that lose Baghdad), so they get punished.
					levy_size = -0.5
					garrison_size = -0.75
				}

				involved_character_modifier = {
					# Fighting is encouraged, especially defensively.
					same_heritage_county_advantage_add = 5
					mercenary_hire_cost_mult = -0.35
					# Get out there and do your part.
					led_by_owner_extra_advantage_add = 10
					ai_war_chance = 10
					ai_war_cooldown = -0.5
				}

				interloper_character_modifier = {
					# Interlopers'll have an easier time with hiring mercenaries.
					mercenary_hire_cost_mult = -0.25
					# But also benefit greatly from taking part personally.
					# Get out there and do your part.
					led_by_owner_extra_advantage_add = 5
					ai_war_chance = 2
					ai_war_cooldown = -0.25
				}
			}

			faith_effects = {
				name = FAITH_EFFECTS_NAME

				involved_parameters = {
					completing_building_in_temple_gives_piety = yes
					demand_submission_interaction_unlocked = yes
					piety_level_affects_vassalage_acceptance = yes
					can_trade_piety_for_marriage_acceptance = yes
					piety_from_converting_county = yes
					piety_from_converting_involved_rulers = yes
				}

				involved_character_modifier = {
					# Zealots are ready to throw down.
					zealot_opinion = 20
					zealot_levy_contribution_mult = 0.5
					zealot_tax_contribution_mult = 0.5
					zealot_ai_vengefulness = very_high_positive_ai_value
					zealot_ai_zeal = very_high_positive_ai_value
					zealot_ai_boldness = high_positive_ai_value
					church_holding_build_gold_cost = -0.3
				}
			}

			culture_effects = {
				name = CULTURE_EFFECTS_NAME

				involved_parameters = {
				  struggle_prestige_from_befriending_same_culture = yes
				  struggle_prestige_install_same_culture_claimant = yes
				  struggle_different_culture_more_likely_to_use_minority_stance = yes
				}

				involved_character_modifier = {
					# Minorities within your realm want no part of whatever you're pushing.
					minority_opinion = -10
					minority_tax_contribution_mult = -0.5
					minority_levy_contribution_mult = -0.5
					minority_ai_energy = high_positive_ai_value
					# Diff-faith minorities _especially_ have no time for you.
					minority_different_faith_opinion = -10
				}
			}

			other_effects = {
				name = OTHER_EFFECTS_NAME

				# We don't immediately dunk on your economics too much: you get tools to build up in the other phase + tools to wage war here, so we want characters to injure themselves because of conflicts they start first and foremost rather than nebulous regional factors.

				all_county_modifier = {
					# Not much happening economically.
					build_speed = -0.5
					# Lotta armed folk on the road.
					travel_danger = 25
				}

				involved_county_modifier = {
					# If you're at war, there's chaos at home.
					monthly_county_control_change_at_war_add = -0.02
				}

				interloper_county_modifier = {
					# If you're at war, there's chaos at home.
					monthly_county_control_change_at_war_add = -0.01
				}

				uninvolved_county_modifier = {
					# Everyone's squabbling amongst themselves in your struggle lands.
					monthly_county_control_change_at_war_add = -0.03
				}

				involved_character_modifier = {
					owned_hostile_scheme_success_chance_add = 20
					claim_throne_scheme_power_mult = 1
				}

				involved_parameters = {
					unlocks_abandon_hook_for_all = yes
					unlocks_claim_throne_for_all = yes
					fp3_sway_scheme_more_powerful = yes 
					fp3_sway_vassals_removes_disloyalty = yes
					unlocks_challenge_house_head_for_clans = yes
					less_dissolution_more_claimants = yes

					# Note: this parameter doesn't _do_ anything, it's just for the tooltip.
					## You need to manually set/clear the "struggle_block_dissolution_faction" variable on affected titles instead.
					### We do it this way to save a bit on performance.
					caliph_cant_be_dissolutioned = yes
				}
			}

			ending_decisions = {
				investiture_controversy_ending_foundation_decision # renamed Tempering the Caliphate
				investiture_controversy_ending_assertion_decision # renamed Strenghten the Caliphate
				investiture_controversy_ending_rekindle_iran_decision #renamed to Rekindle Iran
			}
		}

		# Phase Endings
		investiture_controversy_ending_phase_compromise = {
			save_progress = yes

			on_start = {
				#this has to be run before fp3_end_persian_struggle_effect for concession effects to work
				fp3_struggle_ending_concession_effects = yes
				# Save Sunni caliph or previous one as scope:struggle_liege
				fp3_save_sunni_caliph_or_previous_effect = yes

				end_investiture_controversy_struggle_effect = {
					ENDING = yes
					EVENT = fp3_struggle.0082
					FLAG = flag:end_investiture_controversy_struggle_ending
				}
			}
		}
	}
}
