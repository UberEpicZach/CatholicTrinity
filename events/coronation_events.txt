namespace = coronation


# CHANGE REALM PRIEST WITH REALM PRIEST, CARDINAL OR ANTIPOPE
# - for antipope: rot_antipope_of_ruler is set if the scoped character has named an antipope
# ADD MODIFIER AT THE END IF CROWNED BY REALM PRIEST OR POPE
coronation.0001 = {  # Coronation: the clergyman
	title = coronation_event.0001.t
	desc = coronation_event.0001.desc
	theme = crown
	type = character_event

	immediate = {
		random_vassal = {
			limit = {
				has_faith = faith:catholic
				#is_theocratic_lessee = yes
				is_pope = no
				is_clergy = yes
				NOT = {
					THIS = root.realm_priest
				}
			}
			save_scope_as = random_priest
		}
		root.realm_priest = {
			save_scope_as = my_realm_priest
		}
		faith:catholic.religious_head = {
			save_scope_as = the_pope
		}
		save_scope_as = me
	}

	left_portrait = {
		character = root
		animation = personality_rational
	}

	right_portrait = {
		character = scope:the_pope
		triggered_animation = {
			trigger = {
				reverse_opinion = {
					target = scope:the_pope
					value <= -20
				}
			}
			animation = anger
		}
		animation = personality_zealous
	}

	lower_left_portrait = {
		character = root.realm_priest
		animation = idle
	}

	lower_right_portrait = {
		character = scope:random_priest
		animation = admiration
	}

	option = {	# Choose the Pope
		name = coronation_event.0001.a
	
		scope:the_pope = {
			add_opinion = {
				target = ROOT
				opinion = 10
				modifier = grateful_opinion
			}
			trigger_event = {
				id = coronation.1000
				days = 3
			}
		}

		set_variable = {
			name = gold_given
			value = 100
		}
		remove_short_term_gold = 100

		ai_chance = {
			base = 70

			modifier = {
				add = -20
				OR = {
					has_trait = greedy
					has_trait = avaricious
				}
			}
			modifier = {
				add = 10
				OR = {
					has_trait = diligent
					has_trait = ambitious
				}
			}
			modifier = {
				add = 10
				has_trait = zealous
			}
			modifier = {
				add = -5
				has_trait = lazy
			}
			modifier = {
				add = -30
				OR = {
					opinion = {
						target = scope:the_pope
						value <= -35
					}
					has_relation_rival = scope:the_pope
				}
			}
			modifier = {
				add = 20
				OR = {
					opinion = {
						target = scope:the_pope
						value >= 40
					}
					has_relation_friend = scope:the_pope
					has_relation_best_friend = scope:the_pope
					has_relation_lover = scope:the_pope
					has_relation_soulmate = scope:the_pope
					has_secret_relation_lover = scope:the_pope
				}
			}
			modifier = {
				add = 10
				OR = {
					ROOT.dynasty = scope:the_pope.dynasty
					ROOT.house = scope:the_pope.house
				}
			}
			modifier = {
				add = 10
				ROOT.real_father = scope:the_pope
				reverse_opinion = {
					target = scope:the_pope
					value >= 0
				}
			}
		}
	}

	option = {	# Choose the Realm Priest
		name = coronation_event.0001.b

		trigger = {
			OR = {
				has_realm_law = free_investiture_early
				has_realm_law = free_investiture_late
			}
		}
	
		scope:the_pope = {
			add_opinion = {
				target = ROOT
				opinion = -10
				modifier = disappointed_opinion
			}
		}
		ROOT.realm_priest = {
			add_opinion = {
				target = ROOT
				opinion = 20
				modifier = grateful_opinion
			}
			trigger_event = {
				id = coronation.1000
				days = 3
			}
		}

		set_variable = {
			name = gold_given
			value = 50
		}
		remove_short_term_gold = 50

		ai_chance = {
			base = 50

			modifier = {
				add = -30
				OR = {
					opinion = {
						target = root.realm_priest
						value <= -35
					}
					has_relation_rival = ROOT.realm_priest
				}
			}
			modifier = {
				add = 20
				OR = {
					opinion = {
						target = root.realm_priest
						value >= 70
					}
					has_relation_friend = ROOT.realm_priest
					has_relation_best_friend = ROOT.realm_priest
					has_relation_lover = ROOT.realm_priest
					has_relation_soulmate = ROOT.realm_priest
					has_secret_relation_lover = ROOT.realm_priest
				}
			}
			modifier = {
				add = 10
				OR = {
					ROOT.dynasty = root.realm_priest.dynasty
					ROOT.house = root.realm_priest.house
				}
			}
			modifier = {
				add = 10
				ROOT.real_father = root.realm_priest
				reverse_opinion = {
					target = root.realm_priest
					value >= 0
				}
				opinion = {
					target = root.realm_priest
					value >= 0
				}
			}
		}
	}

	option = {	# Choose a lowly priest
		name = coronation_event.0001.c

		trigger = {
			OR = {
				has_realm_law = free_investiture_early
				has_realm_law = free_investiture_late
			}
			exists = scope:random_priest
		}
	
		scope:the_pope = {
			add_opinion = {
				target = ROOT
				opinion = -25
				modifier = disappointed_opinion
			}
		}
		ROOT.realm_priest = {
			add_opinion = {
				target = ROOT
				opinion = -20
				modifier = disappointed_opinion
			}
		}

		set_variable = {
			name = gold_given
			value = 10
		}
		remove_short_term_gold = 10
		scope:random_priest = {
			trigger_event = {
				id = coronation.1000
				days = 3
			}
		}

		ai_chance = {
			base = 10

			modifier = {
				add = 10
				opinion = {
					target = scope:the_pope
					value <= -15
				}
				opinion = {
					target = root.realm_priest
					value < 0
				}
			}
			modifier = {
				add = 5
				has_trait = cynical
			}
			modifier = {
				add = 5
				has_trait = humble
			}
			modifier = {
				add = 10
				OR = {
					ROOT.dynasty = scope:random_priest.dynasty
					ROOT.house = scope:random_priest.house
				}
			}
			modifier = {
				add = 10
				ROOT.real_father = scope:random_priest
				reverse_opinion = {
					target = scope:random_priest
					value >= 0
				}
				opinion = {
					target = scope:random_priest
					value >= 0
				}
			}
		}
	}

	option = {	# Change idea, no coronation
		name = coronation_event.0001.d
	
		scope:the_pope = {
			add_opinion = {
				target = ROOT
				opinion = -10
				modifier = disappointed_opinion
			}
		}
		ROOT.realm_priest = {
			add_opinion = {
				target = ROOT
				opinion = -15
				modifier = disappointed_opinion
			}
		}

		add_piety = {
			value = -50
		}

		ai_chance = {
			base = 5

			modifier = {
				add = 5
				has_trait = fickle
			}
		}
	}
}

coronation.0002 = {  # Coronation: for every pocket
	title = coronation_event.0002.t
	desc = coronation_event.0002.desc
	theme = crown
	type = character_event

	left_portrait = {
		character = ROOT
		animation = personality_rational
	}

	option = {
		name = coronation_event.0002.a

		show_as_unavailable = {
			OR = {
				amenity_level = {
					type = food
					value < 4
				}
				amenity_level = {
					type = lodgings
					value < 3
				}
			}
		}

		stress_impact = {
			base = 0
			greedy = 20
			gregarious = -10
			temperate = 5
			gluttonous = -5
		}

		remove_short_term_gold = 100

		ai_chance = {
			base = 33

			modifier = {
				add = -15
				OR = {
					has_trait = greedy
					has_trait = avaricious
				}
			}
			modifier = {
				add = 10
				has_trait = gluttonous
			}
			modifier = {
				add = 15
				gold >= 150
			}
			modifier = {
				add = 10
				has_trait = generous
			}
			modifier = {
				add = 10
				has_trait = ambitious
			}
		}
	}

	option = {
		name = coronation_event.0002.b

		stress_impact = {
			base = 0
			lazy = 10
			temperate = -5
		}

		remove_short_term_gold = 50
		
		ai_chance = {
			base = 33

			modifier = {
				add = 10
				gold > 30
				gold < 150
			}
			modifier = {
				add = 5
				has_trait = ambitious
			}
		}
	}

	option = {
		name = coronation_event.0002.c

		show_as_unavailable = {
			amenity_level = {
				type = food
				value > 2
			}
		}

		stress_impact = {
			base = 0
			greedy = -10
			generous = 20
			lazy = 10
			gregarious = 5
			temperate = -10
			gluttonous = 10
		}

		remove_short_term_gold = 25

		ai_chance = {
			base = 33

			modifier = {
				add = -25
				gold <= 30
			}
			modifier = {
				add = -10
				has_trait = gluttonous
			}
			modifier = {
				add = -5
				has_trait = gregarious
			}
			modifier = {
				add = -10
				has_trait = generous
			}
			modifier = {
				add = 15
				OR = {
					has_trait = greedy
					has_trait = avaricious
				}
			}
			modifier = {
				add = 10
				OR = {
					has_trait = temperate
					has_trait = lazy
				}
			}
		}
	}
}

coronation.0003 = {  # Coronation: the refusal
	title = coronation_event.0003.t
	desc = coronation_event.0003.desc
	theme = crown
	type = character_event

	left_portrait = {
		character = root
		animation = shame
	}

	right_portrait = {
		character = scope:rejecter
		animation = schadenfreude
	}

	option = {
		name = coronation_event.0003.a

		add_prestige = -100
		add_gold = var:gold_given
		add_character_modifier = {
			modifier = coronation_refused
			years = 5
			desc = coronation_refused_desc
		}
	}
}

coronation.1000 = {  # Coronation: a typical request   --- only for the receiver, to accept or refuse coronation
	title = coronation_event.1000.t
	desc = coronation_event.1000.desc
	theme = crown
	type = character_event

	immediate = {
		save_scope_as = rejecter
	}

	left_portrait = {
		character = ROOT
		animation = personality_rational
	}

	right_portrait = {
		character = scope:me
		animation = beg
	}

	option = {	# Accept the request
		name = coronation_event.1000.a

		add_gold = var:gold_given
		
		stress_impact = {
			base = 0
			diligent = 10
			lazy = 20
			shy = 15
		}

		scope:me = {
			trigger_event = {
				id = coronation.0002
				days = 7
			}
		}

		ai_chance = {
			base = 50

			modifier = {
				add = 1000
				OR = {
					has_relation_best_friend = scope:me
					has_relation_friend = scope:me
					has_secret_relation_lover = scope:me
					has_relation_lover = scope:me
					has_relation_soulmate = scope:me
				}
			}
		}
	}

	option = {	# Refuse the request
		name = coronation_event.1000.b

		scope:me = {
			add_opinion = {
				target = scope:the_pope
				opinion = -30
				years = 5
				modifier = angry_opinion
			}
			trigger_event = {
				id = coronation.0003
				days = 3
			}
		}

		ai_chance = {
			base = 10
			
			modifier = {
				add = 40
				OR = {
					opinion = {
						target = scope:me
						value <= -40
					}
					has_relation_rival = scope:me
				}
			}
			modifier = {
				add = -1000
				OR = {
					has_relation_best_friend = scope:me
					has_relation_friend = scope:me
					has_secret_relation_lover = scope:me
					has_relation_lover = scope:me
					has_relation_soulmate = scope:me
				}
			}
		}
	}
}