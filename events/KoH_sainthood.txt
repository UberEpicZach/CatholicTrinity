namespace = TCT_sainthood

TCT_sainthood.1 = {
	hidden = yes

	trigger = {
		sainthood_event1trigger = yes
		NOT = { has_trait = saint } #Living Saints skip the whole process, wp.
	}

	immediate = {
		save_scope_as = saint_person
		
		# Save the location where the saint person died
		if = {
			limit = { exists = capital_province }
			capital_province = { save_scope_as = saint_capital_province }
		}
		else_if = {
			limit = { exists = location }
			location = { save_scope_as = saint_capital_province }
		}

		# Continue only if we have fetched a valid location
		if = {
			limit = {
				exists = scope:saint_capital_province
				# Only 1 saint per province
				OR = {
					is_ai = no
					scope:saint_capital_province = {
						NOR = {
							has_province_modifier = local_veneration
							has_province_modifier = saintly_tomb
						}
						# No Local Veneration if county religion is different
						faith.religion = scope:saint_person.faith.religion
					}
				}
			}

			#Bonus to episcopal investigation for players
			if = {
				limit = { is_ai = no }
				scope:saint_capital_province = {
					set_variable = {
						name = player_veneration
						value = yes
					}
				}
			}

			#Save the death date for Saint's Day Feast Activity
			scope:saint_capital_province = {
				#switch does not work >:(
				if = { limit = { current_month = 1 } set_variable = { name = saint_person_death_date value = 1 } }
				else_if = { limit = { current_month = 2 } set_variable = { name = saint_person_death_date value = 2 } }
				else_if = { limit = { current_month = 3 } set_variable = { name = saint_person_death_date value = 3 } }
				else_if = { limit = { current_month = 4 } set_variable = { name = saint_person_death_date value = 4 } }
				else_if = { limit = { current_month = 5 } set_variable = { name = saint_person_death_date value = 5 } }
				else_if = { limit = { current_month = 6 } set_variable = { name = saint_person_death_date value = 6 } }
				else_if = { limit = { current_month = 7 } set_variable = { name = saint_person_death_date value = 7 } }
				else_if = { limit = { current_month = 8 } set_variable = { name = saint_person_death_date value = 8 } }
				else_if = { limit = { current_month = 9 } set_variable = { name = saint_person_death_date value = 9 } }
				else_if = { limit = { current_month = 10 } set_variable = { name = saint_person_death_date value = 10 } }
				else_if = { limit = { current_month = 11 } set_variable = { name = saint_person_death_date value = 11 } }
				else_if = { limit = { current_month = 12 } set_variable = { name = saint_person_death_date value = 12 } }


				#faith = { #KGDEBUG
				#	add_to_variable_list = { name = venerated_person target = scope:saint_person }
				#	add_to_variable_list = { name = saint_capital_province target = scope:saint_capital_province }
				#	add_to_variable_list = { name = saint_capital_province_owner target = scope:saint_capital_province.province_owner }
				#} #/KGDEBUG

				# Episcopal investigation
				# Find a local bishop to perform investigation
				duchy = { #this block took me three days :hidethepainharold:
					random_in_de_jure_hierarchy = {
						limit = {
							tier = tier_barony
							exists = lessee
							lessee = {
								NOR = {
									has_trait = TCT_antipope
									this = faith.religious_head
								}
								faith = scope:saint_person.faith
								prev = { save_temporary_scope_as = local_parish_temp }
								save_temporary_scope_as = local_priest_temp
							}
						}
					}
					scope:local_parish_temp ?= { save_scope_as = local_parish }
					scope:local_priest_temp ?= { save_scope_as = local_priest }
				}

				# Do we have a valid bishop to commence investigation?
				scope:local_priest ?= {
					#faith = { #KGDEBUG
					#	add_to_variable_list = { name = episcopal_investigator target = scope:local_priest }
					#	add_to_variable_list = { name = local_parish target = scope:local_parish }
					#} #/KGDEBUG
					random = {
						#Potential for beatification
						chance = 50
						#More likely to commence investigation if saint person is of same culture
						modifier = {
							add = 10
							culture = scope:saint_person.culture
						}
						#Sinful priests are less likely to promote sainthood
						modifier = {
							add = -20
							sainthood_pious_bishop = no
						}
						modifier = {
							add = 30
							scope:saint_person = {
								highest_held_title_tier >= tier_kingdom
							}
						}
						modifier = {
							add = 5
							has_trait = diligent
						}
						modifier = {
							add = -10
							has_trait = lazy
						}
						modifier = {
							factor = 0.5
							has_trait = cynical
						}
						modifier = {
							add = 10
							scope:saint_person = {
								has_trait = zealous
							}
						}
						modifier = {
							add = -10
							scope:saint_person = {
								is_lowborn = yes
							}
						}
						#modifier = {
						#	add = 50
						#	scope:saint_person = { martyrs_death_trigger = yes }
						#}
						modifier = {
							add = 100
							scope:saint_capital_province = {
								has_variable = player_veneration
							}
						}
						scope:saint_person = {
							faith = {
								trigger_event = { # Diocesan Phase
									id = TCT_sainthood.3
									#months = 1 #KGDEBUG
									years = 5
								}
							}
						}
					}
				}

				# Notification event about local veneration
				province_owner ?= {
					trigger_event = {
						id = TCT_sainthood.2
						days = 1 #to make dead saint person unprunable
					}
					liege ?= {
						if = {
							limit = {
								highest_held_title_tier < tier_kingdom
							}
							send_interface_toast = {
								type = event_toast_effect_good
								left_icon = scope:saint_person
								title = TCT_sainthood.1.toast.t
								custom_tooltip = TCT_sainthood.1.toast
							}
						}
					}
				}
			}

			random = {
				# Base potential for canonization
				chance = 100

				#Cynical people are less likely to be Canonized
				modifier = {
					factor = 0.8
					has_trait = cynical
				}
			
				#Reduced chance for Popes / Antipopes to become Saints
				modifier = {
					factor = 0.4
					OR = {
						has_title = title:k_papal_state
						#has_claim_on = title:k_papal_state
					}
				}
			
				#Religions without a Religious Head cannot Canonize
				modifier = {
					factor = 0 
					NOT = { exists = faith.religious_head }
				}

				#Eastern Christians have a lower chance of becoming Saints
				modifier = {
					factor = 0.8
					OR = {
						faith = faith:iconoclast
						faith = faith:nestorian
						faith = faith:insular_celtic
						faith = faith:paulician
						faith = faith:orthodox
						faith = faith:coptic
					}
				}
				#Players who don't have a saintly bloodline have a higher chance of becoming a Saint
				modifier = {
					factor = 2
					is_ai = no
					NOT = {
						dynasty ?= {
							has_dynasty_modifier = saintly_bloodline
						}
					}
				}
			
				#Positive has_has_traits increase your chances of becoming a Saint
				modifier = {
					factor = 1.5
					has_trait = patient
				}
				modifier = {
					factor = 1.5
					has_trait = diligent
				}
				modifier = {
					factor = 1.5
					has_trait = compassionate
				}
				modifier = {
					factor = 1.5
					has_trait = chaste
				}
				modifier = {
					factor = 1.5
					has_trait = generous
				}
				modifier = {
					factor = 1.5
					has_trait = temperate
				}
				modifier = {
					factor = 1.5
					has_trait = humble 
				}
				modifier = {
					factor = 1.2
					has_trait = just
				}
				modifier = {
					factor = 1.2
					has_trait = holy_warrior
				}
				#modifier = { #Can only be checked after death
				#	factor = 1.2
				#	martyrs_death_trigger = yes
				#}

				#Having the bloodline of a Saint severely decrease your chance of becoming a Saint
				modifier = {
					factor = 0.25
					dynasty ?= {
						has_dynasty_modifier = saintly_bloodline
					}
				}

				#Extra high piety increases your chance of becoming a Saint
				# It's >= for christs' sake!
				modifier = {
					factor = 1.2
					piety >= 1000
				}
				modifier = {
					factor = 1.2 
					piety >= 1500
				}
				modifier = {
					factor = 1.2
					piety >= 2000
				}
				modifier = {
					factor = 1.2
					piety >= 2500
				}
				modifier = {
					factor = 1.2
					piety >= 3000
				}
				modifier = {
					factor = 1.2
					piety >= 3500
				}
				modifier = {
					factor = 1.2
					piety >= 4000
				}
				modifier = {
					factor = 1.2
					piety >= 4500
				}
				modifier = {
					factor = 1.2
					piety >= 5000
				}
				modifier = {
					factor = 1.2
					piety >= 5500
				}
				modifier = {
					factor = 1.2
					piety >= 6000
				}
				modifier = {
					factor = 1.2
					piety >= 6500
				}
				modifier = {
					factor = 1.2 
					piety >= 7000
				}
				modifier = {
					factor = 1.2
					piety >= 7500
				}
				modifier = {
					factor = 1.2
					piety >= 8000
				}
				modifier = {
					factor = 1.2
					piety >= 8500
				}
				modifier = {
					factor = 1.2
					piety >= 9000
				}
				modifier = {
					factor = 1.2
					piety >= 9500
				}
				modifier = {
					factor = 1.2
					piety >= 10000
				}
			
				#Level of Piety
				modifier = {
					factor = {
						value = 1
						add = {
							add = piety_level
							multiply = 0.2
						}
					}
				}
			
				#First Saint of a Religion is easier
				modifier = {
					factor = 3
					# Switches are your friend, Uber...
					switch = {
						trigger = faith
						faith:iconoclast = { NOT = { has_global_variable = iconoclast_saint } }
						faith:nestorian = { NOT = { has_global_variable = nestorian_saint } }
						faith:insular_celtic = { NOT = { has_global_variable = insular_celtic_saint } }
						faith:paulician = { NOT = { has_global_variable = paulician_saint } }
						faith:orthodox = { NOT = { has_global_variable = orthodox_saint } }
						faith:catholic = { NOT = { has_global_variable = catholic_saint } }
						faith:coptic = { NOT = { has_global_variable = coptic_saint } }
					}
				}

				switch = {
					trigger = scope:saint_person.faith
					faith:iconoclast = { set_global_variable = iconoclast_saint }
					faith:nestorian = { set_global_variable = nestorian_saint }
					faith:insular_celtic = { set_global_variable = insular_celtic_saint }
					faith:paulician = { set_global_variable = paulician_saint }
					faith:orthodox = { set_global_variable = orthodox_saint }
					faith:catholic = { set_global_variable = catholic_saint }
					faith:coptic = { set_global_variable = coptic_saint }
				}
				faith = {
					trigger_event = {
						id = TCT_sainthood.8
						#years = 1 #KGDEBUG
						years = { 13 27 }
					}
				}
			}
		}
	}
}

TCT_sainthood.2 = { # Notification about Local Veneration
	type = character_event
	title = TCT_sainthood.2.t
	desc = {
		first_valid = {
			triggered_desc = {
				trigger = {
					NOT = { root.faith = scope:saint_person.faith }
				}
				desc = TCT_sainthood.2.desc.negative
			}
			random_valid = {
				desc = TCT_sainthood.2.desc.a
				desc = TCT_sainthood.2.desc.b
				desc = TCT_sainthood.2.desc.c
				desc = TCT_sainthood.2.desc.d
				desc = TCT_sainthood.2.desc.e
				desc = TCT_sainthood.2.desc.f
				desc = TCT_sainthood.2.desc.g
				desc = TCT_sainthood.2.desc.h
				desc = TCT_sainthood.2.desc.i
				desc = TCT_sainthood.2.desc.j
			}
		}
	}
	theme = travel_tour

	left_portrait = {
		character = scope:saint_person
		animation = dead
	}

	lower_right_portrait = {
		character = scope:chaplain
	}
	
	immediate = {
		scope:saint_person = { make_unprunable = yes }
		if = {
			limit = { exists = cp:councillor_court_chaplain	}
			cp:councillor_court_chaplain = { save_scope_as = chaplain }
		}
		else = {
			random_courtier = {	save_scope_as = chaplain }
		}
		if = {
			limit = { exists = root.primary_spouse }
			root.primary_spouse = { save_scope_as = advisor	}
		}
		else = {
			random_courtier = {
				limit = { NOT = { this = scope:chaplain } }
				save_scope_as = advisor
			}
		}
	}

	option = { # Endorse
		name = TCT_sainthood.2.a
		custom_tooltip = TCT_sainthood.2.info # Historical Context about Local Veneration
		scope:saint_capital_province = {
			add_province_modifier = {
				modifier = local_veneration
				years = 15
			}
		}
		if = {
			limit = {
				NOT = { scope:saint_capital_province.county.culture = root.culture }
			}
			root.culture = {
				change_cultural_acceptance = {
					target = scope:saint_capital_province.county.culture
					value = miniscule_cultural_acceptance_gain
					desc = cultural_acceptance_local_saint
				}
			}
		}
		trigger = {
			root.faith = scope:saint_person.faith
		}
		add_piety = 15
		remove_short_term_gold = tiny_gold_value
		trait = zealous
		stress_impact = {
			vengeful = medium_stress_impact_gain
			sadistic = minor_stress_impact_gain
			callous = minor_stress_impact_gain
			arbitrary = minor_stress_impact_gain
			wrathful = minor_stress_impact_gain
			greedy = minor_stress_impact_gain
			generous = miniscule_stress_impact_loss
		}

		ai_chance = {
			base = 125
			ai_value_modifier = {
				ai_zeal = 1
				ai_greed = -0.5
				ai_boldness = -0.5
			}
			modifier = {
				factor = 0
				OR = {
					has_trait = vengeful
					has_trait = sadistic
					has_trait = callous
					has_trait = arbitrary
					has_trait = wrathful
				}
			}
		}
	}

	option = { # Careful
		name = TCT_sainthood.2.b
		scope:saint_capital_province = {
			add_province_modifier = {
				modifier = local_veneration
				years = 10
			}
		}
		add_prestige = 15

		ai_chance = {
			base = 125
			ai_value_modifier = {
				ai_energy = -0.5
				ai_boldness = -0.5
			}
		}
	}

	option = { # Supress
		name = TCT_sainthood.2.c
		add_dread = minor_dread_gain
		scope:saint_capital_province.county = {
			add_county_modifier = {
				modifier = labor_instead_of_masses
				years = 10
			}
		}
		trigger = {
			OR = {
				has_trait = wrathful
				has_trait = vengeful
				has_trait = sadistic
				has_trait = callous
				has_trait = arbitrary
			}
		}
		if = {
			limit = {
				NOT = { scope:saint_capital_province.county.culture = root.culture }
			}
			root.culture = {
				change_cultural_acceptance = {
					target = scope:saint_capital_province.county.culture
					value = minor_cultural_acceptance_loss
					desc = cultural_acceptance_local_saint
				}
			}
		}
		trait = wrathful
		stress_impact = {
			wrathful = minor_stress_impact_loss
			vengeful = miniscule_stress_impact_loss
			sadistic = miniscule_stress_impact_loss
			callous = miniscule_stress_impact_loss
			arbitrary = miniscule_stress_impact_loss
			compassionate = major_stress_impact_gain
			forgiving = major_stress_impact_gain
		}

		ai_chance = {
			base = 50
			ai_value_modifier = {
				ai_boldness = 0.5
				ai_sociability = -0.5
			}
			modifier = {
				factor = 0
				OR = {
					has_trait = compassionate
					has_trait = forgiving
				}
			}
		}
	}
}

TCT_sainthood.3 = { # Diocesan Phase
	hidden = yes
	scope = faith

	trigger = {
		exists = scope:local_parish.barony.lessee
		exists = scope:saint_capital_province.province_owner
	}
	
	immediate = {
		scope:saint_capital_province.province_owner = {
			trigger_event = { # Notification about Diocesan Phase
				id = TCT_sainthood.4
			}
			liege ?= {
				if = {
					limit = {
						highest_held_title_tier < tier_kingdom
					}
					trigger_event = {
						id = TCT_sainthood.4
					}
				}
			}
		}
		trigger_event = { # Beatification
			id = TCT_sainthood.5
			#days = 20 #KGDEBUG
			years = { 1 3 }
		}
	}
}

# Notification about Episcopal Investigation / Diocesan Phase
TCT_sainthood.4 = {
	type = character_event
	title = TCT_sainthood.4.t
	desc = {
		first_valid = {
			random_valid = {
				triggered_desc = {
					trigger = {
						NOT = {	scope:chaplain = scope:local_bishop }
					}
					desc = TCT_sainthood.4.desc.a
				}
				triggered_desc = {
					trigger = {
						NOT = {	scope:chaplain = scope:local_bishop }
					}
					desc = TCT_sainthood.4.desc.b
				}
				triggered_desc = {
					trigger = {
						NOT = {	scope:chaplain = scope:local_bishop }
					}
					desc = TCT_sainthood.4.desc.c
				}
				triggered_desc = {
					trigger = {
						NOT = {	scope:chaplain = scope:local_bishop }
					}
					desc = TCT_sainthood.4.desc.d
				}
				triggered_desc = {
					trigger = {
						NOT = {	scope:chaplain = scope:local_bishop }
					}
					desc = TCT_sainthood.4.desc.e
				}
			}
			desc = TCT_sainthood.4.desc
		}
	}
	theme = vassal

	trigger = {
		exists = scope:local_parish.lessee
	}

	left_portrait = {
		character = root
		animation = idle
	}

	right_portrait = {
		character = scope:chaplain
		animation = chaplain
	}

	lower_right_portrait = {
		character = scope:local_bishop
		trigger = {
			NOT = {	scope:chaplain = scope:local_bishop }
		}
	}

	lower_left_portrait = {
		character = scope:saint_person
	}

	immediate = {
		scope:local_parish.lessee = {
			save_scope_as = local_bishop
		}
		if = {
			limit = { exists = faith.religious_head	}
			faith.religious_head = { save_scope_as = pope }
		}
		else = {
			random_courtier = {	save_scope_as = pope } # For localization
		}
		if = {
			limit = { exists = cp:councillor_court_chaplain	}
			cp:councillor_court_chaplain = { save_scope_as = chaplain }
		}
		else = {
			random_courtier = {	save_scope_as = chaplain }
		}
	}

	option = { # support
		name = TCT_sainthood.4.a
		custom_tooltip = TCT_sainthood.4.info # Historical Context about Diocesan Phase
		scope:local_bishop ?= {
			if = {
				limit = {
					exists = scope:chaplain
					NOT = {
						this = scope:chaplain
					}
				}
				add_opinion = {
					target = root
					modifier = TCT_opinion_supported_priest
				}
			}
		}
		scope:chaplain ?= {
			add_opinion = {
				target = root
				modifier = TCT_opinion_supported_priest
			}
		}
		add_piety = 15
		remove_short_term_gold = minor_gold_value
		trait = zealous

		stress_impact = {
			cynical = minor_stress_impact_gain
			zealous = miniscule_stress_impact_loss
		}

		ai_chance = {
			base = 100
			ai_value_modifier = {
				ai_zeal = 1
				ai_greed = -0.5
				ai_boldness = -0.5
			}
			modifier = {
				factor = 0
				OR = {
					has_trait = vengeful
					has_trait = sadistic
					has_trait = callous
					has_trait = arbitrary
					has_trait = wrathful
					has_trait = cynical
				}
			}
		}
	}

	option = { # reserved
		name = TCT_sainthood.4.b

		stress_impact = {
			zealous = minor_stress_impact_gain
		}

		ai_chance = {
			base = 125
		}
	}

	option = { # paranoid
		name = TCT_sainthood.4.c
		trigger = {
			has_trait = paranoid
			NOT = { has_trait = zealous }
			exists = faith.religious_head
		}
		trait = paranoid
		scope:local_bishop = {
			add_opinion = {
				modifier = annoyed_opinion
				target = root
				opinion = -20
			}
		}
		add_piety = medium_piety_loss

		stress_impact = {
			zealous = major_stress_impact_gain
			paranoid = minor_stress_impact_loss
		}

		ai_chance = {
			base = 50
			modifier = {
				factor = 0
				OR = {
					has_trait = compassionate
					has_trait = forgiving
				}
			}
		}
	}
}

TCT_sainthood.5 = { # Get current HoF
	hidden = yes
	scope = faith

	trigger = {
		exists = scope:saint_person.faith.religious_head
	}

	immediate = {
		#scope:saint_person.faith.religious_head = {
		#	trigger_event = TCT_sainthood.6
		#}
		scope:saint_person = {
			add_trait = beatified
			give_nickname = nick_the_blessed
			scope:saint_capital_province.province_owner = {
				if = {
					limit = {
						NOR = {
							is_vassal_of = scope:saint_person
							is_liege_or_above_of = scope:saint_person
							dynasty ?= scope:saint_person.dynasty
						}
					}
					trigger_event = TCT_sainthood.7
				}
				liege ?= {
					if = {
						limit = {
							NOR = {
								this = scope:saint_capital_province.province_owner
								is_vassal_of = scope:saint_person
								is_liege_or_above_of = scope:saint_person
								dynasty ?= scope:saint_person.dynasty
							}
							highest_held_title_tier < tier_empire
						}
						trigger_event = TCT_sainthood.7
					}
				}
			}
			every_vassal = {
				trigger_event = TCT_sainthood.7
			}
			dynasty ?= {
				every_dynasty_member = {
					trigger_event = TCT_sainthood.7
				}
			}
			#faith = { add_to_variable_list = { name = beatified target = scope:saint_person } } #KGDEBUG
		}
	}
}

#TCT_sainthood.6 = { # Beatification
#	title = TCT_sainthood.6.t
#	desc = {
#		random_valid = {
#			desc = TCT_sainthood.6.desc.a
#			desc = TCT_sainthood.6.desc.b
#			desc = TCT_sainthood.6.desc.c
#			desc = TCT_sainthood.6.desc.d
#			desc = TCT_sainthood.6.desc.e
#		}
#	}
#	theme = faith
#
#	left_portrait = {
#		character = root
#		animation = personality_rational
#	}
#
#	right_portrait = {
#		character = scope:saint_person
#		animation = dead
#	}
#
#	immediate = {
#		if = {
#			limit = { exists = scope:local_parish.barony.lessee	}
#			scope:local_parish.barony.lessee = { save_scope_as = local_bishop }
#		}
#		else_if = {
#			limit = { faith = faith:catholic }
#			random_living_cardinal = { save_scope_as = local_bishop }
#		}
#		else_if = {
#			limit = { exists = cp:councillor_court_chaplain	}
#			cp:councillor_court_chaplain = { save_scope_as = local_bishop }
#		}
#		else = { # Fallback
#			random_courtier = {	save_scope_as = local_bishop }
#		}
#	}
#
#	option = { # Let it be known!
#		name = TCT_sainthood.6.a
#		custom_tooltip =  TCT_sainthood.6.a.info
#		scope:saint_person = {
#			add_trait = beatified
#			faith = { add_to_variable_list = { name = beatified target = scope:saint_person } } #KGDEBUG
#		}
#		hidden_effect = {
#			scope:saint_person = {
#				give_nickname = nick_the_blessed
#				scope:saint_capital_province.province_owner = {
#					if = {
#						limit = {
#							NOR = {
#								is_vassal_of = scope:saint_person
#								is_liege_or_above_of = scope:saint_person
#								dynasty ?= scope:saint_person.dynasty
#							}
#						}
#						trigger_event = TCT_sainthood.7
#					}
#					liege ?= {
#						if = {
#							limit = {
#								NOR = {
#									this = scope:saint_capital_province.province_owner
#									is_vassal_of = scope:saint_person
#									is_liege_or_above_of = scope:saint_person
#									dynasty ?= scope:saint_person.dynasty
#								}
#								highest_held_title_tier < tier_empire
#							}
#							trigger_event = TCT_sainthood.7
#						}
#					}
#				}
#				every_vassal = {
#					trigger_event = TCT_sainthood.7
#				}
#				dynasty ?= {
#					every_dynasty_member = {
#						trigger_event = TCT_sainthood.7
#					}
#				}
#			}
#		}
#
#		ai_chance = {
#			base = 100
#		}
#	}
#
#	option = { # no
#		name = TCT_sainthood.6.b
#		custom_tooltip = TCT_sainthood.6.b.info
#		scope:local_parish.province_owner = {
#			add_opinion = {
#				modifier = disappointed_opinion
#				target = root
#				opinion = -10
#			}
#		}
#		ai_chance = {
#			base = 0
#		}
#	}
#}

# Family and acquaintances respond to beatification
TCT_sainthood.7 = { # A Blessed has Passed
	title = TCT_sainthood.7.t
	desc = {
		random_valid = {
			desc = TCT_sainthood.7.desc.a
			desc = TCT_sainthood.7.desc.b
			desc = TCT_sainthood.7.desc.c
			desc = TCT_sainthood.7.desc.d
			desc = TCT_sainthood.7.desc.e
		}
	}
	theme = travel
	#theme = family

	left_portrait = {
		character = scope:saint_person
		animation = dead
	}

	option = {
		name = TCT_sainthood.7.a # ok
		custom_tooltip = TCT_sainthood.7.a.info
		add_piety = 10
	}
}

TCT_sainthood.8 = { # Get current HoF
	hidden = yes
	scope = faith
	
	immediate = {
		scope:saint_person ?= {
			if = {
				limit = { has_trait = beatified }
				faith.religious_head ?= {
					trigger_event = TCT_sainthood.9
				}
			}
		}
	}
}

TCT_sainthood.9 = { # A Saint in the Making
	type = character_event
	title = TCT_sainthood.9.t
	desc = {
		random_valid = {
			desc = TCT_sainthood.9.desc.a
			desc = TCT_sainthood.9.desc.b
			desc = TCT_sainthood.9.desc.c
			desc = TCT_sainthood.9.desc.d
		}
	}
	theme = family
	
	left_portrait = {
		character = root
		animation = personality_rational
	}
	
	right_portrait = {
		character = scope:cardinal # Random courtier for non-catholics
		animation = chancellor
	}

	lower_right_portrait = {
		character = scope:saint_person
	}
	
	immediate = {
		hidden_effect = {
			if = {
				limit = { faith = faith:catholic }
				random_living_cardinal = { save_scope_as = cardinal }
			}
			else_if = {
				limit = { exists = cp:councillor_court_chaplain	}
				cp:councillor_court_chaplain = { save_scope_as = cardinal }
			}
			else = {
				random_courtier = {	save_scope_as = cardinal }
			}

			faith = {
				trigger_event = {
					id = TCT_sainthood.10
					#months = 1 #KGDEBUG
					years = { 2 5 }
				}
			}
		}
	}

	option = { # May God guide our discernment
		name = TCT_sainthood.9.a
		custom_tooltip = TCT_sainthood.9.info #Historical Context about Roman Phase
		add_piety = 10
	}
}

TCT_sainthood.10 = { # Get current HoF
	hidden = yes
	scope = faith
	
	immediate = {
		scope:saint_person.faith.religious_head ?= {
			trigger_event = TCT_sainthood.11
		}
	}
}

TCT_sainthood.11 = { # Positio is presented to the Pope
	title = TCT_sainthood.11.t
	desc = {
		random_valid = {
			desc = TCT_sainthood.11.desc.a
			desc = TCT_sainthood.11.desc.b
			desc = TCT_sainthood.11.desc.c
			desc = TCT_sainthood.11.desc.d
			desc = TCT_sainthood.11.desc.e
		}
	}
	theme = faith

	left_portrait = {
		character = scope:canonizer_person # HoF
		animation = personality_rational
	}

	right_portrait = {
		character = scope:saint_person
		animation = dead
	}

	immediate = {
		save_scope_as = canonizer_person
	}

	option = {
		name = TCT_sainthood.11.a #So it shall!
		custom_tooltip = TCT_sainthood.11.a.info

		scope:saint_person = {
			hidden_effect = {
				random_list = {
					1 = {
						give_nickname = nick_the_pious
					}
					1 = {
						give_nickname = nick_the_holy
					}
					3 = {
						trigger = { has_trait = theologian }
						give_nickname = nick_the_theologian
					}
					3 = {
						trigger = { has_trait = scholar }
						give_nickname = nick_the_enlightened
					}
					1 = {
						give_nickname = nick_the_confessor
					}
					3 = {
						trigger = {	has_trait = chaste }
						give_nickname = nick_the_chaste
					}
					3 = {
						trigger = {
							OR = {
								has_trait = intellect_good_3
								has_trait = shrewd
								has_trait = intellect_good_1
								learning >= 15
							}
						}
						give_nickname = nick_the_wise
					}
					3 = {
						trigger = {	has_trait = pilgrim	}
						give_nickname = nick_the_pilgrim
					}
					1 = {
						give_nickname = nick_the_divine
					}
					10 = {
						trigger = {	martyrs_death_trigger = yes	}
						give_nickname = nick_the_martyr
					}
					15 = {
						trigger = {	has_perk = architect_perk }
						give_nickname = nick_the_architect
					}
					1 = {
						trigger = { has_trait = temperate }
						give_nickname = nick_the_ascetic
					}
					2 = {
						trigger = {	has_trait = compassionate }
						give_nickname = nick_the_merciful_saint
					}
					3 = {
						trigger = {	has_trait = zealous	}
						give_nickname = nick_the_zealous
					}
					1 = {
						give_nickname = nick_the_venerable_saint
					}
					3 = {
						trigger = { has_trait = poet }
						give_nickname = nick_the_bard_saint
					}
					2 = {
						trigger = {	has_trait = just }
						give_nickname = nick_the_just
					}
					2 = {
						trigger = {	highest_held_title_tier >= tier_kingdom	}
						give_nickname = nick_the_great
					}
					1 = {
						give_nickname = nick_the_apostle_saint
					}
					15 = {
						trigger = {
							is_male = no
							has_trait = chaste
							is_married = no
							number_of_current_and_former_spouses = 0
							any_child = {
								count = 0
							}
							any_relation = {
								type = lover
								count = 0
							}
						}
						give_nickname = nick_the_virgin
					}
					#3 = {
					#	give_nickname = nick_of_province
					#}
					1 = {
						give_nickname = nick_the_enlightener
					}
					5 = {
						trigger = { has_trait = lifestyle_mystic }
						give_nickname = nick_the_miracle_worker_saint
					}
					10 = {
						trigger = { has_trait = holy_warrior }
						give_nickname = nick_hammer_of_heretics
					}
					15 = {
						trigger = {
							scope:saint_capital_province = {
								terrain = desert
							}
						}
						give_nickname = nick_of_the_desert
					}
					15 = {
						trigger = {	has_trait = flagellant }
						give_nickname = nick_the_flagellant
					}
				}
			
				if = {
					limit = {
						OR = {
							faith = faith:iconoclast
							faith = faith:nestorian
							faith = faith:insular_celtic
							faith =	faith:paulician
							faith = faith:orthodox
							faith =	faith:catholic
							faith = faith:coptic
						}
					}
					faith = {
						every_faith_ruler = {
							limit = {
								NOT = { this = scope:canonizer_person }
							}
							trigger_event = TCT_sainthood.12
						}
					}
				}
			}

			scope:saint_capital_province = {
				if = {
					limit = { has_province_modifier = local_veneration }
					remove_province_modifier = local_veneration
				}
				add_province_modifier = saintly_tomb
				county = {
					add_to_variable_list = {
						name = faith_saints_and_capital
						target = scope:saint_person
					}
				}
				set_variable = {
					name = saint_day_saint
					value = scope:saint_person
				}
			}

			faith = {
				add_to_variable_list = {
					name = faith_capital
					target = scope:saint_capital_province
				}
				change_fervor = {
					value = 1
					desc = TCT_fervor_gain_canonized
				}
			}

			if = {
				limit = {
					has_trait = beatified
				}
				remove_trait = beatified
			}
			if = {
				limit = {
					NOT = { has_trait = saint }
				}
				add_trait = saint
			}
			become_saint = yes
		}

		ai_chance = {
			base = 50
			modifier = {
				factor = 1.5
				culture = scope:saint_person.culture
			}
			modifier = {
				add = 40
				scope:saint_person = { martyrs_death_trigger = yes }
			}
			modifier = {
				add = 10
				scope:saint_person = {
					has_trait = zealous
				}
			}
			modifier = {
				add = 100
				scope:saint_capital_province = {
					has_variable = player_veneration
				}
			}
		}
	}

	option = { # no
		name = TCT_sainthood.11.b
		custom_tooltip = TCT_sainthood.11.b.info

		ai_chance = {
			base = 50
			modifier = {
				add = 5
				has_trait = lazy
			}
			modifier = {
				factor = 1.5
				has_trait = cynical
			}
			modifier = {
				add = 10
				sainthood_pious_bishop = no
			}
		}
	}

	after = {
		scope:saint_capital_province = {
			remove_variable = player_veneration
		}
	}
}

TCT_sainthood.12 = {
	title = TCT_sainthood.12.t
	desc = {
		random_valid = {
			desc = TCT_sainthood.12.desc.a
			desc = TCT_sainthood.12.desc.b
			desc = TCT_sainthood.12.desc.c
			desc = TCT_sainthood.12.desc.d
			desc = TCT_sainthood.12.desc.e
			desc = TCT_sainthood.12.desc.f
			desc = TCT_sainthood.12.desc.g
			desc = TCT_sainthood.12.desc.h
		}
	}
	theme = faith
	left_portrait = {
		character = scope:saint_person
		animation = dead
	}
	trigger = {
		OR = {
			NOR = {
				has_character_flag = notified_of_sainthood
				has_character_flag = saint_humbug
			}
			AND = {
				exists = dynasty
				exists = scope:saint_person.dynasty
				dynasty = scope:saint_person.dynasty
			}
		}
	}

	immediate = {
		scope:saint_person.faith.religious_head = {
			save_scope_as = canonizer_person
		}
		play_music_cue = Trinity_2
		add_character_flag = {
			flag = notified_of_sainthood
			years = 10
		}
	}

	option = {
		name = TCT_sainthood.12.a
	}
	option = {
		name = TCT_sainthood.12.b
		custom_tooltip = TCT_sainthood.12.b.tooltip
		add_character_flag = saint_humbug
	}
}

TCT_sainthood.101 = {
	hidden = yes

	trigger = {
		has_trait = saint
	}

	immediate = {
		save_scope_as = saint_person
		
		# Save the location where the saint person died
		if = {
			limit = { exists = capital_province }
			capital_province = { save_scope_as = saint_capital_province }
		}
		else_if = {
			limit = { exists = location }
			location = { save_scope_as = saint_capital_province }
		}

		# Continue only if we have fetched a valid location
		if = {
			limit = {
				exists = scope:saint_capital_province
			}

			#Save the death date for Saint's Day Feast Activity
			scope:saint_capital_province = {
				if = { limit = { current_month = 1 } set_variable = { name = saint_person_death_date value = 1 } }
				else_if = { limit = { current_month = 2 } set_variable = { name = saint_person_death_date value = 2 } }
				else_if = { limit = { current_month = 3 } set_variable = { name = saint_person_death_date value = 3 } }
				else_if = { limit = { current_month = 4 } set_variable = { name = saint_person_death_date value = 4 } }
				else_if = { limit = { current_month = 5 } set_variable = { name = saint_person_death_date value = 5 } }
				else_if = { limit = { current_month = 6 } set_variable = { name = saint_person_death_date value = 6 } }
				else_if = { limit = { current_month = 7 } set_variable = { name = saint_person_death_date value = 7 } }
				else_if = { limit = { current_month = 8 } set_variable = { name = saint_person_death_date value = 8 } }
				else_if = { limit = { current_month = 9 } set_variable = { name = saint_person_death_date value = 9 } }
				else_if = { limit = { current_month = 10 } set_variable = { name = saint_person_death_date value = 10 } }
				else_if = { limit = { current_month = 11 } set_variable = { name = saint_person_death_date value = 11 } }
				else_if = { limit = { current_month = 12 } set_variable = { name = saint_person_death_date value = 12 } }
			}

			#Instantly skip process to canonization, why even matter
			scope:saint_person.faith.religious_head ?= {
				trigger_event = TCT_sainthood.11
			}
		}
	}
}