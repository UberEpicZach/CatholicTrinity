namespace = KoH_sainthood


KoH_sainthood.1 = {
	hidden = yes

	trigger = {
		sainthood_event1trigger = yes
	}

	immediate = {
		save_scope_as = saint_person

		if = { #Location of local veneration
			limit = {
				exists = capital_province
			}
			capital_province = {
				save_scope_as = saint_capital_province
			}
		}
		else_if = {
			limit = {
				exists = host.capital_province
			}
			host.capital_province = {
				save_scope_as = saint_capital_province
			}
		}
		else = {
			location.province_owner.capital_province = {
				save_scope_as = saint_capital_province
			}
		}

		scope:saint_capital_province.province_owner.liege = { #Decision if to be Beatified /  Start episcopal investigation
			random_vassal_or_below = {
				limit = {
					is_landed = yes
					is_clergy = yes
					has_faith = scope:saint_person.faith
				}
				random = { #TO DO move to KoH_sainthood.2 AI option weights
           	    chance = 100
					modifier = {
           	        factor = 0.25
						scope:saint_person = {
							dynasty ?= {
								has_dynasty_modifier = saintly_bloodline
							}
						}
					}
					modifier = {
           	        factor = 0.8
						scope:saint_person = {
							has_trait = cynical
						}
					}
					trigger_event = {
						id = KoH_sainthood.4
						days = { 180 200 }
					}
					scope:saint_person.faith = {
						add_to_variable_list = { name = beatified target = scope:saint_person }
					}
				}
			}
		}
	}
}


#KoH_sainthood.2 = { #Decision if to be Beatified TO DO add Flavor text
#	hidden = yes
#
#	immediate = {
#		trigger_event = { id = KoH_sainthood.4 days = { 180 200 } }
#
#		scope:saint_person = {
#			add_character_flag = beatified
#		}
#	}
#}

#Why do we need this?
#KoH_sainthood.3 = { #triggered from the S_effect / Checking time left to Canonization
#	hidden = yes
#
#	immediate = {
#		top_liege = { trigger_event = { id = KoH_sainthood.7 days = { 1000 1500 } }
#		}
#	}
#}


KoH_sainthood.4 = { # HF.40002 Decision has been made to be Beatified
	hidden = yes

	immediate = {
		if = {
			limit = {
				scope:saint_person.faith.religious_head = {
					#add_character_flag = popemansainttesting
					has_religion = religion:christianity_religion
				}
			}
			scope:saint_person = {
				add_trait = beatified
				give_nickname = nick_the_blessed
				make_unprunable = yes
				every_vassal = {
					trigger_event = KoH_sainthood.6
				}
				dynasty ?= {
					every_dynasty_member = {
						trigger_event = KoH_sainthood.6
					}
				}
				top_liege ?= {
					trigger_event = KoH_sainthood.6
				}
				
				#Potential for sainthood
				random = {
					chance = 10 #make 1
			
					#Cynical people are less likely to be Canonized
					modifier = {
						factor = 0.8
						has_trait = cynical
					}
			
					#Reduced chance for Popes / Antipopes to become Saints
					modifier = {
						factor = 0.4
						OR = {
							has_title = title:k_papal_state
							#has_claim_on = title:k_papal_state
						}
					}
			
					#Have to be a Christian denomination with a potential Religious head, and have been singled out for Beatification
					modifier = {
						factor = 0
						scope:saint_person = {
							has_trait = beatified
						}
						NOR = {
							scope:saint_person.faith = faith:catholic
							scope:saint_person.faith = faith:orthodox
							scope:saint_person.faith = faith:iconoclast
							scope:saint_person.faith = faith:nestorian
							scope:saint_person.faith = faith:insular_celtic
							scope:saint_person.faith = faith:paulician
							scope:saint_person.faith = faith:coptic
						}
					}
			
					#Religions without a Religious Head cannot Canonize
					modifier = {
						factor = 0 
			
						# Why was this so hard to write?
						NOT = { exists = scope:saint_person.faith.religious_head }
					}
					
					#Eastern Christians have a lower chance of becoming Saints
					modifier = {
						factor = 0.8
						OR = {
							# Why did I have to fix this? You had it properly done just above
							scope:saint_person.faith = faith:iconoclast
							scope:saint_person.faith = faith:nestorian
							scope:saint_person.faith = faith:insular_celtic
							scope:saint_person.faith = faith:paulician
							scope:saint_person.faith = faith:orthodox
							scope:saint_person.faith = faith:coptic
						}
					}
					#Players who don't have a saintly bloodline have a higher chance of becoming a Saint
					modifier = {
						factor = 2
						scope:saint_person = {
							is_ai = no
						}
						NOT = {
							scope:saint_person = {
								exists = dynasty
								dynasty = {
									has_dynasty_modifier = saintly_bloodline
								}
							}
						}
					}
			
					#Positive has_has_traits increase your chances of becoming a Saint
					modifier = {
						factor = 1.5
						scope:saint_person = {
							has_trait = patient
						}
					}
					modifier = {
						factor = 1.5
						scope:saint_person = {
							has_trait = diligent
						}
					}
					modifier = {
						factor = 1.5
						scope:saint_person = {
							has_trait = compassionate
						}
					}
					modifier = {
						factor = 1.5
						scope:saint_person = {
							has_trait = chaste
						}
					}
					modifier = {
						factor = 1.5
						scope:saint_person = {
							has_trait = generous
						}
					}
					modifier = {
						factor = 1.5
						scope:saint_person = {
							has_trait = temperate
						}
					}
					modifier = {
						factor = 1.5
						scope:saint_person = {
							has_trait = humble 
						}
					}
					modifier = {
						factor = 1.2
						scope:saint_person = {
							has_trait = just
						}
					}
					modifier = {
						factor = 1.2
						scope:saint_person = {
							has_trait = holy_warrior
						}
					}
					#modifier = { #TO DO
					#	factor = 1.2
					#	scope:saint_person = {
					#		is_martyr = yes
					#	}
					#}
		
					#Having the bloodline of a Saint severely decrease your chance of becoming a Saint
					modifier = {
						factor = 0.2
						scope:saint_person.dynasty ?= {
							has_dynasty_modifier = saintly_bloodline
						}
					}
		
					#Extra high piety increases your chance of becoming a Saint
					# It's >= for christs' sake!
					modifier = {
						factor = 1.2
						piety >= 1000
					}
					modifier = {
						factor = 1.2 
						piety >= 1500
					}
					modifier = {
						factor = 1.2
						piety >= 2000
					}
					modifier = {
						factor = 1.2
						piety >= 2500
					}
					modifier = {
						factor = 1.2
						piety >= 3000
					}
					modifier = {
						factor = 1.2
						piety >= 3500
					}
					modifier = {
						factor = 1.2
						piety >= 4000
					}
					modifier = {
						factor = 1.2
						piety >= 4500
					}
					modifier = {
						factor = 1.2
						piety >= 5000
					}
					modifier = {
						factor = 1.2
						piety >= 5500
					}
					modifier = {
						factor = 1.2
						piety >= 6000
					}
					modifier = {
						factor = 1.2
						piety >= 6500
					}
					modifier = {
						factor = 1.2 
						piety >= 7000
					}
					modifier = {
						factor = 1.2
						piety >= 7500
					}
					modifier = {
						factor = 1.2
						piety >= 8000
					}
					modifier = {
						factor = 1.2
						piety >= 8500
					}
					modifier = {
						factor = 1.2
						piety >= 9000
					}
					modifier = {
						factor = 1.2
						piety >= 9500
					}
					modifier = {
						factor = 1.3 #kek
						piety >= 10000
					}
			
					#Level of Piety
					modifier = {
						factor = {
							value = 1
							add = {
								add = piety_level
								multiply = 0.2
							}
						}
					}
			
					#First Saint of a Religion is easier
					modifier = {
						factor = 3
						# Switches are your friend, Uber...
						scope:saint_person = {
							switch = {
								trigger = faith
								faith:iconoclast = { NOT = { has_global_variable = iconoclast_saint } }
								faith:nestorian = { NOT = { has_global_variable = nestorian_saint } }
								faith:insular_celtic = { NOT = { has_global_variable = insular_celtic_saint } }
								faith:paulician = { NOT = { has_global_variable = paulician_saint } }
								faith:orthodox = { NOT = { has_global_variable = orthodox_saint } }
								faith:catholic = { NOT = { has_global_variable = catholic_saint } }
								faith:coptic = { NOT = { has_global_variable = coptic_saint } }
							}
						}
					}
			
					# What even is this?!
					#random_realm_province.holder.top_liege = {
					#	trigger_event = KoH_sainthood.3
					#}
					scope:saint_person.faith.religious_head ?= {
						trigger_event = {
							id = KoH_sainthood.7
							days = { 1000 1500 }
						}
					}
					# change_variable = { 
					# 	name = global_saint_number 
					# 	add = 1 
					# }
			
					scope:saint_person = {
						switch = {
							trigger = scope:saint_person.faith
							faith:iconoclast = { set_global_variable = iconoclast_saint }
							faith:nestorian = { set_global_variable = nestorian_saint }
							faith:insular_celtic = { set_global_variable = insular_celtic_saint }
							faith:paulician = { set_global_variable = paulician_saint }
							faith:orthodox = { set_global_variable = orthodox_saint }
							faith:catholic = { set_global_variable = catholic_saint }
							faith:coptic = { set_global_variable = coptic_saint }
						}
					}
				}
				# scope:saint_person = {
				# 	# send_interface_toast = {
				# 	# 	title = "Saintest Event 1"
			
				# 	# 	left_icon = root
				# 	# }
				# }
			}
		}
	}
}

#beatified #Merged in KoH_sainthood.4
#KoH_sainthood.5 = {
#	hidden = yes
#
#	immediate = {
#		add_trait = beatified
#		give_nickname = nick_the_blessed
#		every_vassal = {
#			trigger_event = KoH_sainthood.6
#		}
#		dynasty ?= {
#			every_dynasty_member = {
#				trigger_event = KoH_sainthood.6
#			}
#		}
#		top_liege ?= {
#			trigger_event = KoH_sainthood.6
#		}
#	}
#}

#Family Responds to beatified
KoH_sainthood.6 = {
	title = KoH_sainthood.6.t
	desc = KoH_sainthood.6.desc
	theme = family

	left_portrait = {
		character = scope:saint_person
	}

	option = {
		name = KoH_sainthood.6.a

		add_piety = 10
	}
}


KoH_sainthood.7 = { ##Preparing Canonization
	hidden = yes

	trigger = {
        scope:saint_person = {
			has_trait = beatified
		}
	}

	immediate = { 
		if = {
			limit = {
				scope:saint_capital_province.province_owner = {
					has_religion = religion:christianity_religion
				}
			}
			scope:saint_capital_province.province_owner.faith.religious_head = {
				trigger_event = KoH_sainthood.8
			}
		}
		else = {
			scope:saint_person.faith.religious_head = {
				trigger_event = KoH_sainthood.8
			}
		}
	}
}

KoH_sainthood.8 = {
	title = KoH_sainthood.8.t
	desc = KoH_sainthood.8.desc
	theme = family

	left_portrait = {
		character = root
	}

	right_portrait = {
		character = scope:saint_person
	}

	option = {
		name = KoH_sainthood.8.a #So it shall!

		scope:saint_person = {
			random_list = {
				1 = {
					give_nickname = nick_the_pious
				}
				1 = {
					give_nickname = nick_the_holy
				}
				3 = {
					trigger = {
						has_trait = theologian
					}
					give_nickname = nick_the_theologian
				}
				3 = {
					trigger = {
						has_trait = scholar
					}
					give_nickname = nick_the_enlightened
				}
				1 = {
					give_nickname = nick_the_confessor
				}
				3 = {
					trigger = {
						has_trait = chaste
					}
					give_nickname = nick_the_chaste
				}
				3 = {
					trigger = {
						OR = {
							has_trait = intellect_good_3
							has_trait = shrewd
							has_trait = intellect_good_1
							learning >= 15
						}
					}
					give_nickname = nick_the_wise
				}
				3 = {
					trigger = {
						has_trait = pilgrim
					}
					give_nickname = nick_the_pilgrim
				}
				1 = {
					give_nickname = nick_the_divine
				}
				10 = {
					trigger = {
						martyrs_death_trigger = yes
					}
					give_nickname = nick_the_martyr
				}
				15 = {
					trigger = {
						has_perk = architect_perk
					}
					give_nickname = nick_the_architect
				}
			}

			if = {
				limit = {
					OR = {
						faith = faith:iconoclast
						faith = faith:nestorian
						faith = faith:insular_celtic
						faith =	faith:paulician
						faith = faith:orthodox
						faith =	faith:catholic
						faith = faith:coptic
					}
				}
				faith = {
					every_faith_ruler = {
						trigger_event = KoH_sainthood.9
					}
				}
			}

			scope:saint_capital_province = { #TO DO do this earlier
				add_province_modifier = saintly_tomb
				county = {
					add_to_variable_list = {
						name = faith_saints_and_capital
						target = scope:saint_person
					}
				}
			}

			faith = {
				add_to_variable_list = {
					name = faith_capital
					target = scope:saint_capital_province
				}
			}

			remove_trait = beatified
			add_trait = saint	
			become_saint = yes
		}
	}
}

KoH_sainthood.9 = {
	title = KoH_sainthood.9.t
	desc = KoH_sainthood.9.desc
	theme = faith
	left_portrait = {
		character = scope:saint_person
	}

	immediate = {
		play_music_cue = Trinity_2
	}

	option = {
		name = KoH_sainthood.9.a

	}
}