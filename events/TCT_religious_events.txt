namespace = TCT_religious_events


TCT_religious_events.1 = { #A Pope and His Estates
	title = TCT_religious_events.1.t
	desc = TCT_religious_events.1.desc
	theme = unfriendly
	left_portrait = {
		character = this
	}

	trigger = {		
		root.faith = faith:catholic
		exists = faith:catholic.religious_head
		faith:catholic.religious_head = {
			has_title = title:k_papal_state
			dynasty = root.dynasty 
		}
		title:k_papal_state.holder = { 
			NOT = { 
				OR = { 
					has_trait = greedy 
					has_trait = zealous 
				} 
			} 
		}

		OR = {
			any_sibling = {
				is_male = yes
				is_ruler = no
				root.primary_title = {
					place_in_line_of_succession = {
					  target = PREV
					  value > 2
					}
				}
			}
			any_child = {
				is_male = yes
				is_ruler = no
				root.primary_title = {
					place_in_line_of_succession = {
					  target = PREV
					  value > 2
					}
				}
			}
		}
	}

	immediate = {
		scripted_effect_popethingevent = yes
	}

	option = { 
		name = TCT_religious_events.1.a
			scope:player_one = {
				add_opinion = {
					target = title:k_papal_state.holder 
					opinion = 100
					modifier = grateful_opinion
				} 
				add_opinion = {
					target = ROOT
					opinion = 100
					modifier = grateful_opinion
				} 

				set_employer = title:k_papal_state.holder 
				add_character_modifier = {
					modifier = TCT_governs_vast_estates
					years = 5
				}
			}

			scope:player_two = { 
				add_opinion = {
					target = title:k_papal_state.holder 
					opinion = 100
					modifier = grateful_opinion
				} 

				reverse_add_opinion = {
					target = ROOT
					opinion = 100
					modifier = grateful_opinion
				} 
				set_employer = title:k_papal_state.holder 
				add_character_modifier = {
					modifier = TCT_governs_vast_estates
					years = 5
				}
			}
			
			title:k_papal_state.holder = {
				add_opinion = {
					target = scope:player_one
					opinion = 20
					modifier = grateful_opinion
				} 

				add_opinion = {
					target = scope:player_two
					opinion = 20
					modifier = grateful_opinion
				} 

				add_opinion = {
					target = ROOT
					opinion = 15
					modifier = grateful_opinion
				}
			}
		
		ai_chance = {
			base = 100
		}
	}

	# option = {
	# 	name = TCT_religious_events.1.b

	# 	add_piety = 50

	# 	title:k_papal_state.holder = {
	# 		add_opinion = {
	# 			target = ROOT
	# 			opinion = -15
	# 			modifier = disappointed_opinion
	# 		}
	# 	}
	# }

	# option = {
	# 	name = TCT_religious_events.1.c
	# 	trigger = {
	# 		OR = {
	# 			has_trait = zealous
	# 			learning <= 10
	# 		}
	# 	add_piety = 50

	# 	title:k_papal_state.holder = {
	# 		add_opinion = {
	# 			target = ROOT
	# 			opinion = -15
	# 			modifier = disappointed_opinion
	# 		}
	# 		add_piety = -100
	# 	}
	# 	add_piety = 200
	# 	add_learning_skill = 1
	# 	}
	# }
}

TCT_religious_events.2 = { #Monks Make Good Beer
	title = TCT_religious_events.2.t
	desc = TCT_religious_events.2.desc
	theme = learning_scholarship_focus
	left_portrait = {
		character = this
	}
	right_portrait = {
		character = scope:monk
	}

	trigger = {		
		is_commanding_army = no
		is_adult = yes
		is_imprisoned = no
		has_religion = religion:christianity_religion
		# OR = {
		# 	location = {
		# 		region = world_europe_west
		# 	}
		# 	location = {
		# 		region = world_europe_south
		# 	}
		# }
	}

	immediate = {
		create_character = {
			location = root.capital_province
			age = { 25 35 }
			gender = male
			trait = education_learning_3
			trait = devoted
			faith = root.faith
			culture = root.culture
			learning = { 10 12 }
			save_scope_as = monk
		}
	}

	option = { 
		name = TCT_religious_events.2.a

		if = {
			limit = { NOT = { has_trait = drunkard } }
			random = {
				chance = 20
				add_trait = drunkard
				send_interface_toast = {
					type = event_toast_effect_bad
					title =  TCT_religious_events.2.a.drunkard # TCT_religious_events.2.a.drunkard
					left_icon = root
				}
			}
		}

		ai_chance = {
			base = 50
		}
	}

	option = { 
		name = TCT_religious_events.2.b

		if = {
			limit = { NOT = { has_trait = temperate } }
			random = {
				chance = 20
				add_trait = temperate
				send_interface_toast = {
					type = event_toast_effect_good
					title =  TCT_religious_events.2.b.temperate
					left_icon = root
				}
			}
		}

		ai_chance = {
			base = 50
		}
	}
	after = {
		hidden_effect = {
			scope:monk = {
				death = {
					death_reason = death_vanished
				}
			}
		}
	}
}

TCT_religious_events.3 = { #Monks Make Good Wine
	title = TCT_religious_events.3.t
	desc = TCT_religious_events.3.desc
	theme = learning_scholarship_focus
	left_portrait = {
		character = this
	}

	right_portrait = {
		character = scope:monk
	}

	trigger = {		
		is_commanding_army = no
		is_adult = yes
		is_imprisoned = no
		has_religion = religion:christianity_religion
		# OR = {
		# 	location = {
		# 		region = world_europe_west
		# 	}
		# 	location = {
		# 		region = world_europe_south
		# 	}
		# }
	}

	immediate = {
		create_character = {
			location = root.capital_province
			age = { 25 35 }
			gender = male
			trait = education_learning_3
			trait = devoted
			faith = root.faith
			culture = root.culture
			learning = { 10 12 }
			save_scope_as = monk
		}
	}

	option = { 
		name = TCT_religious_events.3.a

		random = {
			chance = 50
			add_learning_skill = 1
		}
		if = {
			limit = { NOT = { has_trait = drunkard } }
			random = {
				chance = 20
				add_trait = drunkard
				send_interface_toast = {
					type = event_toast_effect_bad
					title = TCT_religious_events.2.a.drunkard
					left_icon = root
				}
			}
		}

		ai_chance = {
			base = 50
		}
	}

	option = { 
		name = TCT_religious_events.3.b

		if = {
			limit = { NOT = { has_trait = temperate } }
			random = {
				chance = 20
				add_trait = temperate
				send_interface_toast = {
					type = event_toast_effect_good
					title = TCT_religious_events.2.b.temperate
					left_icon = root
				}
			}
		}

		ai_chance = {
			base = 50
		}
	}
	after = {
		hidden_effect = {
			scope:monk = {
				death = {
					death_reason = death_vanished
				}
			}
		}
	}
}

TCT_religious_events.4 = { #Monks have healing herbs
	title = TCT_religious_events.4.t
	desc = TCT_religious_events.4.desc
	theme = learning_scholarship_focus
	left_portrait = {
		character = this
	}
	right_portrait = {
		character = scope:monk
	}
	override_background = { reference = garden }

	trigger = {		
		is_commanding_army = no
		is_adult = yes
		is_imprisoned = no
		piety_level >= 1
		OR = {
			has_trait = ill
		}
		has_religion = religion:christianity_religion
		# OR = {
		# 	location = {
		# 		region = world_europe_west
		# 	}
		# 	location = {
		# 		region = world_europe_south
		# 	}
		# }
	}

	immediate = {
		create_character = {
			location = root.capital_province
			age = { 25 35 }
			gender = male
			trait = education_learning_3
			trait = devoted
			faith = root.faith
			culture = root.culture
			learning = { 10 12 }
			save_scope_as = monk
		}
	}

	option = { 
		name = TCT_religious_events.4.a

		random = {
			chance = 30
			remove_trait = ill
		}

		ai_chance = {
			base = 80
		}
	}

	option = { 
		name = TCT_religious_events.4.b

		if = {
			limit = { NOT = { has_trait = paranoid } }
			add_trait = paranoid
		}
	}
	after = {
		hidden_effect = {
			scope:monk = {
				death = {
					death_reason = death_vanished
				}
			}
		}
	}
}

TCT_religious_events.5 = { #Monks is fantastic painter
	title = TCT_religious_events.5.t
	desc = TCT_religious_events.5.desc
	theme = learning_scholarship_focus
	left_portrait = {
		character = this
	}
	right_portrait = {
		character = scope:monk
	}
	override_background = {
		reference = farmland
	}

	trigger = {		
		is_commanding_army = no
		is_adult = yes
		is_imprisoned = no
		has_religion = religion:christianity_religion
		NOT = { has_trait = blind }
		# OR = {
		# 	location = {
		# 		region = world_europe_west
		# 	}
		# 	location = {
		# 		region = world_europe_south
		# 	}
		# }
	}

	immediate = {
		create_character = {
			location = root.capital_province
			age = { 25 35 }
			gender = male
			trait = education_learning_3
			trait = devoted
			faith = root.faith
			culture = root.culture
			learning = { 10 12 }
			save_scope_as = monk
		}
	}

	option = { 
		name = TCT_religious_events.5.a

		remove_short_term_gold = 10
		add_prestige = 30
	}

	option = { 
		name = TCT_religious_events.5.b

	}
	after = {
		hidden_effect = {
			scope:monk = {
				death = {
					death_reason = death_vanished
				}
			}
		}
	}
}

TCT_religious_events.6 = { #Monks is fantastic painter
	title = TCT_religious_events.6.t
	desc = TCT_religious_events.6.desc
	theme = learning_scholarship_focus
	left_portrait = {
		character = this
	}
	right_portrait = {
		character = scope:monk
	}

	trigger = {		
		is_commanding_army = no
		is_adult = yes
		is_imprisoned = no
		has_religion = religion:christianity_religion
		NOT = { has_trait = blind }
		# OR = {
		# 	location = {
		# 		region = world_europe_west
		# 	}
		# 	location = {
		# 		region = world_europe_south
		# 	}
		# }
	}

	immediate = {
		create_character = {
			location = root.capital_province
			age = { 25 35 }
			gender = male
			trait = education_learning_3
			trait = devoted
			faith = root.faith
			culture = root.culture
			learning = { 10 12 }
			save_scope_as = monk
		}
	}

	option = { 
		name = TCT_religious_events.6.a

		remove_short_term_gold = 10
		add_prestige = 30
	}

	option = { 
		name = TCT_religious_events.6.b

	}
	after = {
		hidden_effect = {
			scope:monk = {
				death = {
					death_reason = death_vanished
				}
			}
		}
	}
}

TCT_religious_events.7 = { #Monks is fantastic painter
	title = TCT_religious_events.7.t
	desc = TCT_religious_events.7.desc
	theme = learning_scholarship_focus
	left_portrait = {
		character = this
	}
	right_portrait = {
		character = scope:monk
	}

	trigger = {		
		is_commanding_army = no
		is_adult = yes
		is_imprisoned = no
		has_religion = religion:christianity_religion
		# OR = {
		# 	location = {
		# 		region = world_europe_west
		# 	}
		# 	location = {
		# 		region = world_europe_south
		# 	}
		# }
	}

	immediate = {
		create_character = {
			location = root.capital_province
			age = { 25 35 }
			gender = male
			trait = education_learning_3
			trait = devoted
			faith = root.faith
			culture = root.culture
			learning = { 10 12 }
			save_scope_as = monk
		}
	}

	option = { 
		name = TCT_religious_events.7.a

		remove_short_term_gold = 30
		add_prestige = 30
		random = {
			chance = 20
			add_learning_skill = 1
		}
	}
	option = { 
		name = TCT_religious_events.7.b

	}
	after = {
		hidden_effect = {
			scope:monk = {
				death = {
					death_reason = death_vanished
				}
			}
		}
	}
}

TCT_religious_events.8 = { #Monastery Monks"
	title = TCT_religious_events.8.t
	desc = TCT_religious_events.8.desc
	theme = learning_scholarship_focus
	left_portrait = {
		character = this
	}
	right_portrait = {
		character = scope:monk
	}

	trigger = {		
		is_commanding_army = no
		is_adult = yes
		is_imprisoned = no
		has_religion = religion:christianity_religion
		# OR = {
		# 	location = {
		# 		region = world_europe_west
		# 	}
		# 	location = {
		# 		region = world_europe_south
		# 	}
		# }
	}

	immediate = {
		create_character = {
			location = root.capital_province
			age = { 25 35 }
			gender = male
			trait = education_learning_3
			trait = devoted
			faith = root.faith
			culture = root.culture
			learning = { 10 12 }
			save_scope_as = monk
		}
	}

	option = { 
		name = TCT_religious_events.8.a

		add_piety = 20

		random = {
			chance = 30
			add_learning_skill = 1
		}
	}
	option = { 
		name = TCT_religious_events.8.b
		random_list = {
			30 = {
				if = {
					limit = { NOT = { has_trait = cynical } }
					add_trait = cynical
				}
			}
			60 = {

			}
		}
	}

	after = {
		hidden_effect = {
			scope:monk = {
				death = {
					death_reason = death_vanished
				}
			}
		}
	}
}

TCT_religious_events.9 = { #Child wants to be monk/nun - select child
	title = TCT_religious_events.9.t
	desc = TCT_religious_events.9.desc
	theme = learning_scholarship_focus
	left_portrait = {
		character = this
	}
	right_portrait = {
		character = scope:childforthechurch
	}

	trigger = {		
		triggerforTCT_religious_events9 = yes
	}

	immediate = {
		save_scope_as = parentofchild
		random_child = {
			limit = {
				is_ruler = no
				age >= 13
				NOT = { age >= 16 }
				NOT = { has_trait = cynical }
				NOT = { is_clergy = yes }
			}
			save_scope_as = childforthechurch
		}
	}

	option = { 
		name = TCT_religious_events.9.a
		#custom_tooltip = TCT_religious_events.9.a.tt 
	
		scope:childforthechurch = {
			send_child_to_clergy_effect_for_events = yes

			if = {
				limit = {
					scope:parentofchild.top_liege = {
						any_vassal_or_below = {
							has_government = theocracy_government
							primary_title.tier > tier_barony
							faith = scope:parentofchild.faith
						}
					}
				}
				scope:parentofchild.top_liege = {
					random_vassal_or_below = {
						limit = {
							has_government = theocracy_government
							primary_title.tier > tier_barony
							faith = scope:parentofchild.faith
						}
						save_scope_as = theocratic_travel_target
					}
				}
				visit_court_of = scope:theocratic_travel_target
				set_relation_guardian = scope:theocratic_travel_target 
			}
			else_if = {
				limit = {
					exists = scope:parentofchild.capital_province
				}
				move_to_pool_at = scope:parentofchild.capital_province
			}

			add_opinion = {
				target = ROOT
				opinion = 50
				modifier = grateful_opinion
			}
		}
	}

	option = { 
		name = TCT_religious_events.9.b
		scope:childforthechurch = {
			add_stress = major_stress_loss
			add_opinion = {
				target = ROOT
				opinion = -150
				modifier = angry_opinion
			}
		}
	}

}

TCT_religious_events.12 = { #Donate to local monastery
	title = TCT_religious_events.12.t
	desc = TCT_religious_events.12.desc
	theme = learning_scholarship_focus
	left_portrait = {
		character = this
	}
	right_portrait = {
		character = scope:monk
	}
	trigger = {		
		is_commanding_army = no
		is_adult = yes
		is_imprisoned = no
		has_religion = religion:christianity_religion
	}

	immediate = {
		create_character = {
			location = root.capital_province
			age = { 25 35 }
			gender = male
			trait = education_learning_3
			trait = devoted
			faith = root.faith
			culture = root.culture
			learning = { 10 12 }
			save_scope_as = monk
		}
	}

	option = { 
		name = TCT_religious_events.12.a
		remove_short_term_gold = 30
		add_piety = 30
	}
	
	option = { 
		name = TCT_religious_events.12.b
		add_piety = -30
	}
	after = {
		hidden_effect = {
			scope:monk = {
				death = {
					death_reason = death_vanished
				}
			}
		}
	}
}

TCT_religious_events.13 = { #Duty-Bound
	title = TCT_religious_events.13.t
	desc = TCT_religious_events.13.desc
	theme = learning_scholarship_focus
	right_portrait = {
		character = scope:Priest
	}
	lower_right_portrait = {
		character = scope:lover
	}

	trigger = {		
		has_religion = religion:christianity_religion
		any_vassal_or_below = {
			AND = {
				age >= 19
				has_government = theocracy_government
				OR = {
					has_trait = lifestyle_reveler
					has_trait = drunkard
					has_trait = lustful 
				}
			} 
		}
	}

	immediate = {
		random_vassal_or_below = {
			limit = {
				AND = {
					age >= 19
					has_government = theocracy_government
					OR = {
						has_trait = lifestyle_reveler
						has_trait = drunkard
						has_trait = lustful 
					}
				}
			}
			save_scope_as = Priest 
		}

		create_character = {
			template = beautiful_peasant_character
			age = { 17 22 }
			gender_female_chance = root_attraction_based_female_chance
			employer = scope:Priest.host
			faith = scope:Priest.host.faith
			culture = scope:Priest.host.culture
			save_scope_as = lover
		}

		scope:Priest = {
			set_relation_lover = scope:lover
		}
	}

	option = { 
		name = TCT_religious_events.13.a
		
		scope:Priest = {
			give_deviant_secret_or_trait_effect = yes

			if = {
				limit = { exists = dynasty }
				dynasty = {
					add_dynasty_prestige = medium_dynasty_prestige_loss
				}
			}
			add_piety = -1
			add_piety_level = -1
		}
	}
}

TCT_religious_events.14 = { #Duty-Bound - Varaint
	title = TCT_religious_events.14.t
	desc = TCT_religious_events.14.desc
	theme = learning_scholarship_focus
	right_portrait = {
		character = scope:Priest
	}
	lower_right_portrait = {
		character = scope:lover
	}

	trigger = {		
		has_religion = religion:christianity_religion

		exists = dynasty
		dynasty = { 
			any_dynasty_member = { 
				is_alive = yes
				age >= 18
				dynasty = root.dynasty
				has_government = theocracy_government
				OR = {
					has_trait = lifestyle_reveler
					has_trait = drunkard
					has_trait = lustful 
				}
			}
		}
	}

	immediate = {
		dynasty = { 
			every_dynasty_member = { 
				if = {
					limit = {
						is_alive = yes
						age >= 18
						AND = {
							dynasty = root.dynasty
							has_government = theocracy_government
							OR = {
								has_trait = lifestyle_reveler
								has_trait = drunkard
								has_trait = lustful 
							}
						}
					}
					save_scope_as = Priest
				} 
			}
		}

		create_character = {
			template = beautiful_peasant_character
			age = { 17 22 }
			gender_female_chance = root_attraction_based_female_chance
			employer = scope:Priest.host
			faith = scope:Priest.host.faith
			culture = scope:Priest.host.culture
			save_scope_as = lover
		}

		scope:lover = {
			set_relation_lover = scope:Priest
		}
	}

	option = { 
		name = TCT_religious_events.14.a
		
		scope:Priest = {
			give_deviant_secret_or_trait_effect = yes

			if = {
				limit = { exists = dynasty }
				dynasty = {
					add_dynasty_prestige = medium_dynasty_prestige_loss
				}
			}
			add_piety = -1
			add_piety_level = -1
		}
	}
}

#The Death of A Bishop: Appoint Investiture 
TCT_religious_events.15 = {
	title = TCT_religious_events.15.t
	desc = TCT_religious_events.15.desc
	theme = faith

	left_portrait = {
		character = root
		animation = thinking
	}

	lower_right_portrait = {
		character = faith.religious_head
	}


	immediate = {
		scope:dying_bishop.primary_title = {
			save_scope_as = bishop_title
		}	
	}

	# I care, let me choose!
	option = {
		name = TCT_religious_events.15.a

		trigger_event = {
			id = TCT_religious_events.16
		}

		ai_chance = {
			base = 100
		}
	}

	# Let the Pope decide
	option = {
		name = TCT_religious_events.15.b

		ai_chance = {
			base = 0
		}
	}
}


scripted_effect get_investiture_characters = {
	clear_variable_list = possible_characters

	every_dynasty_member = {
		limit = {
			OR = {
				has_trait = devoted
				has_education_learning_trigger = yes
			}
			is_landed = no
			is_female = no
			is_adult = yes
			NOT = { any_heir_to_title = { exists = this } }
		}
		add_to_list = possible_characters
	}
	every_sibling = {
		limit = {
			OR = {
				has_trait = devoted
				has_education_learning_trigger = yes
			}
			is_landed = no
			is_female = no
			is_adult = yes
			NOT = { any_heir_to_title = { exists = this } }
		}
		add_to_list = possible_characters
	}
	every_child = {
		limit = {
			OR = {
				has_trait = devoted
				has_education_learning_trigger = yes
			}
			is_landed = no
			is_adult = yes
			is_female = no
			NOT = { any_heir_to_title = { exists = this } }
		}
		add_to_list = possible_characters
	}

	every_courtier_or_guest = {
		limit = {
			OR = {
				AND = {
					is_councillor_of = root
					has_council_position = councillor_court_chaplain
				}
				AND = {
					NOT = {
						AND = {
							court_owner = { has_realm_law = male_only_law }
							is_female = yes
						}
						AND = {
							court_owner = { has_realm_law = male_preference_law }
							is_female = yes
						}
						AND = {
							court_owner = { has_realm_law = female_only_law }
							is_female = no
						}
						AND = {
							court_owner = { has_realm_law = female_preference_law }
							is_female = no
						}
						has_variable = theocratic_successor
						father = liege_or_court_owner
						mother = liege_or_court_owner
						primary_spouse = liege_or_court_owner
					}
				}
			}
			AND = {
				#And they have to actually like you enough to want to invest you.
				opinion = {
					target = root
					value >= 0
				}
				learning >= 7
			}
			has_faith = root.faith
		}
		add_to_list = possible_characters
	}
}

#The Death of A Bishop: Appoint Investiture
TCT_religious_events.16 = {
	title = TCT_religious_events.16.t
	desc = TCT_religious_events.16.desc
	theme = faith

	left_portrait = {
		character = root
		animation = thinking
	}

	lower_right_portrait = {
		character = faith.religious_head
	}

	# trigger = {
	# 	scope:bishop_title = {
	# 		OR = {
	# 			liege = {
	# 				OR = {
	# 					has_realm_law = free_investiture_early
	# 					has_realm_law = free_investiture_late
	# 				}
	# 			}
	# 		}
	# 	}
	# }

	
	widget = {
		gui = "event_window_character_selection"
		container = "custom_widgets_container"
	}

	immediate = {
		dynasty = {
			every_dynasty_member = {
				limit = {
					OR = {
						has_trait = devoted
						has_education_learning_trigger = yes
					}
					is_landed = no
					is_female = no
					is_adult = yes
					NOT = { any_heir_to_title = { exists = this } }
				}
				root = {
					add_to_variable_list = {
						name = possible_characters
						target = prev
					}
				}
			}
		}
		every_sibling = {
			limit = {
				OR = {
					has_trait = devoted
					has_education_learning_trigger = yes
				}
				is_landed = no
				is_female = no
				is_adult = yes
				NOT = { any_heir_to_title = { exists = this } }
			}
			root = {
				add_to_variable_list = {
					name = possible_characters
					target = prev
				}
			}
		}
		every_child = {
			limit = {
				OR = {
					has_trait = devoted
					has_education_learning_trigger = yes
				}
				is_landed = no
				is_adult = yes
				is_female = no
				NOT = { any_heir_to_title = { exists = this } }
			}
			root = {
				add_to_variable_list = {
					name = possible_characters
					target = prev
				}
			}
		}
	
		every_courtier_or_guest = {
			limit = {
				OR = {
					AND = {
						is_councillor_of = root
						has_council_position = councillor_court_chaplain
					}
					AND = {
						NOT = {
							AND = {
								court_owner = { has_realm_law = male_only_law }
								is_female = yes
							}
							AND = {
								court_owner = { has_realm_law = male_preference_law }
								is_female = yes
							}
							AND = {
								court_owner = { has_realm_law = female_only_law }
								is_female = no
							}
							AND = {
								court_owner = { has_realm_law = female_preference_law }
								is_female = no
							}
							has_variable = theocratic_successor
							father = liege_or_court_owner
							mother = liege_or_court_owner
							primary_spouse = liege_or_court_owner
						}
					}
				}
				AND = {
					#And they have to actually like you enough to want to invest you.
					opinion = {
						target = root
						value >= 0
					}
					learning >= 7
				}
				has_faith = root.faith
			}
			root = {
				add_to_variable_list = {
					name = possible_characters
					target = prev
				}
			}
		}

		# every_living_character = {
		# 	root = {
		# 		add_to_variable_list = {
		# 			name = possible_characters
		# 			target = prev
		# 		}
		# 	}
		# }
	}
	
	# Let Me Decide!
	option = {
		name = TCT_religious_events.16.a
        if = {
            limit = {
                exists = var:si_selected_character
            }
			var:si_selected_character = {
				save_scope_as = new_bishop
			}
			
			scope:bishop_title.holder = {
				save_scope_as = papal_appointed_bishop
			}

			scope:new_bishop = {
				create_title_and_vassal_change = {
					type = granted
					save_scope_as = title_change
					add_claim_on_loss = no
				}
				scope:bishop_title = {
					change_title_holder = {
						holder = scope:new_bishop
						change = scope:title_change
					}
				}
				resolve_title_and_vassal_change = scope:title_change
			}
		}


		#ADD CATALYST, SEND EVENT TO POPE SAYING YOU APPOINTED A NEW BISHOP, OVERRIDING HIS DECISION


		ai_chance = {
			base = 0
		}
	}
}

#cardinal names
TCT_religious_events.22 = {
	hidden = yes

	immediate = {
		every_living_cardinal = {
			add_prestige = 1
			if = {
				limit = {
					is_landed = no
				}
				add_trait = cardinal_priest
			}
			if = {
				limit = {
					is_landed = yes
					highest_held_title_tier >= tier_duchy
					NOT = { this = character:7853 }
				}
				add_trait = cardinal_archbishop
			}
			else_if = {
				limit = {
					is_landed = yes
					NOT = { this = character:7853 }
				}
				add_trait = cardinal_bishop
			}
		}
	}
}

#cardinal election won
TCT_religious_events.23 = {
	hidden = yes
	orphan = yes
	immediate = {
		send_interface_toast = {
			title = CardinalElectionWon				
			right_icon = prev
			
			custom_tooltip = HookGainedTCT
		}
	}
}

#The Pope and an Investiture Free Realm
# The Pope singles out a Kingdom with Free Investiture (unless he has already targetted one)
#Event 1
TCT_religious_events.24 = { 
	title = TCT_religious_events.24.t
	desc = TCT_religious_events.24.desc
	theme = learning_scholarship_focus
	left_portrait = {
		character = this
	}
	right_portrait = {
		character = scope:popewantsit
	}
	
	trigger = {		
		has_title = title:k_papal_state
		this = faith.religious_head
		is_imprisoned = no
		has_religion = religion:christianity_religion
		has_faith = faith:catholic
		current_year >= 1040
		#change_fervor = -20
		faith = { fervor >= 50 }
		exists = global_var:dictatuspapae

		any_independent_ruler = {
			OR = {
				has_realm_law = free_investiture_early
				has_realm_law = free_investiture_late
			}
			highest_held_title_tier >= tier_duchy
			has_faith = faith:catholic
			title:k_papal_state.holder = faith.religious_head

			NOR = {
				has_character_flag = pope_wants_our_law_changed
				has_character_flag = pope_respects_our_law	
			}
		}
	}

	immediate = {
		random_independent_ruler = {
			limit = {
				OR = {
					has_realm_law = free_investiture_early
					has_realm_law = free_investiture_late
				}
				highest_held_title_tier >= tier_duchy
				has_faith = faith:catholic
				title:k_papal_state.holder = faith.religious_head

				NOR = {
					has_character_flag = pope_wants_our_law_changed
					has_character_flag = pope_respects_our_law	
				}
			}
			save_scope_as = popewantsit
		}
	}

	option = { 
		name = TCT_religious_events.24.a
		add_character_flag = pope_currently_demanding

		if = {
			limit = {
				scope:popewantsit = {
					OR = {
						has_realm_law = free_investiture_early
						has_realm_law = free_investiture_late
					}
					highest_held_title_tier >= tier_duchy
					has_faith = faith:catholic
					faith.religious_head = PREV

					NOR = {
						has_character_flag = pope_wants_our_law_changed
						has_character_flag = pope_respects_our_law	
					}
				}
			}
			scope:popewantsit = {
				add_character_flag = pope_wants_our_law_changed

				trigger_event = {
					id = TCT_religious_events.25
					days = 14
				}
			}
		}
		#custom_tooltip = TCT_religious_events.24 #EVTTOOLTIP67001

		ai_chance = {	
			base = 100
		
		}
	}
	
	option = { 
		name = TCT_religious_events.24.b
		

		ai_chance = { 
			base = 0 
		}
	}
}

#King/Emperor gets the papal emissary asking them to change laws!
#Event 2
TCT_religious_events.25 = { 
	title = TCT_religious_events.25.t
	desc = TCT_religious_events.25.desc
	theme = learning_scholarship_focus
	left_portrait = {
		character = scope:popewantsit
	}
	right_portrait = {
		character = faith.religious_head
	}
	
	trigger = {		
		OR = {
			has_realm_law = free_investiture_early
			has_realm_law = free_investiture_late
		}
		highest_held_title_tier >= tier_duchy
		has_faith = faith:catholic
	}

	immediate = {
		save_scope_as = popewantsit

		faith.religious_head = {
			save_scope_as = popeman
		}
	}

	weight_multiplier = {
		base = 1
		modifier = {
			add = { #-1 at 5 learning, 0 at 10 learning, 1 at 15 learning etc.
				value = learning
				subtract = medium_skill_rating
				multiply = 0.2
			}
		}
	}

	option = { 
		name = TCT_religious_events.25.a # Fold to demand
		
		trigger = {
			OR = {
				AND = {
					is_ai = no
				}
				AND = {
					NOT = {
						has_trait = cynical
						is_ai = yes
					}
				}
			}
		}
		
		if = {
			limit = {
				has_realm_law = free_investiture_early
			}
			remove_realm_law = free_investiture_early
			add_realm_law_skip_effects = papal_investiture_early
		}
		if = {
			limit = {
				has_realm_law = free_investiture_late
			}
			remove_realm_law = free_investiture_late
			add_realm_law_skip_effects = papal_investiture_late
		}
		
		
		add_piety = 25
		faith = {
			change_fervor = {
				value = 2
				desc = increased_fervor
			}
		}

		faith.religious_head = {
			add_opinion = {
				target = PREV
				opinion = 10
				modifier = changed_investiture_law
			}
			
			trigger_event = {
				id = TCT_religious_events.26
				days = 1
			}
		}

		hidden_effect = {
			remove_character_flag = pope_wants_our_law_changed

			faith.religious_head = {
				remove_character_flag = pope_currently_demanding
			}
		}

		ai_chance = {
			base = 1	
			modifier = {
				factor = 8
				has_trait = zealous
			}
		}
	}

	option = { 
		name = TCT_religious_events.25.b # Refuse
		
		add_piety = -25
		faith = {
			change_fervor = {
				value = 2
				desc = increased_fervor
			}
		}

		add_character_flag = pope_we_refuse_law_changed

		faith.religious_head = {
			add_opinion = {
				target = PREV
				opinion = -20
				modifier = refused_changed_investiture_law
			}
			trigger_event = {
				id = TCT_religious_events.27
				days = 1
			}
		}
		ai_chance = { 
			base = 1 
		
			modifier = {
				factor = 1.5
				has_trait = arbitrary
			}

			modifier = {
				factor = 1.5
				has_trait = cynical
			}

			modifier = {
				factor = 1.5
				has_trait = lifestyle_reveler
			}
		}

	}

	option = { 
		name = TCT_religious_events.25.c ## Give gold to Pope / Bribe Pope
		trigger = { 
			gold >= 200

			OR = {
				AND = {
					is_ai = no
				}
				AND = {
					is_ai = yes
					NOT = {
						has_trait = zealous
					}
				}
			}
		}

		hidden_effect = {
			faith.religious_head = {
				remove_character_flag = pope_currently_demanding
				trigger_event = {
					id = TCT_religious_events.28
					days = 1
				}
			}
		}

		ai_chance = { 
			base = 1 
		
			modifier = {
				factor = 4
				has_trait = cynical
			}

			modifier = {
				factor = -3
				has_trait = greedy
			}
		}
	}

	option = { 
		name = TCT_religious_events.25.d ## Impress with Learning
		
		duel = {
			skill = learning
			target = scope:popeman
			# value = medium_skill_rating
			# desc = outcome_in_a_few_days
			60 = {		
				desc = TCT_religious_events.29.d.success
				compare_modifier = {
					value = scope:duel_value
					multiplier = 5
				}
				custom_tooltip = TCT_religious_events.29.d.success.tt
				scope:popeman = { trigger_event = { id = TCT_religious_events.29 days = 5 } } #You outwit the pope!
				
			}
			40 = {		
				desc = TCT_religious_events.29.d.failure
				compare_modifier = {
					value = scope:duel_value
					multiplier = -5
				}
				custom_tooltip = TCT_religious_events.29.d.failure.tt
				scope:popeman = { trigger_event = { id = TCT_religious_events.30 days = 5 } } #You fail to outwit the pope!
			}
		}

		ai_chance = { 
			base = 3
		}
	}
}

## King accepts
#Event 3
TCT_religious_events.26 = { 
	title = TCT_religious_events.26.t
	desc = TCT_religious_events.26.desc
	theme = learning_scholarship_focus
	left_portrait = {
		character = scope:popewantsit
	}

	right_portrait = {
		character = faith.religious_head
	}

	option = { 
		name = TCT_religious_events.26.a
		
		add_prestige = 100

		ai_chance = {	
			base = 100
		
		}
	}
}

## King refuses us
#Event 4
TCT_religious_events.27 = { 
	title = TCT_religious_events.27.t
	desc = TCT_religious_events.27.desc
	theme = learning_scholarship_focus
	left_portrait = {
		character = scope:popewantsit
	}

	right_portrait = {
		character = faith.religious_head
	}

	option = { 
		name = TCT_religious_events.27.a
		
		add_prestige = 100

		ai_chance = {	
			base = 100
		
		}
	}
}

## King bribes us
#Event 5
TCT_religious_events.28 = { 
	title = TCT_religious_events.28.t
	desc = TCT_religious_events.28.desc
	theme = learning_scholarship_focus
	left_portrait = {
		character = scope:popewantsit
	}

	right_portrait = {
		character = faith.religious_head
	}

	option = { #accept bribe
		name = TCT_religious_events.28.a
		
		custom_tooltip = TCT_religious_events.28.a.tt

		scope:popewantsit = {
			pay_short_term_gold = {
				gold = 200	# Todo: Adjust this?
				target = faith.religious_head
			}
	
			add_character_flag = pope_respects_our_law
			remove_character_flag = pope_wants_our_law_changed
		}

		scope:popewantsit = {
			send_interface_toast = {
				type = event_toast_effect_good
				title = TCT_religious_events.28.a.toast
				left_icon = faith.religious_head
				
			}
		}

		ai_chance = {	
			base = 1
		
			modifier = {
				add = 25
				has_trait = greedy
			}

			modifier = {
				add = 0.75
				has_trait = cynical
			}
			modifier = {
				add = 2
				has_trait = ambitious
			}
			modifier = {
				add = -1
				has_trait = craven
			}
			modifier = {
				add = -2
				has_trait = content
			}
			modifier = {
				add = -0.75
				has_trait = zealous
			}
			modifier = {
				add = 1
				has_trait = lazy
			}
			modifier = {
				add = 0.5
				has_trait = stubborn
			}
			modifier = {
				add = 0.5
				has_trait = fickle
			}
			modifier = {
				add = 1
				has_trait = greedy
			}
			modifier = {
				add = -2
				has_trait = humble
			}
			modifier = {
				add = 2
				has_trait = arrogant
			}
			modifier = {
				add = -0.5
				has_trait = just
			}
		}
	}

	option = { #decline bribe
		name = TCT_religious_events.28.b
		custom_tooltip = TCT_religious_events.28.b.tt
		add_opinion = {
			target = scope:popewantsit
			opinion = -20
			modifier = impious_opinion
		}

		scope:popewantsit = {
			send_interface_toast = {
				type = event_toast_effect_bad
				title = TCT_religious_events.28.b.toast
				left_icon = faith.religious_head
			}
		}

		ai_chance = {	
			base = 1
	
			modifier = {
				add = -25
				has_trait = greedy
			}
			modifier = {
				add = -0.75
				has_trait = cynical
			}
			modifier = {
				add = -2
				has_trait = ambitious
			}
			modifier = {
				add = 1
				has_trait = craven
			}
			modifier = {
				add = 2
				has_trait = content
			}
			modifier = {
				add = 0.75
				has_trait = zealous
			}
			modifier = {
				add = 1
				has_trait = lazy
			}
			modifier = {
				add = 0.5
				has_trait = stubborn
			}
			modifier = {
				add = -0.5
				has_trait = fickle
			}
			modifier = {
				add = -1
				has_trait = greedy
			}
			modifier = {
				add = 2
				has_trait = humble
			}
			modifier = {
				add = -2
				has_trait = arrogant
			}
			modifier = {
				add = 0.5
				has_trait = just
			}
		}
	}
}

# King outwits us
#Event 6
TCT_religious_events.29 = { 
	title = TCT_religious_events.29.t
	desc = TCT_religious_events.29.desc
	theme = learning_scholarship_focus
	left_portrait = {
		character = scope:popewantsit
	}

	right_portrait = {
		character = faith.religious_head
	}

	option = { 
		name = TCT_religious_events.29.a
		
		add_piety = -5

		scope:popewantsit = {
			add_character_flag = pope_respects_our_law
			remove_character_flag = pope_wants_our_law_changed
		}
		hidden_effect = {
			faith.religious_head = {
				remove_character_flag = pope_currently_demanding
				add_character_modifier = {
					modifier = public_opinion_negative
					days = 365
				}
			}
		}

		scope:popewantsit = {
			send_interface_toast = {
				type = event_toast_effect_good
				title = TCT_religious_events.29.b.toast
				left_icon = faith.religious_head
			}
		}

		ai_chance = {	
			base = 100
		
		}
	}
}

# King failed to outwit us
#Event 6
TCT_religious_events.30 = { 
	title = TCT_religious_events.30.t
	desc = TCT_religious_events.30.desc
	theme = learning_scholarship_focus
	left_portrait = {
		character = scope:popewantsit
	}

	right_portrait = {
		character = faith.religious_head
	}

	option = { 
		name = TCT_religious_events.30.a
		custom_tooltip = TCT_religious_events.30.a.tt
		add_piety = 100

		add_opinion = {
			modifier = impious_opinion
			opinion = -15
			target = scope:popewantsit
		}

		add_opinion = {
			target = scope:popewantsit
			opinion = 10
			modifier = refused_changed_investiture_law
		}

		scope:popewantsit = {
			add_character_modifier = {
				modifier = public_opinion_negative
				days = 365
			}
			add_character_flag = pope_we_refuse_law_changed
		}
		
		scope:popewantsit = {
			send_interface_toast = {
				type = event_toast_effect_bad
				title = TCT_religious_events.30.a.toast
				left_icon = faith.religious_head
			}
		}

		ai_chance = {	
			base = 100
		}
	}
}

## The Pope sends a delegate to a Bishop whose top liege has refused to change investiture Law
#Event 7
TCT_religious_events.31 = { 
	title = TCT_religious_events.31.t
	desc = TCT_religious_events.31.desc
	theme = learning_scholarship_focus
	right_portrait = {
		character = faith.religious_head
	}
	left_portrait = {
		character = scope:bishop
	}

	trigger = {		
		has_title = title:k_papal_state
		this = faith.religious_head
		is_imprisoned = no
		has_religion = religion:christianity_religion
		has_faith = faith:catholic
		current_year >= 1040
		exists = global_var:dictatuspapae
		#change_fervor = -20
		faith = { fervor >= 50 }

		any_independent_ruler = {
			OR = {
				has_realm_law = free_investiture_early
				has_realm_law = free_investiture_late
			}
			highest_held_title_tier >= tier_duchy
			has_faith = faith:catholic
			title:k_papal_state.holder = faith.religious_head

			has_character_flag = pope_we_refuse_law_changed
			NOR = { has_character_flag = pope_respects_our_law }	
		}
	}

	immediate = {
		random_independent_ruler = {
			limit = {
				OR = {
					has_realm_law = free_investiture_early
					has_realm_law = free_investiture_late
				}
				highest_held_title_tier >= tier_duchy
				has_faith = faith:catholic
				title:k_papal_state.holder = faith.religious_head
				has_character_flag = pope_we_refuse_law_changed
			}
			save_scope_as = popewantsit
		}
		if = {
			limit = {
				scope:popewantsit = {
					any_vassal = {
						NOT = { has_character_flag = pope_bribing }
						has_government = theocracy_government
						#And they have to actually like you enough to want to invest you.
						opinion = {
							target = scope:popewantsit
							value <= -10
						}
						opinion = {
							target = scope:popewantsit.faith.religious_head
							value >= 10
						}
					}
				}
			}
			scope:popewantsit = {
				random_vassal = {
					limit = {
						has_government = theocracy_government
						opinion = {
							target = scope:popewantsit
							value <= -10
						}
						opinion = {
							target = scope:popewantsit.faith.religious_head
							value >= 10
						}
					}
					save_scope_as = bishop
				}
			}
		}
	}
		

	option = { 
		name = TCT_religious_events.31.a
		custom_tooltip = TCT_religious_events.31a.tta
		custom_tooltip = TCT_religious_events.31a.ttb
		show_as_tooltip = {
			pay_short_term_gold = {
				target = scope:bishop
				gold = 120
			}
		}
		scope:bishop = { 
			add_character_flag = pope_bribing

			trigger_event = {
				id = TCT_religious_events.32
				days = 15
			}
		}

		ai_chance = {	
			base = 75

			modifier = {
				add = 25
				has_trait = zealous
			}
		}
	}
	option = { 
		name = TCT_religious_events.31.b
	
		remove_character_flag = pope_currently_demanding

		scope:popewantsit = {
			remove_character_flag = pope_we_refuse_law_changed
		}

		ai_chance = {	
			base = 10

			modifier = {
				add = -75
				has_trait = zealous
			}
		}
	}
}

## The Bishop receives the Papal emissary
#Event 8
TCT_religious_events.32 = { 
	title = TCT_religious_events.32.t
	desc = TCT_religious_events.32.desc
	theme = learning_scholarship_focus
	left_portrait = {
		character = scope:bishop
	}

	right_portrait = {
		character = faith.religious_head
	}

	option = { 
		name = TCT_religious_events.32.a
		
		faith.religious_head = {
			pay_short_term_gold = {
				target = scope:bishop
				gold = 120
			}
		}
		scope:bishop = {
			add_opinion = {
				target = faith.religious_head
				opinion = 20
				modifier = bishop_bribed_by_pope
			}
		}

		random_list = {
			66 = { # Suceed
				send_interface_toast = {
					type = event_toast_effect_good
					title = TCT_religious_events.32.a.toast # TCT_religious_events.2.a.drunkard
					left_icon = root
				}
			}
		
		
			33 = { # Emperror finds out
				custom_tooltip = TCT_religious_events.32.a.tt

				scope:popewantsit = {
					trigger_event = {
						id = TCT_religious_events.33
						days = { 14 16 }
					}
				}
				send_interface_toast = {
					type = event_toast_effect_bad
					title = TCT_religious_events.32.b.toast # TCT_religious_events.2.a.drunkard
					left_icon = root
				}
			}
		}

		ai_chance = {	
			base = 100
		
		}
	}
	option = { 
		name = TCT_religious_events.32.b

		add_prestige = 10
	}
}

## King knows of bishop getting bribed
#Event 9
TCT_religious_events.33 = { 
	title = TCT_religious_events.33.t
	desc = TCT_religious_events.33.desc
	theme = learning_scholarship_focus
	left_portrait = {
		character = scope:bishop
	}

	right_portrait = {
		character = faith.religious_head
	}

	option = { 
		name = TCT_religious_events.33.a
		
		random_list = {
			30 = {
				add_trait = cynical
			}
			1 = {
				add_trait = paranoid
			}
			60 = {

			}
		}

		add_opinion = {
			target = scope:bishop
			modifier = suspicion_opinion
			opinion = -15
		}

		add_opinion = {
			target = faith.religious_head
			modifier = suspicion_opinion
			opinion = -15
		}

		ai_chance = {	
			base = 100
		
		}
	}
	option = { 
		name = TCT_religious_events.33.b

		trigger = {
			has_trait = paranoid
		}

		random_list = {
			30 = { 
				imprison = {
					target = scope:bishop
					type = dungeon
				}
				add_excommunication_actual_effect = yes
				add_tyranny = 40
			}
			60 = {
				add_stress = medium_stress_loss
				add_tyranny = 40
				add_excommunication_actual_effect = yes
			}
		}
	}
}

## The Pope contacts a powerful (preferably rebellious) vassal of a liege who has refused to change investiture Law
#Event 10
TCT_religious_events.34 = { 
	title = TCT_religious_events.34.t
	desc = TCT_religious_events.34.desc
	theme = learning_scholarship_focus
	right_portrait = {
		character = faith.religious_head
	}
	left_portrait = {
		character = scope:powerful_vassal
	}

	trigger = {		
		has_title = title:k_papal_state
		this = faith.religious_head
		is_imprisoned = no
		has_religion = religion:christianity_religion
		has_faith = faith:catholic
		current_year >= 1040
		exists = global_var:dictatuspapae
		#change_fervor = -20
		faith = { fervor >= 50 }

		any_independent_ruler = {
			OR = {
				has_realm_law = free_investiture_early
				has_realm_law = free_investiture_late
			}
			highest_held_title_tier >= tier_duchy
			has_faith = faith:catholic
			title:k_papal_state.holder = faith.religious_head

			has_character_flag = pope_we_refuse_law_changed
			NOR = { has_character_flag = pope_respects_our_law }	
		}
	}

	immediate = {
		random_independent_ruler = {
			limit = {
				OR = {
					has_realm_law = free_investiture_early
					has_realm_law = free_investiture_late
				}
				highest_held_title_tier >= tier_county
				has_faith = faith:catholic
				title:k_papal_state.holder = faith.religious_head
				has_character_flag = pope_we_refuse_law_changed
			}
			save_scope_as = popewantsit
			primary_title = {
				save_scope_as = primarytitle
			}
		}
		if = {
			limit = {
				scope:popewantsit = {
					any_vassal = { 
						max_military_strength >= liege.max_military_strength.div2
					}
					NOT = { has_character_flag = pope_bribing }
					has_faith = scope:popewantsit.faith
					opinion = {
						target = scope:popewantsit
						value <= -10
					}
					opinion = {
						target = scope:popewantsit.faith.religious_head
						value >= 10
					}
				}
			}
			scope:popewantsit = {
				random_vassal = {
					limit = {
						max_military_strength >= liege.max_military_strength.div2
						opinion = {
							target = scope:popewantsit
							value <= -10
						}
						opinion = {
							target = scope:popewantsit.faith.religious_head
							value >= 10
						}
					}
					save_scope_as = powerful_vassal
				}
			}
		}
	}
		

	option = { 
		name = TCT_religious_events.34.a
		custom_tooltip = TCT_religious_events.34.a.tt
		custom_tooltip = TCT_religious_events.34a.ttb
		show_as_tooltip = {
			pay_short_term_gold = {
				target = scope:powerful_vassal
				gold = 120
			}
		}
		scope:powerful_vassal = { 
			add_character_flag = pope_bribing

			trigger_event = {
				id = TCT_religious_events.35
				days = 15
			}
		}

		ai_chance = {	
			base = 75

			modifier = {
				add = 25
				has_trait = zealous
			}
		}
	}
	option = { 
		name = TCT_religious_events.34.b
	
		remove_character_flag = pope_currently_demanding

		scope:popewantsit = {
			remove_character_flag = pope_we_refuse_law_changed
		}

		ai_chance = {	
			base = 10

			modifier = {
				add = -75
				has_trait = zealous
			}
		}
	}
}

## The vassal receives the claim
#Event 11
TCT_religious_events.35 = { 
	title = TCT_religious_events.35.t
	desc = TCT_religious_events.35.desc
	theme = learning_scholarship_focus
	left_portrait = {
		character = scope:powerful_vassal
	}

	right_portrait = {
		character = scope:pope
	}

	immediate = {
		faith.religious_head = {
			save_scope_as = pope
		}
	}
	
	option = { 
		name = TCT_religious_events.35.a
		custom_tooltip = "TCT_religious_events.35.a.tt"
		add_pressed_claim = liege.primary_title
		scope:powerful_vassal = {
			add_opinion = {
				target = faith.religious_head
				opinion = 20
				modifier = bishop_bribed_by_pope
			}
		}

		spawn_army = {
			uses_supply = no
			inheritable = yes
			name = event_troop_default_name
			levies = {
				value = 500
			}
			men_at_arms = {
				type = onager
				stacks = 5
			}
			men_at_arms = {
				type = picchieri
				stacks = 28
			}
			location = capital_province
		}

		scope:powerful_vassal = {
			if = {
				limit = {
					is_ai = yes
				}
				trigger_event = {
					id = TCT_religious_events.37
					days = { 100 365 }
				}
			}
		}

		every_ruler = {
			trigger_event = {
				id = TCT_religious_events.36
				days = 2
			}
		}

		ai_chance = {	
			base = 100
		
		}
	}
	option = { 
		name = TCT_religious_events.35.b

		add_prestige = 10
	}
}

#Inform everyone!
TCT_religious_events.36 = { 
	title = TCT_religious_events.36.t
	desc = TCT_religious_events.36.desc
	theme = faith

	right_portrait = {
		character = faith.religious_head
	}

	left_portrait = {
		character = scope:popewantsit
	}

	lower_left_portrait = {
		character = scope:powerful_vassal
	}

	option = { 
		name = TCT_religious_events.36.a

		if = {
			limit = {
				this = scope:popewantsit
			}
			scope:popewantsit = {
				add_opinion = {
					target = scope:powerful_vassal
					modifier = angry_opinion
					opinion = -150
				}
		
				add_opinion = {
					target = faith.religious_head
					modifier = angry_opinion
					opinion = -150
				}
			}
			scope:powerful_vassal = {
				add_opinion = {
					target = scope:popewantsit
					modifier = impious_opinion
					opinion = -150
				}
			}
		}

		ai_chance = {	
			base = 100
		}
	}
	after = {
		trigger_event = TCT_religious_events.367
	}
}

TCT_religious_events.367 = { 
	title = TCT_religious_events.367.t
	desc = TCT_religious_events.367.desc
	theme = faith

	right_portrait = {
		character = faith.religious_head
	}

	left_portrait = {
		character = scope:powerful_vassal
	}

	option = { 
		name = TCT_religious_events.367.a


		ai_chance = {	
			base = 100
		}
	}
}

#Start the war
TCT_religious_events.37 = { 
	title = TCT_religious_events.37.t
	desc = TCT_religious_events.37.desc
	theme = faith
	left_portrait = {
		character = scope:powerful_vassal
	}

	right_portrait = {
		character = faith.religious_head
	}

	lower_center_portrait = {
		character = scope:popewantsit
	}

	option = { 
		name = TCT_religious_events.37.a

		start_war = {
			cb = claim_cb
			target = scope:popewantsit
			claimant = scope:powerful_vassal
			target_title = scope:popewantsit.primary_title
		}

		ai_chance = {	
			base = 100
		
		}
	}
}

####
## Check for Cadaver Synod
#Event 1

#The Cadaver Synod

## Pope learns that a catholic ruler has a heretic advisor

scripted_trigger TCT_religious_events_41_valid_councillor = {
	is_available_ai_adult = yes
	NOR = {
		has_trait = chaste
		is_spouse_of = root
	}

	#We need to make sure that if we pick this councillor, there is a valid child of ROOT they can have a relationship with.
	save_temporary_scope_as = councillor
}

TCT_religious_events.41 = { 
	title = TCT_religious_events.41.t
	desc = TCT_religious_events.41.desc
	theme = learning_scholarship_focus
	right_portrait = {
		character = faith.religious_head
	}
	left_portrait = {
		character = scope:rulerwithheretic
	}

	trigger = {		
		has_title = title:k_papal_state
		this = faith.religious_head
		is_imprisoned = no
		has_religion = religion:christianity_religion
		has_faith = faith:catholic
		current_year >= 1040
		faith = { fervor >= 40 }

		any_independent_ruler = {
			highest_held_title_tier >= tier_duchy
			has_faith = faith:catholic
			title:k_papal_state.holder = faith.religious_head
			any_councillor = {
				NOT = { has_faith = faith:catholic } TCT_religious_events_41_valid_councillor = yes
			}
		}
	}

	immediate = {
		random_independent_ruler = {
			limit = {
				highest_held_title_tier >= tier_duchy
				has_faith = faith:catholic
				title:k_papal_state.holder = faith.religious_head
				any_councillor = {
					NOT = { has_faith = faith:catholic } TCT_religious_events_41_valid_councillor = yes
				}
			}
			save_scope_as = rulerwithheretic
		}
		if = {
			limit = {
				scope:rulerwithheretic = {
					any_councillor = {
						NOT = { has_faith = faith:catholic } TCT_religious_events_41_valid_councillor = yes
					}
				}
			}
			scope:rulerwithheretic = {
				random_councillor = {
					limit = {
						NOT = { has_faith = faith:catholic } TCT_religious_events_41_valid_councillor = yes
					}
					save_scope_as = heretic_councillor
				}
			}
		}
	}
		

	option = { 
		name = TCT_religious_events.41.a
		scope:rulerwithheretic = {
			trigger_event = {
				id = TCT_religious_events.42
				days = {15 30}
			}
		}

		ai_chance = {	
			base = 75

			modifier = {
				add = 25
				has_trait = zealous
			}
		}
	}
	option = { 
		name = TCT_religious_events.41.b

		ai_chance = {	
			base = 75

			modifier = {
				add = 25
				has_trait = zealous
			}
		}
	}
}

TCT_religious_events.42 = { 
	type = letter_event
	title = TCT_religious_events.42.t
	opening = TCT_religious_events.42.opening
	desc = TCT_religious_events.42.desc
	sender = {
		character = faith.religious_head
	}
	# left_portrait = {
	# 	character = scope:rulerwithheretic
	# }

	option = { 
		name = TCT_religious_events.42.a
		if = { #Can I fire them?
			limit = {
				scope:heretic_councillor = { can_be_fired_from_council_trigger = { COURT_OWNER = scope:rulerwithheretic } }
			}
			scope:rulerwithheretic = { fire_councillor = scope:heretic_councillor }
		}
		faith.religious_head = {
			add_opinion = {
				target = scope:rulerwithheretic
				modifier = respect_opinion
				opinion = 50
			}
		}
	
		ai_chance = {	
			base = 75
	
			modifier = {
				add = 25
				has_trait = zealous
			}
		}
	}
	option = { 
		name = TCT_religious_events.42.b
	
		faith.religious_head = {
			add_opinion = {
				target = scope:rulerwithheretic
				modifier = angry_opinion
				opinion = -50
			}
		}
		add_character_modifier = {
			modifier = refusedpope
			years = 3
		}
	
		ai_chance = {	
			base = 10
	
			modifier = {
				add = -75
				has_trait = zealous
			}
		}
	}
} 

## Vassal disappointed in liege having heretic advisor

TCT_religious_events.43 = { 
	title = TCT_religious_events.43.t
	desc = TCT_religious_events.43.desc
	theme = learning_scholarship_focus
	right_portrait = {
		character = scope:vassal
	}
	left_portrait = {
		character = scope:hereticadvisorruler
	}

	trigger = {		
		is_imprisoned = no
		has_religion = religion:christianity_religion
		has_faith = faith:catholic
		current_year >= 1040
		faith = { fervor >= 40 }

		any_independent_ruler = {
			highest_held_title_tier >= tier_duchy
			has_faith = faith:catholic
			title:k_papal_state.holder = faith.religious_head
			any_councillor = {
				NOT = { has_faith = faith:catholic }
			}
			save_temporary_scope_as = hereticadvisorruler
		}
		is_vassal_of = scope:hereticadvisorruler
	}

	immediate = {
		save_scope_as = vassal
		liege = {
			save_scope_as = hereticadvisorruler
		}
		if = {
			limit = {
				scope:hereticadvisorruler = {
					any_councillor = {
						NOT = { has_faith = faith:catholic }
					}
				}
			}
			scope:hereticadvisorruler = {
				random_councillor = {
					limit = {
						NOT = { has_faith = faith:catholic }
					}
					save_scope_as = heretic_councillor
				}
			}
		}
	}
		

	option = { 
		name = TCT_religious_events.43.a
		custom_tooltip = TCT_religious_events.43a.tta
		scope:hereticadvisorruler = {
			trigger_event = {
				id = TCT_religious_events.44
				days = {15 30}
			}
		}

		ai_chance = {	
			base = 75

			modifier = {
				add = 25
				has_trait = zealous
			}
		}
	}
}

TCT_religious_events.44 = { 
	type = letter_event
	title = TCT_religious_events.42.t
	desc = TCT_religious_events.42.desc
	opening = TCT_religious_events.42.opening
	sender = {
		character = scope:vassal
	}

	option = { 
		name = TCT_religious_events.42.a
		if = { #Can I fire them?
			limit = {
				scope:heretic_councillor = { can_be_fired_from_council_trigger = { COURT_OWNER = scope:rulerwithheretic } }
			}
			scope:hereticadvisorruler = { fire_councillor = scope:heretic_councillor }
		}
		scope:vassal = {
			add_opinion = {
				target = scope:hereticadvisorruler
				modifier = respect_opinion
				opinion = 20
			}
		}
	
		ai_chance = {	
			base = 75
	
			modifier = {
				add = 25
				has_trait = zealous
			}
		}
	}
	option = { 
		name = TCT_religious_events.42.b
		scope:vassal = {
			add_opinion = {
				target = scope:hereticadvisorruler
				modifier = angry_opinion
				opinion = -20
			}
		}
		add_character_modifier = {
			modifier = refusedpope
			years = 3
		}
	
		ai_chance = {	
			base = 10
	
			modifier = {
				add = -75
				has_trait = zealous
			}
		}
	}
} 

## Realm Priest disappointed in liege having heretic advisor

TCT_religious_events.45 = { 
	type = letter_event
	title = TCT_religious_events.42.t
	desc = TCT_religious_events.42.desc
	sender = {
		character = scope:vassal
	}
	opening = TCT_religious_events.42.opening

	trigger = {		
		is_available_adult = yes
		exists = cp:councillor_court_chaplain
		cp:councillor_court_chaplain = {
			opinion = {
				target = liege
				value <= -10
			}
			faith = root.faith
			is_imprisoned = no
		}
		current_year >= 1040
		faith = { fervor >= 40 }
		highest_held_title_tier >= tier_duchy
		has_faith = faith:catholic
		title:k_papal_state.holder = faith.religious_head
		any_councillor = {
			NOT = { has_faith = faith:catholic }
		}
		save_temporary_scope_as = hereticadvisorruler
	}

	immediate = {
		cp:councillor_court_chaplain = {
			save_scope_as = vassal
		}
		save_scope_as = hereticadvisorruler
		if = {
			limit = {
				scope:hereticadvisorruler = {
					any_councillor = {
						NOT = { has_faith = faith:catholic }
					}
				}
			}
			scope:hereticadvisorruler = {
				random_councillor = {
					limit = {
						NOT = { has_faith = faith:catholic }
					}
					save_scope_as = heretic_councillor
				}
			}
		}

	}
		

	option = { 
		name = TCT_religious_events.42.a
		if = { #Can I fire them?
			limit = {
				scope:heretic_councillor = { can_be_fired_from_council_trigger = { COURT_OWNER = scope:rulerwithheretic } }
			}
			scope:hereticadvisorruler = { fire_councillor = scope:heretic_councillor }
		}
		scope:vassal = {
			add_opinion = {
				target = scope:hereticadvisorruler
				modifier = respect_opinion
				opinion = 20
			}
		}
	
		ai_chance = {	
			base = 75
	
			modifier = {
				add = 25
				has_trait = zealous
			}
		}
	}
	option = { 
		name = TCT_religious_events.42.b
	
		scope:vassal = {
			add_opinion = {
				target = scope:hereticadvisorruler
				modifier = angry_opinion
				opinion = -20
			}
		}
		add_character_modifier = {
			modifier = refusedpope
			years = 3
		}
	
		ai_chance = {	
			base = 10
	
			modifier = {
				add = -75
				has_trait = zealous
			}
		}
	}
}

# # The Pope gives money to someone fighting the Infidel

TCT_religious_events.46 = { 
	title = TCT_religious_events.46.t
	desc = TCT_religious_events.46.desc
	theme = war
	lower_center_portrait = {
		character = scope:holywarleader
	}
	right_portrait = {
		character = scope:cardinal
	}
	left_portrait = {
		character = root
	}

	trigger = {		
		has_title = title:k_papal_state
		this = faith.religious_head
		is_imprisoned = no
		has_religion = religion:christianity_religion
		has_faith = faith:catholic
		current_year >= 1040
		faith = { fervor >= 40 }
		gold >= 400

		any_independent_ruler = {
			highest_held_title_tier >= tier_duchy
			has_faith = faith:catholic
			title:k_papal_state.holder = faith.religious_head
			OR = {
				any_character_war = {
					using_holy_war_cb_trigger = yes
					is_defender = prev
				}
				any_character_war = {
					using_holy_war_cb_trigger = yes
					is_attacker = prev
				}
			}
		}
	}

	immediate = {
		random_independent_ruler = {
			limit = {
				highest_held_title_tier >= tier_duchy
				has_faith = faith:catholic
				title:k_papal_state.holder = faith.religious_head
				OR = {
					any_character_war = {
						using_holy_war_cb_trigger = yes
						is_defender = prev
					}
					any_character_war = {
						using_holy_war_cb_trigger = yes
						is_attacker = prev
					}
				}
			}
			save_scope_as = holywarleader
		}
		random_living_cardinal = { save_scope_as = cardinal } 
	}

	option = { 
		name = TCT_religious_events.46.a
		show_as_tooltip = {
			faith.religious_head = {
				pay_short_term_gold = {
					target = scope:holywarleader
					gold = 120
				}
			}
		}
		
		scope:holywarleader = {
			add_opinion = {
				target = faith.religious_head
				opinion = 20
				modifier = bishop_bribed_by_pope
			}
			trigger_event = {
				id = TCT_religious_events.467
				days = 3
			}
		}
	
		ai_chance = {	
			base = 75
	
			modifier = {
				add = 25
				has_trait = zealous
			}
		}
	}
	option = { 
		name = TCT_religious_events.46.b
	

	
		ai_chance = {	
			base = 10
	
			modifier = {
				add = -75
				has_trait = zealous
			}
		}
	}
} 

TCT_religious_events.467 = { 
	type = letter_event
	title = TCT_religious_events.467.t
	desc = TCT_religious_events.467.desc

	sender = {
		character = faith.religious_head
	}
	opening = TCT_religious_events.42.opening

	option = {
		name = TCT_religious_events.467.a
		faith.religious_head = {
			pay_short_term_gold = {
				target = scope:holywarleader
				gold = 120
			}
		}
	}
} 

# # Leprous Courtier Departs to Join Order of Lazarus

TCT_religious_events.47 = { 
	title = TCT_religious_events.47.t
	desc = TCT_religious_events.47.desc
	theme = faith
	right_portrait = {
		character = scope:leper
	}
	left_portrait = {
		character = root
	}

	trigger = {		
		any_courtier_or_guest = {
			has_faith = faith:catholic
			has_trait = leper
			NOT = { has_trait = cynical}
		}
		has_faith = faith:catholic
		highest_held_title_tier >= tier_county
	}

	immediate = {
		random_courtier_or_guest = {
			limit = {
				has_faith = faith:catholic
				has_trait = leper
				NOT = { has_trait = cynical}
			}
			save_scope_as = leper
		}
	}

	option = { 
		name = TCT_religious_events.47.a
		
		scope:leper = {
			add_opinion = {
				target = root
				opinion = 20
				modifier = grateful_opinion
			}
			add_trait = order_member

			if = {
				limit = {
					title:c_jerusalem.holder = {
						has_faith = faith:catholic
					}
				}
				scope:leper = {
					visit_court_of = title:c_jerusalem.holder 
				}
			}
			else_if = {
				limit = {
					title:c_roma.holder = {
						has_faith = faith:catholic
					}
				}
				scope:leper = {
					visit_court_of = title:c_roma.holder
				}
			}
			else = {
				move_to_pool_at = title:c_roma.holder.capital_province
			}
		}
	
		ai_chance = {	
			base = 75
	
			modifier = {
				add = 25
				has_trait = zealous
			}
		}
	}
	option = { 
		name = TCT_religious_events.47.b
	
		ai_chance = {	
			base = 10
	
			modifier = {
				add = -75
				has_trait = zealous
			}
		}
	}
} 

scripted_trigger TCT_religious_events_48_province_trigger = {
	NOT = { religion = root.religion }
	faith = {
		faith_hostility_level = {
		target = root.faith
		value >= faith_hostile_level
		}
	}
}

#Pope Complains of Heresy Run Rampant in Ruler's Lands #1
TCT_religious_events.48 = { 
	title = TCT_religious_events.48.t
	desc = TCT_religious_events.48.desc
	theme = faith
	lower_center_portrait = {
		character = scope:targetedruler
	}
	right_portrait = {
		character = scope:cardinal
	}
	left_portrait = {
		character = root
	}

	trigger = {		
		has_title = title:k_papal_state
		this = faith.religious_head
		is_imprisoned = no
		has_religion = religion:christianity_religion
		has_faith = faith:catholic
		current_year >= 1040
		faith = { fervor >= 40 }

		any_independent_ruler = {
			highest_held_title_tier >= tier_duchy
			has_faith = faith:catholic
			title:k_papal_state.holder = faith.religious_head
			any_sub_realm_county = {
				TCT_religious_events_48_province_trigger = yes
			}
			exists = cp:councillor_court_chaplain
			NOT = {
				cp:councillor_court_chaplain = {
					is_performing_council_task = task_conversion
				}
			}
		}
	}

	immediate = {
		random_independent_ruler = {
			limit = {
				highest_held_title_tier >= tier_county
				has_faith = faith:catholic
				title:k_papal_state.holder = faith.religious_head
				any_sub_realm_county = {
					TCT_religious_events_48_province_trigger = yes
				}
				exists = cp:councillor_court_chaplain
				NOT = { 
					cp:councillor_court_chaplain = {
						is_performing_council_task = task_conversion
					}
				}
			}
			random_sub_realm_county = {
				limit = {
					TCT_religious_events_48_province_trigger = yes
				}
				save_scope_as = county
			}
			save_scope_as = targetedruler
		}
		random_living_cardinal = { save_scope_as = cardinal } 
	}

	option = { 
		name = TCT_religious_events.48.a
		
		scope:targetedruler = {
			trigger_event = {
				id = TCT_religious_events.49
				days = 3
			}
		}
	
		ai_chance = {	
			base = 75
	
			modifier = {
				add = 25
				has_trait = zealous
			}
		}
	}
	option = { 
		name = TCT_religious_events.48.b
	
		ai_chance = {	
			base = 10
	
			modifier = {
				add = -75
				has_trait = zealous
			}
		}
	}
} 

#Pope Complains of Heresy Run Rampant in Ruler's Lands  #2
TCT_religious_events.49 = { 
	title = TCT_religious_events.49.t
	desc = TCT_religious_events.49.desc
	theme = faith
	right_portrait = {
		character = scope:targetedruler
	}
	left_portrait = {
		character = faith.religious_head
	}

	option = { 
		name = TCT_religious_events.49.a
		
		cp:councillor_court_chaplain = {
			set_council_task = {
				task_type = task_conversion
				target = scope:county.title_province
			}
		}

		ai_chance = {	
			base = 75
	
			modifier = {
				add = 25
				has_trait = zealous
			}
		}
	}
	option = { 
		name = TCT_religious_events.49.b
	
		trigger_event = {
			id = TCT_religious_events.50
			months = 6
		}
		

		ai_chance = {	
			base = 10
	
			modifier = {
				add = -75
				has_trait = zealous
			}
			modifier = {
				add = 100
				has_trait = cynical
			}
		}
	}
} 

#Pope Complains of Heresy Run Rampant in Ruler's Lands  #3
TCT_religious_events.50 = { 
	title = TCT_religious_events.50.t
	desc = TCT_religious_events.50.desc
	theme = faith
	right_portrait = {
		character = scope:targetedruler
	}
	left_portrait = {
		character = faith.religious_head
	}

	trigger = {
		scope:targetedruler = {
			exists = cp:councillor_court_chaplain
			NOT = {
				cp:councillor_court_chaplain = {
					is_performing_council_task = task_conversion
				}
			}
		}
	}

	immediate = {
		scope:targetedruler = {
			primary_title = {
				save_scope_as = primary_title
			}
		}
	}

	option = { 
		name = TCT_religious_events.50.a
		
		scope:targetedruler = {
			add_excommunication_actual_effect = yes
		}

		ai_chance = {	
			base = 90
	
			modifier = {
				add = 25
				has_trait = zealous
			}
		}
	}
}

#Pope Demands Ruler Free Imprisoned Prince-Bishop #1
TCT_religious_events.51 = { 
	title = TCT_religious_events.51.t
	desc = TCT_religious_events.51.desc
	theme = faith
	left_portrait = {
		character = scope:targetedruler
	}
	right_portrait = {
		character = scope:imprisonedbishop
	}

	trigger = {		
		has_title = title:k_papal_state
		this = faith.religious_head
		is_imprisoned = no
		has_religion = religion:christianity_religion
		has_faith = faith:catholic
		current_year >= 1040
		faith = { fervor >= 40 }

		any_independent_ruler = {
			is_landed = yes
			highest_held_title_tier >= tier_duchy
			has_faith = faith:catholic
			title:k_papal_state.holder = faith.religious_head
			any_prisoner = {
				has_faith = faith:catholic
				is_imprisoned_by = prev
				OR = { 
					has_government = theocracy_government
					has_council_position = councillor_court_chaplain
				}
			}
		}
	}

	immediate = {
		random_independent_ruler = {
			limit = {
				highest_held_title_tier >= tier_duchy
				is_landed = yes
				has_faith = faith:catholic
				title:k_papal_state.holder = faith.religious_head
				any_prisoner = {
					has_faith = faith:catholic
					is_imprisoned_by = prev
					OR = { 
						has_government = theocracy_government
						has_council_position = councillor_court_chaplain
					}
				}
			}
			save_scope_as = targetedruler
		}
		scope:targetedruler = {
			random_prisoner = {
				limit = {
					is_imprisoned_by = scope:targetedruler
					has_faith = faith:catholic
					OR = { 
						has_government = theocracy_government
						has_council_position = councillor_court_chaplain
					}
				}
				save_scope_as = imprisonedbishop
			}
		}
		scope:imprisonedbishop ={
			primary_title = {
				save_scope_as = bishoptitle
			}
		}

		random_living_cardinal = {
			save_scope_as = cardinal
		}
	}

	option = { 
		name = TCT_religious_events.51.a
		
		scope:targetedruler = {
			trigger_event = {
				id = TCT_religious_events.52
				days = 3
			}
		}
	
		ai_chance = {	
			base = 75
	
			modifier = {
				add = 25
				has_trait = zealous
			}
		}
	}
	option = { 
		name = TCT_religious_events.51.b
	
		scope:imprisonedbishop = {
			add_opinion = {
				target = root
				modifier = angry_opinion
				opinion = -10
			}
		}

		ai_chance = {	
			base = 10
	
			modifier = {
				add = -75
				has_trait = zealous
			}
		}
	}
} 

#Pope Demands Ruler Free Imprisoned Prince-Bishop  #2
TCT_religious_events.52 = { 
	title = TCT_religious_events.52.t
	desc = TCT_religious_events.52.desc
	theme = faith
	right_portrait = {
		character = scope:imprisonedbishop
	}
	left_portrait = {
		character = faith.religious_head
	}

	option = { 
		name = TCT_religious_events.52.a
		
		scope:imprisonedbishop = {
			release_from_prison = yes
		}

		ai_chance = {	
			base = 75
	
			modifier = {
				add = 25
				has_trait = zealous
			}
		}
	}
	option = { 
		name = TCT_religious_events.52.b
	

		faith.religious_head = {
			trigger_event = {
				id = TCT_religious_events.53
				months = 1
			}
		}

		ai_chance = {	
			base = 10
	
			modifier = {
				add = -75
				has_trait = zealous
			}
			modifier = {
				add = 100
				has_trait = cynical
			}
		}
	}
} 

#Pope Demands Ruler Free Imprisoned Prince-Bishop  #3
TCT_religious_events.53 = { 
	hidden = yes

	immediate = {
		if = {
			limit = {
				scope:imprisonedbishop = {
					is_imprisoned = yes
					is_imprisoned_by = scope:targetedruler
				}
			}
			faith.religious_head = {
				trigger_event = TCT_religious_events.54
			}
		}
	}
}

TCT_religious_events.54 = {
	title = TCT_religious_events.54.t
	desc = TCT_religious_events.54.desc
	theme = faith
	left_portrait = {
		character = scope:targetedruler
	}
	right_portrait = {
		character = faith.religious_head
	}

	option = { 
		name = TCT_religious_events.54.a
		
		scope:targetedruler = {
			add_excommunication_actual_effect = yes
			hidden_effect = {
				send_interface_toast = {
					type = event_toast_effect_good
					title =  TCT_religious_events.54.a.toast
					left_icon = faith.religious_head
					show_as_tooltip = {
						add_excommunication_actual_effect = yes
					}
				}
			}
		}

		ai_chance = {	
			base = 90
	
			modifier = {
				add = 25
				has_trait = zealous
			}
		}
	}
}

#Murdered a Bishop
TCT_religious_events.55 = {
	title = TCT_religious_events.55.t
	desc = TCT_religious_events.55.desc
	theme = faith
	left_portrait = {
		character = scope:murderer
	}
	right_portrait = {
		character = faith.religious_head
	}

	immediate = { 
		scope:murderer = {
			primary_title = {
				save_scope_as = primary_title
			}
		}
	}

	option = { 
		name = TCT_religious_events.55.a
		
		scope:murderer = {
			add_excommunication_actual_effect = yes
			hidden_effect = {
				send_interface_toast = {
					type = event_toast_effect_good
					title =  TCT_religious_events.54.a.toast
					left_icon = faith.religious_head
					show_as_tooltip = {
						add_excommunication_actual_effect = yes
					}
				}
			}
		}

		ai_chance = {	
			base = 90
	
			modifier = {
				add = 250
				has_trait = zealous
			}
		}
	}
}

#Pope Excommunicates Ruler for Declaring War Against Prince-Bishop
TCT_religious_events.56 = {
	title = TCT_religious_events.56.t
	desc = TCT_religious_events.56.desc
	theme = faith
	left_portrait = {
		character = scope:BishopAttacker
	}
	lower_right_portrait = {
		character = scope:BishopyDefender
	}
	right_portrait = {
		character = scope:Pope
	}

	immediate = {
		every_ruler = {
			limit = {
				is_at_war_with = scope:BishopyDefender		
				any_character_war = {
					is_war_leader = scope:attacker
					is_participant = scope:BishopyDefender
				}
			}
			save_scope_as = BishopAttacker
		}

		title:k_papal_state.holder = {
			save_scope_as = Pope
		}

		random_living_cardinal = {
			save_scope_as = cardinal
		}
	}

	option = { 
		name = TCT_religious_events.56.a
		
		scope:BishopAttacker = {
			show_as_tooltip = {
				every_character_war = {
					limit = {
						is_attacker = scope:BishopAttacker
						is_defender = scope:BishopyDefender
					}
					every_war_attacker = {
						add_excommunication_actual_effect = yes
					}
				}
			}
			trigger_event = {
				id = TCT_religious_events.57
				days = 3
			}
			
		}

		ai_chance = {	
			base = 90
	
			modifier = {
				add = 250
				has_trait = zealous
			}
		}
	}
	option = { 
		name = TCT_religious_events.56.b

		ai_chance = {	
			base = 10
	
			modifier = {
				add = -75
				has_trait = zealous
			}
		}
	}
}

TCT_religious_events.57 = {
	title = TCT_religious_events.57.t
	desc = TCT_religious_events.57.desc
	theme = faith
	left_portrait = {
		character = scope:BishopAttacker
	}
	lower_right_portrait = {
		character = scope:BishopyDefender
	}
	right_portrait = {
		character = scope:Pope
	}

	immediate = {
		every_ruler = {
			limit = {
				is_at_war_with = scope:BishopyDefender		
				any_character_war = {
					is_war_leader = scope:attacker
					is_participant = scope:BishopyDefender
				}
			}
			save_scope_as = BishopAttacker
		}

		title:k_papal_state.holder = {
			save_scope_as = Pope
		}
	}

	option = { 
		name = TCT_religious_events.57.a
		
		scope:BishopAttacker = {
			every_character_war = {
				limit = {
					is_attacker = scope:BishopAttacker
					is_defender = scope:BishopyDefender
				}
				every_war_attacker = {
					add_excommunication_actual_effect = yes
				}
			}
		}


		ai_chance = {	
			base = 1
		}
	}
}

#Christmas! 
TCT_religious_events.58 = {#christmas
	type = character_event
	title = TCT_religious_events.58.t
	desc = TCT_religious_events.58.desc
	theme = family
	override_background = { reference = TCT_christmas }
	left_portrait = {
		character = scope:family
		animation = happiness
	}
	
	right_portrait = {
		character = root
		animation = ecstasy
	}

	# widgets = {
	# 	widget = {
	# 		gui = "window_activity_jank_start_widget"
	# 		container = "custom_widgets_container"
	# 		controller = default
	# 		setup_scope = { }
	# 	}
	# }

	immediate = {
		play_music_cue = CK2_songs_of_yuletide 
		random_List = {
			50 = {
				primary_spouse ?= {
					save_scope_as = family
				}
			}
			50 = {
				random_child ?= {
					save_scope_as = family
				}
			}
		}	
		root.capital_province ?= {
			save_scope_as = provincefun
		}
	}

	option = { #wassailing
		name = TCT_religious_events.58.a
		add_stress = medium_stress_loss
	}
	option = { #feast
		name = TCT_religious_events.58.b
		open_view_data = {
			view = activity_list_detail_host_window
			data = activity_type:activity_feast
			player = root
		}
		add_character_flag = {
			flag = hosting_christmas_or_saint_day
			days = 10
		}
		custom_tooltip = TCT_religious_events_58_b_tt
	}	

	option = { #family
		name = TCT_religious_events.58.c
		every_close_or_extended_family_member = {
			limit = {
				NOT = { this = root }
			}
			add_opinion = {
				modifier = TCT_christmas_opinion
				target = root
			}
		}
	}
}

#TCT_religious_events.59 #christmas

#TCT_religious_events.60 #christmas

#TCT_religious_events.61 #christmas

#TCT_religious_events.62 #christmas

#TCT_religious_events.63 moved to TCT_saint_days.0001

# #Event: Baptism of my Heir / Quick and Dirty Baptism's
# TCT_religious_events.70 = {
# 	title = TCT_religious_events.70.t
# 	desc = TCT_religious_events.70.t
# 	# Use appropriate localization for the event title and description
# 	orphan = yes
# 	# Set the portraits of the characters involved
# 	left_portrait = {
# 		character = root
# 		animation = personality_rational
# 	}

# 	lower_left_portrait = {
# 		character = scope:heir
# 	}

# 	right_portrait = {
# 		character = faith.religious_head
# 	}

# 	trigger = {
# 		government_has_flag = government_is_feudal
# 		OR = {
# 			faith = faith:catholic
# 			faith = faith:cathar
# 			faith = faith:waldensian
# 			faith = faith:lollard
# 		}
# 		NOT = { has_character_flag = heir_baptized } # Optional flag to prevent repeating the event
# 	}

# 	immediate = {
# 		add_character_flag = heir_baptized
# 	}

# 	option = {
# 		name = TCT_religious_events.70.a

# 		trigger = {
# 			gold = 100 # Adjust the gold cost as desired
# 		}

# 		remove_short_term_gold = 100
# 		add_prestige = -25 # Adjust the piety loss as desired
# 		# Perform the baptism by the Pope (adjust the following actions as needed)
# 		# Example actions:
# 		# gain_trait = baptized
# 		# gain_prestige = 100		
# 	}

# 	option = {
# 		name = TCT_religious_events.70.b

# 		trigger = {
# 			gold = 50 # Adjust the gold cost as desired
# 		}

# 		remove_short_term_gold = 50
# 		# Perform the baptism by the local bishop (adjust the following actions as needed)
# 		# Example actions:
# 		# gain_trait = baptized
# 		# gain_prestige = 50
# 	}

# 	option = {
# 		name = TCT_religious_events.70.c

# 		trigger = {
# 			gold = 25 # Adjust the gold cost as desired
# 		}

# 		remove_short_term_gold = 25
# 		add_prestige = -25 # Adjust the prestige loss as desired
# 		# Perform a regular baptism (adjust the following actions as needed)
# 		# Example actions:
# 		# gain_trait = baptized
# 		# gain_prestige = 25
# 	}
# }


# #Event: Baptism of my Heir / Quick and Dirty Baptism's
# TCT_religious_events.70 = {
# 	title = TCT_religious_events.70.t
# 	desc = TCT_religious_events.70.t
# 	# Use appropriate localization for the event title and description
# 	orphan = yes
# 	# Set the portraits of the characters involved
# 	left_portrait = {
# 		character = root
# 		animation = personality_rational
# 	}

# 	lower_left_portrait = {
# 		character = scope:heir
# 	}

# 	right_portrait = {
# 		character = faith.religious_head
# 	}

# 	trigger = {
# 		government_has_flag = government_is_feudal
# 		OR = {
# 			faith = faith:catholic
# 			faith = faith:cathar
# 			faith = faith:waldensian
# 			faith = faith:lollard
# 		}
# 		NOT = { has_character_flag = heir_baptized } # Optional flag to prevent repeating the event
# 	}

# 	immediate = {
# 		add_character_flag = heir_baptized
# 	}

# 	option = {
# 		name = TCT_religious_events.70.a

# 		trigger = {
# 			has_gold = 100 # Adjust the gold cost as desired
# 		}

# 		remove_short_term_gold = 100
# 		lose_piety = 25 # Adjust the piety loss as desired
# 		# Perform the baptism by the Pope (adjust the following actions as needed)
# 		# Example actions:
# 		# gain_trait = baptized
# 		# gain_prestige = 100		
# 	}

# 	option = {
# 		name = TCT_religious_events.70.b

# 		trigger = {
# 			has_gold = 50 # Adjust the gold cost as desired
# 		}

# 		lose_gold = 50
# 		# Perform the baptism by the local bishop (adjust the following actions as needed)
# 		# Example actions:
# 		# gain_trait = baptized
# 		# gain_prestige = 50
# 	}

# 	option = {
# 		name = TCT_religious_events.70.c

# 		trigger = {
# 			has_gold = 25 # Adjust the gold cost as desired
# 		}

# 		lose_gold = 25
# 		lose_prestige = 25 # Adjust the prestige loss as desired
# 		# Perform a regular baptism (adjust the following actions as needed)
# 		# Example actions:
# 		# gain_trait = baptized
# 		# gain_prestige = 25
# 	}
# }

# #Event: Deep in Doctrine
# deep_in_doctrine.001 = {
# 	title = deep_in_doctrine.001.t
# 	desc = deep_in_doctrine.001.d
# 	# Use appropriate localization for the event title and description

# 	# Set the portraits of the characters involved
# 	left_portrait = {
# 		character = root
# 		animation = personality_studious
# 	}

# 	right_portrait = {
# 		character = root.court_chaplain
# 		animation = personality_scholarly_theologian
# 	}

# 	trigger = {
# 		# The character should be an adult and their priest should be available
# 		is_adult = yes
# 		exists = cp:councillor_court_chaplain
# 	}

# 	immediate = {}

# 	option = {
# 		name = deep_in_doctrine.001.a

# 		trigger = {}

# 		# Gain Learning and Piety
# 		add_learning_lifestyle_xp = 150
# 		add_piety = 50
# 		add_character_modifier = {
# 			modifier = studying_theology
# 			years = 2
# 		}
# 	}

# 	option = {
# 		name = deep_in_doctrine.001.b

# 		trigger = {}

# 		# No immediate effect
# 	}
# }


# Event: Veteran of the First Crusade
# TCT_religious_events.80 = {
# 	title = TCT_religious_events.80.t
# 	desc = TCT_religious_events.80.desc
# 	# Use appropriate localization for the event title and description

# 	# Set the portraits of the characters involved
# 	left_portrait = {
# 		character = scope:main_character
# 	}

# 	right_portrait = {
# 		character = scope:veteran_crusader
# 		animation = sword_yield_start
# 	}

# 	trigger = {
# 		is_feudal = yes
# 		faith = faith:catholic
# 		NOT = { has_character_modifier = veteran_of_first_crusade_modifier }
# 		OR = {
# 			faith = faith:cathar
# 			faith = faith:lollard
# 			faith = faith:waldensian
# 		}
# 		# Add any additional trigger conditions (e.g., pilgrimage related) as needed
# 	}

# 	immediate = {
# 		#Generate a character to represent this older vet!
# 		create_character = {
# 			template = veteran_crusader_knight_character
# 			dynasty = none
# 			gender = male
# 			location = root.location
# 			save_scope_as = veteran_crusader
# 		}
# 	}

# 	option = {
# 		name = TCT_religious_events.80.a
# 		# Use appropriate localization for the option name

# 		trigger = {
# 			OR = {
# 				probably_unintelligent_trigger = yes
# 			}
# 		}

# 		# Tell your retinue to hail the man as a hero
# 		scope:veteran_crusader = {
# 			add_opinion = {
# 				target = root
# 				modifier = veterancrusadersupported
# 				opinion = 20
# 			}
# 			add_prestige = 500
# 		}
# 		add_prestige = 100


# 		trigger_event = {
# 			id = TCT_religious_events.81
# 			days = 1
# 		}
# 	}

# 	option = {
# 		name = TCT_religious_events.80.b
# 		# Use appropriate localization for the option name

# 		trigger = {
# 			has_trait = low_intrigue
# 		}

# 		# Knight exposes the man as a fraud
# 		lose_prestige = 50
# 		lose_opinion = { who = ROOT modifier = opinion_modifier value = 15 }
# 	}

# 	option = {
# 		name = TCT_religious_events.80.c
# 		# Use appropriate localization for the option name

# 		trigger = {
# 			has_trait = scholar
# 			OR = {
# 				learning = 15
# 				learning = 20
# 			}
# 		}

# 		# Expose the man's lies and confront him
# 		add_prestige = -50
# 		lose_opinion = { who = ROOT modifier = opinion_modifier value = 15 }

# 		# Start a six-month timer to trigger the event "A Familiar Visitor"
# 		#start_timer = {
# 		#	days = 180
# 		#	# Add the trigger for the event "A Familiar Visitor" as needed
# 		#}
# 	}

# 	option = {
# 		name = TCT_religious_events.80.d
# 		# Use appropriate localization for the option name

# 		trigger = {
# 			has_trait = compassionate
# 			has_trait = forgiving
# 		}

# 		# Give the man some charity
# 		remove_short_term_gold = 10
# 		add_stress = minor_stress_loss
# 		scope:veteran_crusader = {
# 			add_opinion = {
# 				target = root
# 				modifier = veterancrusadersupported
# 				opinion = 10
# 			}
# 		}
# 	}

# 	option = {
# 		name = veteran_option5
# 		# Use appropriate localization for the option name

# 		trigger = {
# 			has_trait = sadistic
# 			has_trait = callous
# 			has_trait = arrogant
# 		}

# 		# Punish the man for his lies
# 		gain_dread = 25
# 		gain_prestige = 100
# 		lose_stress = 25
# 	}

# 	option = {
# 		name = veteran_option6
# 		# Use appropriate localization for the option name

# 		trigger = {
# 			has_trait = compassionate
# 			has_trait = forgiving
# 		}

# 		# Repent for the lies and gain piety
# 		gain_piety = 50
# 		gain_prestige = 10
# 	}
# }




TCT_religious_events.200 = {
	hidden = yes
	immediate = {
		pay_short_term_gold = {
			target = faith.religious_head
			gold = 100
		}
	}
}


# Autocephaly created!
TCT_religious_events.210 = {
	type = character_event
	title = TCT_religious_events.210.t
	desc = TCT_religious_events.210.d
	theme = faith
	
	left_portrait = {
		character = scope:patriarch
		animation = happiness
	}
	right_portrait = {
		character = scope:recipient
		animation = personality_zealous
	}

	option = {
		name = TCT_religious_events.210.a
	}
}

# Interdicted Requester informed the Pope denied their request.
TCT_religious_events.211 = {
	type = letter_event
	opening = {
		desc = TCT_religious_events.211.o
	}
	desc = TCT_religious_events.211
	sender = {
		character = scope:recipient
		animation = dismissal
	}

	option = {
		name = religious_interaction.1000.negative
	}
}

#Ending a Pilgrimage to a Saintly Tomb
TCT_religious_events.250 = { 
	title = TCT_religious_events.250.t
	desc = TCT_religious_events.250.desc
	theme = learning_scholarship_focus
	orphan = yes 
	left_portrait = {
		character = root
	}
	right_portrait = {
		character = scope:localsaint
		animation = personality_rational
	}
	
	immediate = {
		if = {
			limit = {
				location.county = {
					has_variable_list = faith_saints_and_capital
				}
			}
			save_scope_as = saintlocation
		}
		scope:saintlocation = {
			random_in_list = {
				variable = faith_saints_and_capital
	 			save_scope_as = localsaint
			}
		}
		play_music_cue = Trinity_4
	}

	option = { 
		name = TCT_religious_events.300.a

	}
}

#Saint related - finds nearby saint
TCT_religious_events.300 = { 
	title = TCT_religious_events.300.t
	desc = TCT_religious_events.300.desc
	theme = learning_scholarship_focus
	orphan = yes 
	left_portrait = {
		character = scope:popewantsit
	}
	right_portrait = {
		character = scope:localsaint
		animation = personality_rational
	}

	trigger = {
		has_nearby_saint_site = yes
	}

	immediate = {
		capital_county.duchy = {
			random_in_de_jure_hierarchy = {
				continue = {
					tier > tier_county
				}
				limit = {
					tier = tier_county
					has_variable_list = faith_saints_and_capital
				}
				save_scope_as = saintlocation
			}
				
			scope:saintlocation = {
				random_in_list = {
					variable = faith_saints_and_capital
					save_scope_as = localsaint
				}
			}
		}
	}

	option = { 
		name = TCT_religious_events.300.a

	}
}

TCT_religious_events.400 = {
	title = TCT_religious_events.400.t
	desc = TCT_religious_events.400.desc
	theme = learning_scholarship_focus
	left_portrait = {
		character = scope:deadpope
	}
	right_portrait = {
		character = title:k_papal_state.holder
		animation = personality_honorable
		triggered_outfit = {
			trigger = { exists = global_var:cfp_is_loaded }
			outfit_tags = { cardinal_outfit }
		}
		triggered_outfit = {
			trigger = { NOT = { exists = global_var:cfp_is_loaded } }
			outfit_tags = { bishop_outfit }
		}
		hide_info = yes
	}
	lower_center_portrait = {
		character = scope:cardinal1
		animation = ecstasy
		triggered_outfit = {
			trigger = { exists = global_var:cfp_is_loaded }
			outfit_tags = { cardinal_outfit }
		}
		triggered_outfit = {
			trigger = { NOT = { exists = global_var:cfp_is_loaded } }
			outfit_tags = { bishop_outfit }
		}
	}
	lower_left_portrait = {
		character = scope:cardinal2
		animation = content
		triggered_outfit = {
			trigger = { exists = global_var:cfp_is_loaded }
			outfit_tags = { cardinal_outfit }
		}
		triggered_outfit = {
			trigger = { NOT = { exists = global_var:cfp_is_loaded } }
			outfit_tags = { bishop_outfit }
		}
	}
	lower_right_portrait = {
		character = scope:cardinal3
		animation = sadness
		triggered_outfit = {
			trigger = { exists = global_var:cfp_is_loaded }
			outfit_tags = { cardinal_outfit }
		}
		triggered_outfit = {
			trigger = { NOT = { exists = global_var:cfp_is_loaded } }
			outfit_tags = { bishop_outfit }
		}
	}

	immediate = {
		random_living_cardinal = {
			save_scope_as = cardinal1
		}
		random_living_cardinal = {
			limit = { NOT = { this = scope:cardinal1 } }
			save_scope_as = cardinal2
		}
		random_living_cardinal = {
			limit = { NOT = { this = scope:cardinal1 this = scope:cardinal2 } }
			save_scope_as = cardinal3
		}
	}

	option = { 
		name = TCT_religious_events.400.a
		open_view_data = {
			view = royal_court
			player = root
		}
		custom_tooltip = court_maintenance.0010.a.tooltip
		trigger_event = {
			id = TCT_religious_events.4001
		}

		ai_chance = {
			base = 50
		}
	}
}

TCT_religious_events.4001 = {
	type = court_event
	title = TCT_religious_events.4001.t
	desc = TCT_religious_events.4001.desc
	theme = court
	override_background = { reference = throne_room }

	right_portrait = {
		character = title:k_papal_state.holder
		animation = personality_honorable
		triggered_outfit = {
			trigger = { exists = global_var:cfp_is_loaded }
			outfit_tags = { cardinal_outfit }
		}
		triggered_outfit = {
			trigger = { NOT = { exists = global_var:cfp_is_loaded } }
			outfit_tags = { bishop_outfit }
		}
		hide_info = yes
	}


	court_scene = {
		button_position_character = scope:cardinal4 
		court_owner = root
		court_event_force_open = yes
		should_pause_time = yes
		roles = {
		    scope:newpope = {
				group = event_group
				animation = worried
				#outfit_tags = { bishop_outfit }
		    }
			scope:cardinal2 = {
				group = event_group
				animation = worried
				
		    }
			scope:cardinal3 = {
				group = event_group
				animation = worried
				
		    }
			scope:cardinal4 = {
				group = event_group
				animation = worried
				
		    }
			scope:cardinal5 = {
				group = event_group
				animation = worried
				
		    }
			scope:cardinal6 = {
				group = event_group
				animation = worried
				
		    }
			scope:cardinal7 = {
				group = event_group
				animation = worried
		
		    }
		}
	}

	widget = {
		gui = "event_window_widget_event_chain_progress"
		container = "custom_widgets_container"
		controller = event_chain_progress
	}

	immediate = {
		save_scope_as = newpope
		add_character_flag = {
			flag = wearing_cardinal
			days = 3
		}
		if = {
			limit = {
				exists = var:duplicatenameexists
			}
			var:duplicatenameexists = {
				save_scope_as = duplicatedname
			}
		}

		if = {
			limit = {
				has_nickname = nick_cardinal
			}
			remove_nickname = yes
		}

		random_living_cardinal = {
			save_scope_as = cardinal1
		}

		random_living_cardinal = {
			limit = { NOT = { this = scope:cardinal1 } }
			save_scope_as = cardinal2
			court_event_character_flag_effect = yes
		}

		random_living_cardinal = {
			limit = { NOT = { this = scope:cardinal1 this = scope:cardinal2 } }
			save_scope_as = cardinal3
			court_event_character_flag_effect = yes
		}

		random_living_cardinal = {
			limit = { NOT = { this = scope:cardinal1 this = scope:cardinal2 this = scope:cardinal3 } }
			save_scope_as = cardinal4
			court_event_character_flag_effect = yes
		}
		
		random_living_cardinal = {
			limit = { NOT = { this = scope:cardinal1 this = scope:cardinal2 this = scope:cardinal3 this = scope:cardinal4 } }
			save_scope_as = cardinal5
			court_event_character_flag_effect = yes
		}

		random_living_cardinal = {
			limit = { NOT = { this = scope:cardinal1 this = scope:cardinal2 this = scope:cardinal3 this = scope:cardinal4 this = scope:cardinal5 } }
			save_scope_as = cardinal6
			court_event_character_flag_effect = yes
		}

		random_living_cardinal = {
			limit = { NOT = { this = scope:cardinal1 this = scope:cardinal2 this = scope:cardinal3 this = scope:cardinal4 this = scope:cardinal5 this = scope:cardinal6 }}
			save_scope_as = cardinal7
			court_event_character_flag_effect = yes
		}

		# Tracking for how many petitioners have come through.
		set_variable = {
			name = num_petitioners
			value = 2
		}
		# Start a counting variable for widget progress.
		set_variable = {
			name = petitioner_current_progress
			value = 0
		}
		# Widget setup.
		## Set the total length of the chain.
		save_scope_value_as = {
			name = event_chain_length
			value = 3
		}
		## Manually set the current widget length.
		### Due to code-side shenanigans, we do this a bit awkwardly.
		save_scope_value_as = {
			name = event_chain_progress
			value = 1
		}
	}

	option = { 
		name = TCT_religious_events.4001.a
		
		if = {
			limit = {
				this = character:2010
			}
			trigger_event = TCT_religious_events.600
		}
		else = {
			trigger_event = TCT_religious_events.5725
		}	

		ai_chance = {
			base = 50
		}
	}
}

#SELECT A NAME 
#Papal Naming!
TCT_religious_events.5725 = {
	type = character_event
	title = TCT_religious_events.5725.t
	desc = {
		first_valid = {
			#If we're renaming ourself
			triggered_desc = {
				trigger = {
					root = scope:child
				}
				desc = TCT_religious_events.5725.desc.me
			}
			#If we're renaming someone else
			triggered_desc = {
				desc = birth.9004.desc
			}
		}
	}
	theme = family
	override_background = { reference = relaxing_room }
	right_portrait = {
		character = scope:child
		animation = happiness
	}
	#NAMING WIDGET
	widgets = {
		widget = {
			gui = "event_window_widget_event_chain_progress"
			container = "custom_widgets_container"
			controller = event_chain_progress
		}
		widget = {
			is_shown = {
				allow_naming_on_birth_of_child_trigger = { CHILD = scope:child }
			}
			gui = "event_window_widget_name_pope"
			container = "dynamic_birth_name"
			controller = name_character
			setup_scope = {
				scope:child = { save_scope_as = name_character_target }
			}
		}
	}

	court_scene = {
		button_position_character = scope:cardinal4 
		court_owner = root
		court_event_force_open = yes
		should_pause_time = yes
		roles = {
		    scope:newpope = {
				group = event_group
				animation = worried
				
		    }
			scope:cardinal2 = {
				group = event_group
				animation = worried
				
		    }
			scope:cardinal3 = {
				group = event_group
				animation = worried
				
		    }
			scope:cardinal4 = {
				group = event_group
				animation = worried
				
		    }
			scope:cardinal5 = {
				group = event_group
				animation = worried
				
		    }
			scope:cardinal6 = {
				group = event_group
				animation = worried
				
		    }
			scope:cardinal7 = {
				group = event_group
				animation = worried
		
		    }
		}
	}

	immediate = {
		save_scope_as = child

		if = {
			limit = {
				title:k_papal_state.holder = { is_ai = yes }
			}
			title:k_papal_state.holder = {
				random_list = {
					1 = {
						change_first_name = Alexander
					}
					1 = {
						change_first_name = Anastasius
					}
					1 = {
						change_first_name = Caelestinus
					}
					1 = {
						change_first_name = Callistus
					}
					1 = {
						change_first_name = Clemens
					}
					1 = {
						change_first_name = Eugenius
					}
					1 = {
						change_first_name = Leo
					}
					1 = {
						change_first_name = Gregorius
					}
					1 = {
						change_first_name = Hadrianus
					}
					1 = {
						change_first_name = Honorius
					}
					1 = {
						change_first_name = Innocentius
					}
					1 = {
						change_first_name = Ioannes
					}
					1 = {
						change_first_name = Lucius
					}
					1 = {
						change_first_name = Marinus
					}
					1 = {
						change_first_name = Martinus
					}
					1 = {
						change_first_name = Nicolaus
					}
					1 = {
						change_first_name = Sergius
					}
					1 = {
						change_first_name = Silvester
					}
					1 = {
						change_first_name = Stephanus
					}
					1 = {
						change_first_name = Urbanus
					}
					1 = {
						change_first_name = Victor
					}
				}
			}
		}

		# Tracking for how many petitioners have come through.
		set_variable = {
			name = num_petitioners
			value = 2
		}
		# Start a counting variable for widget progress.
		set_variable = {
			name = petitioner_current_progress
			value = 0
		}
		# Widget setup.
		## Set the total length of the chain.
		save_scope_value_as = {
			name = event_chain_length
			value = 3
		}
		## Manually set the current widget length.
		### Due to code-side shenanigans, we do this a bit awkwardly.
		save_scope_value_as = {
			name = event_chain_progress
			value = 2
		}
	}
	#Go ahead
	option = {
		name = birth.9004.a
		trigger_event = TCT_religious_events.401
	}
	after = {
		if = {
			limit = {
				exists = character:2010
				this = character:2010
			}
			change_first_name = Gregorius
		}
	}
}

TCT_religious_events.401 = {
	type = court_event
	title = TCT_religious_events.401.t
	desc = TCT_religious_events.401.desc
	theme = court
	override_background = { reference = throne_room }

	right_portrait = {
		character = title:k_papal_state.holder
		animation = personality_honorable
		triggered_outfit = {
			trigger = { exists = global_var:cfp_is_loaded }
			outfit_tags = { cardinal_outfit }
		}
		triggered_outfit = {
			trigger = { NOT = { exists = global_var:cfp_is_loaded } }
			outfit_tags = { bishop_outfit }
		}
	}

	court_scene = {
		button_position_character = scope:cardinal4 
		court_owner = root
		court_event_force_open = yes
		should_pause_time = yes
		roles = {
		    scope:newpope= {
				group = event_group
				animation = worried
		    }
			scope:cardinal2 = {
				group = event_group
				animation = worried
				
		    }
			scope:cardinal3 = {
				group = event_group
				animation = worried
				
		    }
			scope:cardinal4 = {
				group = event_group
				animation = worried
				
		    }
			scope:cardinal5 = {
				group = event_group
				animation = worried
				
		    }
			scope:cardinal6 = {
				group = event_group
				animation = worried
				
		    }
			scope:cardinal7 = {
				group = event_group
				animation = worried

		    }
		}
	}

	immediate = {
		# Clean up the ol' variable.
		remove_variable = petitioner_current_progress
		# Update the widget one last time.
		save_scope_value_as = {
			name = event_chain_progress
			value = 3
		}
		remove_character_flag = wearing_cardinal
	}

	widget = {
		gui = "event_window_widget_event_chain_progress"
		container = "custom_widgets_container"
		controller = event_chain_progress
	}

	option = { 
		name = TCT_religious_events.401.a

		ai_chance = {
			base = 50
		}
	}
	after = {
		every_ruler = {
			limit = {
				has_faith = faith:catholic
				primary_title.tier >= tier_county
				NOT = { this = faith.religious_head }
				NOT = {
					has_title = title:k_papal_state
				}
			}
			trigger_event = {
				id = TCT_religious_events.402
				days = {5 15}
			}
		}
	}
}

TCT_religious_events.402 = {
	title = TCT_religious_events.402.t
	desc = TCT_religious_events.402.desc
	theme = learning_scholarship_focus
	left_portrait = {
		character = title:k_papal_state.holder
		animation = personality_honorable
	}
	right_portrait = {
		character = scope:cardinal4
		animation = ecstasy
	}

	option = { 
		name = TCT_religious_events.402.a

		ai_chance = {
			base = 50
		}
	}
}

scripted_effect get_held_title_to_donate = {
	clear_variable_list = personally_held_counties_list

	every_held_title = {
		limit = { tier = tier_county NOT = { root.capital_county = this } }
		add_to_list = personally_held_counties_list
	}

	every_in_list = {
		list = personally_held_counties_list
		add_to_prev_list = {NAME = personally_held_counties_list}
	}
}

TCT_religious_events.500 = { 
	title = TCT_religious_events.500.t
	desc = {
		first_valid = {
			triggered_desc = {
				trigger = {
					has_trait = cynical
				}
				desc = TCT_religious_events.500.desc.cynical
			}
			triggered_desc = {
				trigger = {
					NOT = { has_trait = cynical }
				}
				desc = TCT_religious_events.500.desc
			}
		}
	}

	widget = {
		gui = "donation_to_clergy_title_selection_widget"
		container = "custom_widgets_container"
	}

	theme = learning_scholarship_focus
	left_portrait = {
		character = root
	}

	immediate = {
		remove_variable = selected_title
		clear_variable_list = personally_held_counties_list
		get_held_title_to_donate = yes
	}

	option = {
		name = TCT_religious_events.500.a
		if = {
			limit = { has_variable = selected_title }
			var:selected_title = {
				save_scope_as = selected_title
			}
			# set_variable = {
			# 	name = selected_title_kingdom
			# 	value = var:selected_title
			# }
			custom_tooltip = TCT_religious_events.500.a.tt
			hidden_effect = {
				create_character = {
					template = priest_character_template
					location = root.capital_province
					save_scope_as = template_priest
				}
				create_title_and_vassal_change = {
					type = granted
					save_scope_as = title_change
					add_claim_on_loss = no
				}
				scope:selected_title = {
					change_title_holder = {
						holder = scope:template_priest
						change = scope:title_change
					}
				}
				resolve_title_and_vassal_change = scope:title_change
				scope:template_priest = {
					add_realm_law = bishop_theocratic_succession_law
					change_government = theocracy_government
				}
			}
			add_piety = 500
			TCT_get_pope_of_target = {
				TARGET = root
			}
			scope:pope_of_target = {
				add_opinion = {
					target = root
					modifier = grantedlandtoclergy
					opinion = 10
				}
			}
			add_character_modifier = {
				modifier = donatedlandtoclergy
				years = 5
			}

			ai_chance = {
				base = 100
			}
		}
		else = {
			remove_decision_cooldown = DonationCountyClergy
		}
	}
	option = {
		name = TCT_religious_events.500.b
		remove_decision_cooldown = DonationCountyClergy
	}
}

#Election of Pope Gregory VII
TCT_religious_events.600 = {
	title = TCT_religious_events.600.t
	desc = TCT_religious_events.600.desc
	theme = faith
	right_portrait = {
		character = title:k_papal_state.holder
		animation = personality_honorable
		triggered_outfit = {
			trigger = { exists = global_var:cfp_is_loaded }
			outfit_tags = { cardinal_outfit }
		}
		triggered_outfit = {
			trigger = { NOT = { exists = global_var:cfp_is_loaded } }
			outfit_tags = { bishop_outfit }
		}
		hide_info = yes
	}

	widgets = {
		widget = {
			gui = "event_window_widget_event_chain_progress"
			container = "custom_widgets_container"
			controller = event_chain_progress
		}
	}
	
	trigger = {
		exists = character:2010
		character:2010 = {
			is_alive = yes
		}
	}

	immediate = {
		# Widget setup.
		## Set the total length of the chain.
		save_scope_value_as = {
			name = event_chain_length
			value = 3
		}
		## Manually set the current widget length.
		### Due to code-side shenanigans, we do this a bit awkwardly.
		save_scope_value_as = {
			name = event_chain_progress
			value = 2
		}
	}

	option = {
		name = TCT_religious_events.600.a
		trigger_event = TCT_religious_events.401
		hidden_effect = {
			if = {
				limit = {
					exists = character:2010
					this = character:2010
				}
				change_first_name = Gregorius
			}
		}
	}
}

#Non_events

TCT_religious_events.799 = { 
	title = TCT_religious_events.799.t
	desc = TCT_religious_events.799.desc
	theme = learning_scholarship_focus
	left_portrait = {
		character = scope:cardinal
	}
	right_portrait = {
		character = scope:popeman
	}

	immediate = {
		faith = {
			religious_head = {
				save_scope_as = popeman
			}
		}
		random_living_cardinal = {
			save_scope_as = cardinal
		}
	}

	option = { 
		name = TCT_religious_events.799.a
		dictatuspapae = yes

		every_ruler = {
			limit = {
				has_faith = faith:catholic
				primary_title.tier >= tier_county
				NOT = { this = faith.religious_head }
			}
			trigger_event = {
				id = TCT_religious_events.800
				days = {5 15}
			}
		}

		ai_chance = {	
			base = 100
		}
	}
}

TCT_religious_events.800 = { 
	title = TCT_religious_events.800.t
	desc = TCT_religious_events.800.desc
	theme = learning_scholarship_focus
	left_portrait = {
		character = scope:popewantsit
	}
	right_portrait = {
		character = scope:popeman
	}

	immediate = {
		faith = {
			religious_head = {
				save_scope_as = popeman
			}
		}
		play_music_cue = Trinity_1
	}

	option = { 
		name = TCT_religious_events.800.a
		trigger = {
			NOT = {
				this = title:e_hre.holder
			}
		}

		ai_chance = {	
			base = 100
		}
	}

	#Who does he think he is?

	option = {
		name = TCT_religious_events.800.b
		trigger = {
			this = title:e_hre.holder
		}
		custom_tooltip = TCT_religious_events.800.b.imperial_refusal
		title:k_papal_state.holder = {
			add_opinion = {
				target = title:e_hre.holder
				modifier = insulted_opinion
				value = -60
			}
		}
		title:e_hre.holder = {
			add_opinion = {
				target = title:k_papal_state.holder
				modifier = insulted_opinion
				value = -60
			}
		}
		start_struggle = {
			struggle_type = investiture_controversy_struggle
			start_phase = investiture_controversy_phase_unrest
		}
	}

	# We submit
	option = {
		name = TCT_religious_events.800.c
		trigger = {
			this = title:e_hre.holder
		}

		add_realm_law = papal_investiture_late
	}
}

TCT_religious_events.802 = {
	hidden = yes

	immediate = {
		every_in_global_list = {
			variable = rulersthathaveinvestiture
			add_realm_law_skip_effects = free_investiture_late
		}
	}
}

TCT_religious_events.801 = {
	hidden = yes

	immediate = {
		faith = { update_cardinal_window = yes }
	}
}

#
#Launching a Crusade

TCT_religious_events.803 = {
	title = TCT_religious_events.803.t
	desc = TCT_religious_events.803.desc
	theme = learning_scholarship_focus
	left_portrait = {
		character = scope:pope
	}

	immediate = {
		faith.religious_head = {
			save_scope_as = pope
			add_character_modifier = {
				modifier = public_opinion_positive
				days = 10
			}
		}
		title:k_orthodox.holder = {
			save_scope_as = eastern_patriarch
		}
		play_music_cue = Trinity_3
	}

	option = {
		name = TCT_religious_events.803.a
		
	}
}

TCT_religious_events.805 = {
	hidden = yes

	trigger = {
		OR = {
			has_trait = cardinal_archbishop
			has_trait = cardinal_bishop
			has_trait = cardinal_priest
		}
	}

	immediate = {
		if = {
			limit = {
				has_trait = cardinal_archbishop
				highest_held_title_tier < tier_duchy
				is_landed = yes
			}
			remove_trait = cardinal_archbishop
			add_trait = cardinal_bishop
		}
		if = {
			limit = {
				has_trait = cardinal_bishop
				is_landed = no
			}
			remove_trait = cardinal_bishop
			add_trait = cardinal_priest
		}
	}

	option = {
		name = TCT_religious_events.803.a
		
	}
}

TCT_religious_events.806 = {
	hidden = yes

	trigger = {
		OR = {
			has_trait = cardinal_archbishop
			has_trait = cardinal_bishop
			has_trait = cardinal_priest
		}
	}

	immediate = {
		if = {
			limit = {
				has_trait = cardinal_bishop
				highest_held_title_tier >= tier_duchy
			}
			remove_trait = cardinal_bishop
			add_trait = cardinal_archbishop
		}
		if = {
			limit = {
				has_trait = cardinal_priest
				is_landed = yes
			}
			remove_trait = cardinal_priest
			add_trait = cardinal_bishop
		}
	}
}


TCT_religious_events.807 = {
	hidden = yes

	immediate = {
		if = {
			limit = {
				faith = {
					has_doctrine = doctrine_independent_papacy_head
					religion_tag = christianity_religion
				}	
				NOT = {
					faith.religious_head = {
						has_title = title:k_papal_state
					}
				}
			}
			faith = {
				remove_doctrine = doctrine_independent_papacy_head
				add_doctrine = doctrine_spiritual_head
			}
			trigger_event = faith_creation.0002
		}
	}
}


scripted_effect nearby_crusader_state_targets = {
	clear_variable_list = minor_cruades_possible_titles
	title:k_jerusalem.holder = {
		#Find a county we hold which borders a valid event target county.
		every_sub_realm_county = {
			limit = {
				any_neighboring_county = {
					holder = {
						NOT = {
							faith = root.faith
							top_liege = title:k_jerusalem.holder.top_liege
						}
					}
				}
			}
			save_scope_as = my_county

			#Find a valid event target county.
			random_neighboring_county = {
				limit = {
					holder = {
						NOT = {
							faith = root.faith
							top_liege = title:k_jerusalem.holder.top_liege
						}
					}
				}		

				#Save that county's scope.
				save_scope_as = target_county
				add_to_list = minor_cruades_possible_titles

				#Also save the county's holder.
				holder = {
					save_scope_as = heretic_ruler
				}
			}
		}
	}

	every_in_list = {
		list = minor_cruades_possible_titles
		# order_by = development_level
		# max = 15
		# check_range_bounds = no
		add_to_prev_list = {NAME = minor_cruades_possible_titles}
	}
}

TCT_religious_events.810 = {
	title = TCT_religious_events.810.t
	desc = TCT_religious_events.810.desc

	right_portrait = {
		character = root
		animation = personality_rational
	}
	widget = {
		gui = "minor_crusade_title_selection"
		container = "custom_widgets_container"
	}
	theme = diplomacy_foreign_affairs_focus

	immediate = {
		remove_variable = selected_title
		clear_variable_list = minor_cruades_possible_titles
		nearby_crusader_state_targets = yes
	}

	option = {
		name = TCT_religious_events.810.a
		if = {
			limit = { has_variable = selected_title }
			#create_cultural_specialist_effect = yes
			#scope:cultural_specialist = { apply_cultural_traits_effect = yes } 
			#recruit_courtier = scope:cultural_specialist
			#custom_tooltip = newline.desc
			var:selected_title = {
				save_scope_as = selected_title
			}
			set_variable = {
				name = selected_title_kingdom
				value = var:selected_title.kingdom
			}
			start_war = {
				casus_belli = minor_crusade_religious_war
				target = var:selected_title.holder
				target_title = var:selected_title
				claimant = title:k_jerusalem.holder
			}
			every_character_war = {
				limit = {
					primary_attacker = root
					using_cb = minor_crusade_religious_war
				}
				save_scope_as = war
				add_attacker = title:k_jerusalem.holder
				set_variable = {
					name = cruasder_state_holder
					value = title:k_jerusalem.holder
				}
			}
		}
		else = {
			custom_tooltip = TCT_religious_events.810.a.cancel
			remove_decision_cooldown = Declare_Minor_Crusade
		}
	}
}

#Crusader trait gained during GHW.
#Fired on_army_enter_province
#Hidden first event fires for the owner of the army.
#root = owner of the army
#scope:army = the army itself.
TCT_religious_events.811 = {
	hidden = yes
	
	trigger = {
		exists = var:selected_title

		OR = { #Either army owner or one of his lieges is involved in a GHW.
			any_character_war = {
				OR = {
					using_cb = minor_crusade_religious_war
				}
				is_attacker = root
			}
			any_liege_or_above = {
				faith = root.faith
				any_character_war = {
					OR = {
						using_cb = minor_crusade_religious_war
					}
					is_attacker = root
				}
			}
		}
		scope:army = {
			exists = army_commander
			location = { save_temporary_scope_as = current_location }
			army_commander = {
				NOR = {
					has_trait = crusader_king
					has_trait = faith_warrior
				}
			}
		}
		var:selected_title_kingdom = { #The dejure Kingdom targeted by the GHW
			any_in_de_jure_hierarchy = {
				tier = tier_barony
				title_province = { this = scope:current_location } #Any province within it.
				# exists = holder
				# holder = { #The province's owner must also be part of the GHW on the opposite side.
				# 	OR = {
				# 		any_character_war = {
				# 			OR = {
				# 				using_cb = minor_crusade_religious_war
				# 			}
				# 			is_defender = prev
				# 		}
				# 		any_liege_or_above = {
				# 			any_character_war = {
				# 				OR = {
				# 					using_cb = minor_crusade_religious_war
				# 				}
				# 				is_defender = prev
				# 			}
				# 		}
				# 	}
				# }
			}
		}
	}

	immediate = {
		faith = {
			save_scope_as = the_faith
		}
		random_character_war = {
			if = {
				limit = {
					using_cb = minor_crusade_religious_war
				}
				save_scope_as = war
			}
		}

		scope:army.location = { save_scope_as = current_location }
		root.faith = { save_scope_as = the_faith }
		scope:war = { save_scope_as = scoped_ghw }
		var:selected_title = { save_scope_as = selected_title }
		var:selected_title_kingdom = { save_scope_as = target_kingdom }
		scope:army = {
			army_commander = { trigger_event = TCT_religious_events.812 }
			army_owner = {
				every_knight = {
					limit = {
						location = scope:current_location
					}
					trigger_event = TCT_religious_events.812
				}
			}
		}
	}
}

TCT_religious_events.812 = {
	title = TCT_religious_events.812.title
	desc = {
		first_valid = {
			triggered_desc = { #Crusaders
				trigger = { faith.religion = religion:christianity_religion }
				desc = TCT_religious_events.812.crusader.desc
			}
			triggered_desc = { #Muslims
				trigger = { faith.religion = religion:islam_religion }
				desc = great_holy_war.0057.mujahid.desc
			}
			triggered_desc = { #Everybody else
				trigger = {
					NOR = {
						faith.religion = religion:christianity_religion
						faith.religion = religion:islam_religion
					}
				}
				desc = great_holy_war.0057.generic.outsiders.desc
			}
		}
	}
	theme = faith
	override_background = {
		reference = wilderness_scope
	}
	left_portrait = root
	
	trigger = {
		# root.faith = scope:the_faith
		# exists = faith.great_holy_war
		NOR = {
			has_trait = crusader_king
			has_trait = faith_warrior
		}
		OR = {
			is_commanding_army = yes
			is_knight = yes
		}
	}

	immediate = {
		scope:war = {
			primary_defender = {
				capital_province = {
					save_scope_as = background_wilderness_scope
				}
			}
		}
	}
	
	option = {
		name = TCT_religious_events.812.a
		add_trait = faith_warrior
		hidden_effect = { #Punish player sneakery.
			trigger_event = {
				id = TCT_religious_events.813
				days = { 15 60 }
			}
		}
	}
}

#Character is no longer in the Holy Land fighting infidels, not even a few weeks after getting the trait!
TCT_religious_events.813 = {
	title = TCT_religious_events.813.title
	desc = TCT_religious_events.813.base.desc
	theme = faith
	left_portrait = {
		character = root
		animation = shame
	}
	
	trigger = {
		exists = scope:war #GHW must still be ongoing.
		has_trait = faith_warrior
		is_commanding_army = no #Should have stayed in command.
		is_knight = no
		is_imprisoned = no #Don't penalise captured faith_warriors.
		NOR = {
			has_trait = incapable
			has_serious_disease_trigger = yes
		}
		OR = { #Character or liege must still be at war, obviously.
			any_character_war = {
				OR = {
					using_cb = minor_crusade_religious_war
				}
				is_attacker = root
			}
			any_liege_or_above = {
				faith = root.faith
				any_character_war = {
					OR = {
						using_cb = minor_crusade_religious_war
					}
					is_attacker = root
				}
			}
		}
	}
	
	
	option = {
		name = great_holy_war.0058.a
		if = {
			limit = { is_ai = no } #Punish player more.
			add_piety = major_piety_loss
		}
		if = {
			limit = { has_trait = faith_warrior }
			remove_trait = faith_warrior
		}
	}
}

#Crusader gets an event to decide to try to carve out a Crusader State during a GHW.
#Fired on_army_enter_province
#Hidden first event fires for the owner of the army.
#root = owner of the army
#scope:army = the army itself.
great_holy_war.0060 = {
	hidden = yes
	
	trigger = {
		exists = root.faith.great_holy_war
		OR = { #Either army owner or one of his lieges is involved in a GHW.
			any_character_war = {
				OR = {
					using_cb = undirected_great_holy_war
					using_cb = directed_great_holy_war
				}
				is_attacker = root
			}
			any_liege_or_above = {
				faith = root.faith
				any_character_war = {
					OR = {
						using_cb = undirected_great_holy_war
						using_cb = directed_great_holy_war
					}
					is_attacker = root
				}
			}
		}
		scope:army = {
			exists = army_commander
			location = { save_temporary_scope_as = current_location }
			army_commander = {
				NOR = {
					has_trait = crusader_king
					has_trait = faith_warrior
				}
			}
		}
		root.faith.great_holy_war.ghw_target_title = { #The dejure Kingdom targeted by the GHW
			any_in_de_jure_hierarchy = {
				tier = tier_barony
				title_province = { this = scope:current_location } #Any province within it.
				exists = holder
				holder = { #The province's owner must also be part of the GHW on the opposite side.
					OR = {
						any_character_war = {
							OR = {
								using_cb = undirected_great_holy_war
								using_cb = directed_great_holy_war
							}
							is_defender = prev
						}
						any_liege_or_above = {
							any_character_war = {
								OR = {
									using_cb = undirected_great_holy_war
									using_cb = directed_great_holy_war
								}
								is_defender = prev
							}
						}
					}
				}
			}
		}
	}

	immediate = {
		scope:army.location = { save_scope_as = current_location }
		faith = { save_scope_as = the_faith }
		faith.great_holy_war = { save_scope_as = scoped_ghw }
		faith.great_holy_war.ghw_target_title = { save_scope_as = target_kingdom }
		scope:army = {
			army_commander = { trigger_event = great_holy_war.0057 }
			army_owner = {
				every_knight = {
					limit = {
						location = scope:current_location
					}
					trigger_event = great_holy_war.0057
				}
			}
		}
	}
}