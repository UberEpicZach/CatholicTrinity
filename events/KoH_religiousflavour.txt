namespace = KoH_religiousflavour


KoH_religiousflavour.1 = { #A Pope and His Estates
	title = KoH_religiousflavour.1.t
	desc = KoH_religiousflavour.1.desc
	theme = unfriendly
	left_portrait = {
		character = this
	}

	trigger = {		
		exists = title:k_papal_state.holder 
		title:k_papal_state.holder.faith = root.faith
		title:k_papal_state.holder.dynasty = root.dynasty  
		title:k_papal_state.holder = { NOT = { OR = { has_trait = greedy has_trait = zealous } } }

		OR = {
			any_sibling = {
				is_male = yes
				is_ruler = no
				root.primary_title = {
					place_in_line_of_succession = {
					  target = PREV
					  value > 2
					}
				}
			}
			any_child = {
				is_male = yes
				is_ruler = no
				root.primary_title = {
					place_in_line_of_succession = {
					  target = PREV
					  value > 2
					}
				}
			}
		}
	}

	immediate = {
		scripted_effect_popethingevent = {}
	}

	option = { 
		name = KoH_religiousflavour.1.a

		
			scope:player_one = {
				add_opinion = {
					target = title:k_papal_state.holder 
					opinion = 100
					modifier = grateful_opinion
				} 
				add_opinion = {
					target = ROOT
					opinion = 100
					modifier = grateful_opinion
				} 

				set_employer = title:k_papal_state.holder 
				add_character_modifier = {
					modifier = koh_governs_vast_estates
					years = 5
				}
			}

			scope:player_two = { 
				add_opinion = {
					target = title:k_papal_state.holder 
					opinion = 100
					modifier = grateful_opinion
				} 

				add_reverse_opinion = {
					target = ROOT
					opinion = 100
					modifier = grateful_opinion
				} 
				set_employer = title:k_papal_state.holder 
				add_character_modifier = {
					modifier = koh_governs_vast_estates
					years = 5
				}
			}
			
			title:k_papal_state.holder = {
				add_opinion = {
					target = scope:player_one
					opinion = 20
					modifier = grateful_opinion
				} 

				add_opinion = {
					target = scope:player_two
					opinion = 20
					modifier = grateful_opinion
				} 

				add_opinion = {
					target = ROOT
					opinion = 15
					modifier = grateful_opinion
				}
			}
		
		ai_chance = {
			base = 100
		}
	}

	# option = {
	# 	name = KoH_religiousflavour.1.b

	# 	add_piety = 50

	# 	title:k_papal_state.holder = {
	# 		add_opinion = {
	# 			target = ROOT
	# 			opinion = -15
	# 			modifier = disappointed_opinion
	# 		}
	# 	}
	# }

	# option = {
	# 	name = KoH_religiousflavour.1.c
	# 	trigger = {
	# 		OR = {
	# 			has_trait = zealous
	# 			learning <= 10
	# 		}
	# 	add_piety = 50

	# 	title:k_papal_state.holder = {
	# 		add_opinion = {
	# 			target = ROOT
	# 			opinion = -15
	# 			modifier = disappointed_opinion
	# 		}
	# 		add_piety = -100
	# 	}
	# 	add_piety = 200
	# 	add_learning_skill = 1
	# 	}
	# }
}

KoH_religiousflavour.2 = { #Monks Make Good Beer
	title = KoH_religiousflavour.2.t
	desc = KoH_religiousflavour.2.desc
	theme = learning_scholarship_focus
	left_portrait = {
		character = this
	}

	trigger = {		
		is_commanding_army = no
		is_adult = yes
		is_imprisoned = no
		has_religion = religion:christianity_religion
		# OR = {
		# 	location = {
		# 		region = world_europe_west
		# 	}
		# 	location = {
		# 		region = world_europe_south
		# 	}
		# }
	}

	option = { 
		name = KoH_religiousflavour.2.a

		random = {
			chance = 50
		}
		if = {
			limit = { NOT = { has_trait = drunkard } }
			random = {
				chance = 20
				add_trait = drunkard
				send_interface_toast = {
					type = event_toast_effect_bad
					title = "You have become a Drunkard"
					left_icon = root
				}
			}
		}

		ai_chance = {
			base = 50
		}
	}

	option = { 
		name = KoH_religiousflavour.2.b

		if = {
			limit = { NOT = { has_trait = temperate } }
			random = {
				chance = 20
				add_trait = temperate
				send_interface_toast = {
					type = event_toast_effect_good
					title = "You have become Temperate"
					left_icon = root
				}
			}
		}

		ai_chance = {
			base = 50
		}
	}
}

KoH_religiousflavour.3 = { #Monks Make Good Wine
	title = KoH_religiousflavour.3.t
	desc = KoH_religiousflavour.3.desc
	theme = learning_scholarship_focus
	left_portrait = {
		character = this
	}

	trigger = {		
		is_commanding_army = no
		is_adult = yes
		is_imprisoned = no
		has_religion = religion:christianity_religion
		# OR = {
		# 	location = {
		# 		region = world_europe_west
		# 	}
		# 	location = {
		# 		region = world_europe_south
		# 	}
		# }
	}

	option = { 
		name = KoH_religiousflavour.3.a

		random = {
			chance = 50
			add_learning_skill = 1
		}
		if = {
			limit = { NOT = { has_trait = drunkard } }
			random = {
				chance = 20
				add_trait = drunkard
				send_interface_toast = {
					type = event_toast_effect_bad
					title = "You have become a Drunkard"
					left_icon = root
				}
			}
		}

		ai_chance = {
			base = 50
		}
	}

	option = { 
		name = KoH_religiousflavour.3.b

		if = {
			limit = { NOT = { has_trait = temperate } }
			random = {
				chance = 20
				add_trait = temperate
				send_interface_toast = {
					type = event_toast_effect_good
					title = "You have become Temperate"
					left_icon = root
				}
			}
		}

		ai_chance = {
			base = 50
		}
	}
}
KoH_religiousflavour.4 = { #Monks have healing herbs
	title = KoH_religiousflavour.4.t
	desc = KoH_religiousflavour.4.desc
	theme = learning_scholarship_focus
	left_portrait = {
		character = this
	}

	trigger = {		
		is_commanding_army = no
		is_adult = yes
		is_imprisoned = no
		piety_level >= 1
		OR = {
			has_trait = ill
		}
		has_religion = religion:christianity_religion
		# OR = {
		# 	location = {
		# 		region = world_europe_west
		# 	}
		# 	location = {
		# 		region = world_europe_south
		# 	}
		# }
	}

	option = { 
		name = KoH_religiousflavour.4.a

		random = {
			chance = 30
			remove_trait = ill
		}

		ai_chance = {
			base = 80
		}
	}

	option = { 
		name = KoH_religiousflavour.4.b

		if = {
			limit = { NOT = { has_trait = paranoid } }
			add_trait = paranoid
		}
	}
}

KoH_religiousflavour.5 = { #Monks is fantastic painter
	title = KoH_religiousflavour.5.t
	desc = KoH_religiousflavour.5.desc
	theme = learning_scholarship_focus
	left_portrait = {
		character = this
	}

	trigger = {		
		is_commanding_army = no
		is_adult = yes
		is_imprisoned = no
		has_religion = religion:christianity_religion
		NOT = { has_trait = blind }
		# OR = {
		# 	location = {
		# 		region = world_europe_west
		# 	}
		# 	location = {
		# 		region = world_europe_south
		# 	}
		# }
	}

	option = { 
		name = KoH_religiousflavour.5.a

		remove_short_term_gold = -10
		add_prestige = 30
	}

	option = { 
		name = KoH_religiousflavour.5.b

	}
}

# KoH_religiousflavour.6 = { #Monks is fantastic painter
# 	title = KoH_religiousflavour.6.t
# 	desc = KoH_religiousflavour.6.desc
# 	theme = learning_scholarship_focus
# 	left_portrait = {
# 		character = this
# 	}

# 	trigger = {		
# 		is_commanding_army = no
# 		is_adult = yes
# 		is_imprisoned = no
# 		has_religion = religion:christianity_religion
# 		NOT = { has_trait = blind }
# 		# OR = {
# 		# 	location = {
# 		# 		region = world_europe_west
# 		# 	}
# 		# 	location = {
# 		# 		region = world_europe_south
# 		# 	}
# 		# }
# 	}

# 	option = { 
# 		name = KoH_religiousflavour.6.a

# 		remove_short_term_gold = -10
# 		add_prestige = 30
# 	}

# 	option = { 
# 		name = KoH_religiousflavour.6.b

# 	}
# }

KoH_religiousflavour.7 = { #Monks is fantastic painter
	title = KoH_religiousflavour.7.t
	desc = KoH_religiousflavour.7.desc
	theme = learning_scholarship_focus
	left_portrait = {
		character = this
	}

	trigger = {		
		is_commanding_army = no
		is_adult = yes
		is_imprisoned = no
		has_religion = religion:christianity_religion
		# OR = {
		# 	location = {
		# 		region = world_europe_west
		# 	}
		# 	location = {
		# 		region = world_europe_south
		# 	}
		# }
	}

	option = { 
		name = KoH_religiousflavour.7.a

		remove_short_term_gold = -30
		add_prestige = 30
		random = {
			chance = 20
			add_learning_skill = 1
		}
	}
	option = { 
		name = KoH_religiousflavour.7.b

	}
}

KoH_religiousflavour.8 = { #Monks is fantastic painter
	title = KoH_religiousflavour.8.t
	desc = KoH_religiousflavour.8.desc
	theme = learning_scholarship_focus
	left_portrait = {
		character = this
	}

	trigger = {		
		is_commanding_army = no
		is_adult = yes
		is_imprisoned = no
		has_religion = religion:christianity_religion
		# OR = {
		# 	location = {
		# 		region = world_europe_west
		# 	}
		# 	location = {
		# 		region = world_europe_south
		# 	}
		# }
	}

	option = { 
		name = KoH_religiousflavour.8.a

		add_piety = 20

		random = {
			chance = 30
			add_learning_skill = 1
		}
	}
	option = { 
		name = KoH_religiousflavour.8.b
		if = {
			limit = { NOT = { has_trait = cynical } }
			add_trait = cynical
		}
	}
}

# KoH_religiousflavour.9 = { #Child wants to be monk/nun - select child
# 	title = KoH_religiousflavour.9.t
# 	desc = KoH_religiousflavour.9.desc
# 	theme = learning_scholarship_focus
# 	left_portrait = {
# 		character = this
# 	}
# 	hidden = yes

# 	trigger = {		
# 		is_commanding_army = no
# 		is_adult = yes
# 		is_imprisoned = no
# 		has_religion = religion:christianity_religion
# 		any_child = {
# 			is_ruler = no
# 			age = 13
# 			NOT = { age = 16 }
# 			NOT = { has_trait = cynical }
# 			NOT = { is_clergy = yes }
# 		}
# 	}

# 	immediate = {
# 		random_child = {
# 			limit = {
# 				is_ruler = no
# 				age = 13
# 				NOT = { age = 16 }
# 				NOT = { has_trait = cynical }
# 				NOT = { is_clergy = yes }
# 			}
# 			trigger_event = KoH_religiousflavour.10
# 		}
# 	}
# }

# KoH_religiousflavour.10 = { #MChild Event
# 	#title = KoH_religiousflavour.10.t
# 	#desc = KoH_religiousflavour.10.desc
# 	theme = learning_scholarship_focus
# 	left_portrait = {
# 		character = this
# 	}
# 	hidden = yes

# 	immediate = {
# 		FROM = {
# 			trigger_event = KoH_religiousflavour.11  }
# 	}
# }

# KoH_religiousflavour.11 = { #Child wants to be monk/nun - parent response
# 	title = KoH_religiousflavour.11.t
# 	desc = KoH_religiousflavour.11.desc
# 	theme = learning_scholarship_focus
# 	left_portrait = {
# 		character = this
# 	}
# 	right_portrait = {
# 		character = FROM
# 	}

# 	option = { 
# 		name = KoH_religiousflavour.11.a

# 		FROM = {
# 			add_trait = devoted
# 			add_opinion = {
# 				target = ROOT
# 				opinion = 50
# 				modifier = grateful_opinion
# 			}
# 		}
# 		custom_tooltip = { text = KoH_religiousflavour.11.a.tt}
# 	}

# 	option = { 
# 		name = KoH_religiousflavour.11.b
# 		FROM = {
# 			add_stress = major_stress_loss
# 			add_opinion = {
# 				target = ROOT
# 				opinion = 50
# 				modifier = angry_opinion
# 			}
# 		}
# 	}
# }

KoH_religiousflavour.12 = { #Donate to local monastery
	title = KoH_religiousflavour.12.t
	desc = KoH_religiousflavour.12.desc
	theme = learning_scholarship_focus
	left_portrait = {
		character = this
	}
	
	trigger = {		
		is_commanding_army = no
		is_adult = yes
		is_imprisoned = no
		has_religion = religion:christianity_religion
	}

	option = { 
		name = KoH_religiousflavour.12.a
		remove_short_term_gold = -30
		add_piety = 30
	}
	
	option = { 
		name = KoH_religiousflavour.12.b
		add_piety = -30
	}
}

KoH_religiousflavour.13 = { #Duty-Bound
	title = KoH_religiousflavour.13.t
	desc = KoH_religiousflavour.13.desc
	theme = learning_scholarship_focus
	right_portrait = {
		character = scope:Priest
	}
	lower_right_portrait = {
		character = scope:lover
	}

	trigger = {		
		has_religion = religion:christianity_religion
		any_vassal_or_below = {
			AND = {
				has_government = theocracy_government
				OR = {
					has_trait = reveler_1
					has_trait = reveler_2
					has_trait = reveler_3
					has_trait = drunkard
					has_trait = lustful 
				}
			} 
		}
	}

	immediate = {
		random_vassal_or_below = {
			limit = {
				AND = {
					has_government = theocracy_government
					OR = {
						has_trait = reveler_1
						has_trait = reveler_2
						has_trait = reveler_3
						has_trait = drunkard
						has_trait = lustful 
					}
				}
			}
			save_scope_as = Priest 
		}

		create_character = {
			template = beautiful_peasant_character
			age = { 17 22 }
			gender_female_chance = root_attraction_based_female_chance
			employer = scope:Priest.host
			faith = scope:Priest.host.faith
			culture = scope:Priest.host.culture
			save_scope_as = lover
		}

		scope:Priest = {
			set_relation_lover = scope:lover
		}
	}

	option = { 
		name = KoH_religiousflavour.13.a
		
		scope:Priest = {
			add_trait = Deviant

			if = {
				limit = { exists = dynasty }
				dynasty = {
					add_dynasty_prestige = medium_dynasty_prestige_loss
				}
			}
			add_piety = -1
			add_piety_level = -1
		}
	}
}

KoH_religiousflavour.14 = { #Duty-Bound - Varaint
	title = KoH_religiousflavour.14.t
	desc = KoH_religiousflavour.14.desc
	theme = learning_scholarship_focus
	right_portrait = {
		character = scope:Priest
	}
	lower_right_portrait = {
		character = scope:lover
	}

	trigger = {		
		has_religion = religion:christianity_religion

		exists = dynasty
		dynasty = { 
			any_dynasty_member = { 
				AND = {
					is_alive = yes
					age >= 18
					dynasty = root.dynasty
					has_government = theocracy_government
					OR = {
						has_trait = reveler_1
						has_trait = reveler_2
						has_trait = reveler_3
						has_trait = drunkard
						has_trait = lustful 
					}
				} 
			}
		}
	}

	immediate = {
		dynasty = { 
			every_dynasty_member = { 
				AND = {
					is_alive = yes
					age >= 18
					AND = {
						dynasty = root.dynasty
						has_government = theocracy_government
						OR = {
							has_trait = reveler_1
							has_trait = reveler_2
							has_trait = reveler_3
							has_trait = drunkard
							has_trait = lustful 
						}
					}
				}
				save_scope_as = Priest 
			}
		}

		create_character = {
			template = beautiful_peasant_character
			age = { 17 22 }
			gender_female_chance = root_attraction_based_female_chance
			employer = scope:Priest.host
			faith = scope:Priest.host.faith
			culture = scope:Priest.host.culture
			save_scope_as = lover
		}

		scope:lover = {
			set_relation_lover = scope:Priest
		}
	}

	option = { 
		name = KoH_religiousflavour.14.a
		
		scope:Priest = {
			add_trait = Deviant

			if = {
				limit = { exists = dynasty }
				dynasty = {
					add_dynasty_prestige = medium_dynasty_prestige_loss
				}
			}
			add_piety = -1
			add_piety_level = -1
		}
	}
}

#cardinal names
KoH_religiousflavour.22 = {
	hidden = yes

	immediate = {
		every_living_cardinal = {
			add_prestige = 1
			add_trait = koh_cardinal
			#give_nickname = nick_cardinal
			# if = {
			# 	limit = {
			# 		OR = {
			# 			has_council_position = councillor_court_chaplain
			# 			is_theocratic_lessee = yes
			# 			is_landed = no
			# 		}
			# 	}
			# 	give_nickname = nick_cardinal
			# }
		}
	}
}

#cardinal election won
KoH_religiousflavour.23 = {
	hidden = yes

	immediate = {
		send_interface_toast = {
			title = "Cardinal Election"				
			right_icon = prev
			
			custom_tooltip = "You have gained a hook"
		}
	}
}

#The Pope and an Investiture Free Realm
# The Pope singles out a Kingdom with Free Investiture (unless he has already targetted one)
#Event 1
KoH_religiousflavour.24 = { 
	title = KoH_religiousflavour.24.t
	desc = KoH_religiousflavour.24.desc
	theme = learning_scholarship_focus
	left_portrait = {
		character = this
		
	}
	right_portrait = {
		character = scope:popewantsit
	}
	
	trigger = {		
		has_title = title:k_papal_state
		this = faith.religious_head
		is_imprisoned = no
		has_religion = religion:christianity_religion
		has_faith = faith:catholic
		current_year >= 1000
		#change_fervor = -20
		faith = { fervor >= 50 }


		any_independent_ruler = {
			has_realm_law = free_investiture
			highest_held_title_tier >= tier_duchy
			has_faith = faith:catholic
			title:k_papal_state.holder = faith.religious_head

			NOR = {
				has_character_flag = pope_wants_our_law_changed
				has_character_flag = pope_respects_our_law	
			}
		}
	}

	immediate = {
		random_independent_ruler = {
			limit = {
				has_realm_law = free_investiture
				highest_held_title_tier >= tier_duchy
				has_faith = faith:catholic
				title:k_papal_state.holder = faith.religious_head

				NOR = {
					has_character_flag = pope_wants_our_law_changed
					has_character_flag = pope_respects_our_law	
				}
			}
			save_scope_as = popewantsit
		}
	}

	option = { 
		name = KoH_religiousflavour.24.a
		add_character_flag = pope_currently_demanding

		if = {
			limit = {
				scope:popewantsit = {
					has_realm_law = free_investiture
					highest_held_title_tier >= tier_duchy
					has_faith = faith:catholic
					faith.religious_head = PREV

					NOR = {
						has_character_flag = pope_wants_our_law_changed
						has_character_flag = pope_respects_our_law	
					}
				}
			}
			scope:popewantsit = {
				add_gold = 10
				add_character_flag = pope_wants_our_law_changed

				trigger_event = {
					id = KoH_religiousflavour.25
					days = 14
				}
			}
		}
		#custom_tooltip = KoH_religiousflavour.24 #EVTTOOLTIP67001

		ai_chance = {	
			base = 100
		
		}
	}
	
	option = { 
		name = KoH_religiousflavour.24.b
		

		ai_chance = { 
			base = 0 
		}
	}
}

# King/Emperor gets the papal emissary asking them to change laws!
#Event 2

KoH_religiousflavour.25 = { 
	title = KoH_religiousflavour.25.t
	desc = KoH_religiousflavour.25.desc
	theme = learning_scholarship_focus
	left_portrait = {
		character = scope:popewantsit
	}
	right_portrait = {
		character = faith.religious_head
	}
	
	trigger = {		
		has_realm_law = free_investiture
		highest_held_title_tier >= tier_duchy
		has_faith = faith:catholic
	}

	immediate = {
		save_scope_as = popewantsit
	}

	option = { 
		name = KoH_religiousflavour.25.a # Fold to demand
		
		trigger = {
			OR = {
				AND = {
					is_ai = no
				}
				AND = {
					NOT = {
						has_trait = cynical
						is_ai = yes
					}
				}
			}
		}
		
		remove_realm_law = free_investiture
		add_realm_law_skip_effects = papal_investiture

		
		
		add_piety = 25
		faith = {
			change_fervor = 2
		}

		faith.religious_head = {
			add_opinion = {
				target = PREV
				opinion = 10
				modifier = changed_investiture_law
			}
			
			trigger_event = {
				id = KoH_religiousflavour.26
				days = 1
			}
		}

		hidden_effect = {
			remove_character_flag = pope_wants_our_law_changed

			faith.religious_head = {
				remove_character_flag = pope_currently_demanding
			}
		}

		ai_chance = {
			base = 1	
			modifier = {
				factor = 8
				has_trait = zealous
			}
		}
	}
	
	option = { 
		name = KoH_religiousflavour.25.b # Refuse
		
		add_piety = -25
		faith = {
			change_fervor = -4
		}

		add_character_flag = pope_we_refuse_law_changed

		faith.religious_head = {
			add_opinion = {
				target = PREV
				opinion = 10
				modifier = refused_changed_investiture_law
			}
			trigger_event = {
				id = KoH_religiousflavour.27
				days = 1
			}
		}
		ai_chance = { 
			base = 1 
		
			modifier = {
				factor = 1.5
				has_trait = arbitrary
			}

			modifier = {
				factor = 1.5
				has_trait = cynical
			}

			modifier = {
				factor = 1.5
				has_trait = lifestyle_reveler
			}
		}

	}

	option = { 
		name = KoH_religiousflavour.25.c ## Give gold to Pope / Bribe Pope
		trigger = { 
			gold >= 200

			OR = {
				AND = {
					is_ai = no
				}
				AND = {
					is_ai = yes
					NOT = {
						has_trait = zealous
					}
				}
			}
		}

		pay_short_term_gold = {
			gold = 200	# Todo: Adjust this?
			target = faith.religious_head
		}

		add_character_flag = pope_respects_our_law
		remove_character_flag = pope_wants_our_law_changed
		hidden_effect = {
			faith.religious_head = {
				remove_character_flag = pope_currently_demanding
				trigger_event = {
					id = KoH_religiousflavour.28
					days = 1
				}
			}
		}

		ai_chance = { 
			base = 1 
		
			modifier = {
				factor = 4
				has_trait = cynical
			}

			modifier = {
				factor = -3
				has_trait = greedy
			}
		}
	}

	option = { 
		name = KoH_religiousflavour.25.d ## Impress with Learning
		trigger = { 
			learning >= 16
		}
		add_piety = 1

		add_character_flag = pope_respects_our_law
		remove_character_flag = pope_wants_our_law_changed
		hidden_effect = {
			faith.religious_head = {
				remove_character_flag = pope_currently_demanding
				trigger_event = {
					id = KoH_religiousflavour.29
					days = 1
				}
			}
		}

		ai_chance = { 
			base = 100
		}
	}
}

## King accepts
#Event 3
KoH_religiousflavour.26 = { 
	title = KoH_religiousflavour.26.t
	desc = KoH_religiousflavour.26.desc
	theme = learning_scholarship_focus
	left_portrait = {
		character = scope:popewantsit
	}

	right_portrait = {
		character = faith.religious_head
	}

	option = { 
		name = KoH_religiousflavour.26.a
		
		add_prestige = 100

		ai_chance = {	
			base = 100
		
		}
	}
}

## King refuses us
#Event 4
KoH_religiousflavour.27 = { 
	title = KoH_religiousflavour.27.t
	desc = KoH_religiousflavour.27.desc
	theme = learning_scholarship_focus
	left_portrait = {
		character = scope:popewantsit
	}

	right_portrait = {
		character = faith.religious_head
	}

	option = { 
		name = KoH_religiousflavour.26.a
		
		add_prestige = 100

		ai_chance = {	
			base = 100
		
		}
	}
}



## King bribes us
#Event 5

# King outwits us
#Event 6

## The Pope sends a delegate to a Bishop whose top liege has refused to change investiture Law
#Event 7

## The Bishop receives the Papal emissary
#Event 8

## King knows of bishop getting bribed
#Event 9

## The Pope contacts a powerful (preferably rebellious) vassal of a liege who has refused to change investiture Law
#Event 10

## The vassal receives the claim
#Event 11

####
## Check for Cadaver Synod
#Event 1

#The Cadaver Synod

## Pope learns that a catholic ruler has a heretic advisor

## Vassal disappointed in liege having heretic advisor

# # The Pope gives money to someone fighting the Infidel

# The Pope appoints a new holy roman emperor / gives a claim
