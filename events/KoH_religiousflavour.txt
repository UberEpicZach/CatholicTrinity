namespace = KoH_religiousflavour


KoH_religiousflavour.1 = { #A Pope and His Estates
	title = KoH_religiousflavour.1.t
	desc = KoH_religiousflavour.1.desc
	theme = unfriendly
	left_portrait = {
		character = this
	}

	trigger = {		
		root.faith = faith:catholic
		exists = faith:catholic.religious_head
		faith:catholic.religious_head = {
			has_title = title:k_papal_state
			dynasty = root.dynasty 
		}
		title:k_papal_state.holder = { 
			NOT = { 
				OR = { 
					has_trait = greedy 
					has_trait = zealous 
				} 
			} 
		}

		OR = {
			any_sibling = {
				is_male = yes
				is_ruler = no
				root.primary_title = {
					place_in_line_of_succession = {
					  target = PREV
					  value > 2
					}
				}
			}
			any_child = {
				is_male = yes
				is_ruler = no
				root.primary_title = {
					place_in_line_of_succession = {
					  target = PREV
					  value > 2
					}
				}
			}
		}
	}

	immediate = {
		scripted_effect_popethingevent = {}
	}

	option = { 
		name = KoH_religiousflavour.1.a
			scope:player_one = {
				add_opinion = {
					target = title:k_papal_state.holder 
					opinion = 100
					modifier = grateful_opinion
				} 
				add_opinion = {
					target = ROOT
					opinion = 100
					modifier = grateful_opinion
				} 

				set_employer = title:k_papal_state.holder 
				add_character_modifier = {
					modifier = koh_governs_vast_estates
					years = 5
				}
			}

			scope:player_two = { 
				add_opinion = {
					target = title:k_papal_state.holder 
					opinion = 100
					modifier = grateful_opinion
				} 

				reverse_add_opinion = {
					target = ROOT
					opinion = 100
					modifier = grateful_opinion
				} 
				set_employer = title:k_papal_state.holder 
				add_character_modifier = {
					modifier = koh_governs_vast_estates
					years = 5
				}
			}
			
			title:k_papal_state.holder = {
				add_opinion = {
					target = scope:player_one
					opinion = 20
					modifier = grateful_opinion
				} 

				add_opinion = {
					target = scope:player_two
					opinion = 20
					modifier = grateful_opinion
				} 

				add_opinion = {
					target = ROOT
					opinion = 15
					modifier = grateful_opinion
				}
			}
		
		ai_chance = {
			base = 100
		}
	}

	# option = {
	# 	name = KoH_religiousflavour.1.b

	# 	add_piety = 50

	# 	title:k_papal_state.holder = {
	# 		add_opinion = {
	# 			target = ROOT
	# 			opinion = -15
	# 			modifier = disappointed_opinion
	# 		}
	# 	}
	# }

	# option = {
	# 	name = KoH_religiousflavour.1.c
	# 	trigger = {
	# 		OR = {
	# 			has_trait = zealous
	# 			learning <= 10
	# 		}
	# 	add_piety = 50

	# 	title:k_papal_state.holder = {
	# 		add_opinion = {
	# 			target = ROOT
	# 			opinion = -15
	# 			modifier = disappointed_opinion
	# 		}
	# 		add_piety = -100
	# 	}
	# 	add_piety = 200
	# 	add_learning_skill = 1
	# 	}
	# }
}

KoH_religiousflavour.2 = { #Monks Make Good Beer
	title = KoH_religiousflavour.2.t
	desc = KoH_religiousflavour.2.desc
	theme = learning_scholarship_focus
	left_portrait = {
		character = this
	}
	right_portrait = {
		character = scope:monk
	}

	trigger = {		
		is_commanding_army = no
		is_adult = yes
		is_imprisoned = no
		has_religion = religion:christianity_religion
		# OR = {
		# 	location = {
		# 		region = world_europe_west
		# 	}
		# 	location = {
		# 		region = world_europe_south
		# 	}
		# }
	}

	immediate = {
		create_character = {
			location = root.capital_province
			age = { 25 35 }
			gender = male
			trait = education_learning_3
			trait = devoted
			faith = root.faith
			culture = root.culture
			learning = { 10 12 }
			save_scope_as = monk
		}
	}

	option = { 
		name = KoH_religiousflavour.2.a

		if = {
			limit = { NOT = { has_trait = drunkard } }
			random = {
				chance = 20
				add_trait = drunkard
				send_interface_toast = {
					type = event_toast_effect_bad
					title =  KoH_religiousflavour.2.a.drunkard # KoH_religiousflavour.2.a.drunkard
					left_icon = root
				}
			}
		}

		ai_chance = {
			base = 50
		}
	}

	option = { 
		name = KoH_religiousflavour.2.b

		if = {
			limit = { NOT = { has_trait = temperate } }
			random = {
				chance = 20
				add_trait = temperate
				send_interface_toast = {
					type = event_toast_effect_good
					title =  KoH_religiousflavour.2.b.temperate
					left_icon = root
				}
			}
		}

		ai_chance = {
			base = 50
		}
	}
	after = {
		hidden_effect = {
			scope:monk = {
				death = {
					death_reason = death_vanished
				}
			}
		}
	}
}

KoH_religiousflavour.3 = { #Monks Make Good Wine
	title = KoH_religiousflavour.3.t
	desc = KoH_religiousflavour.3.desc
	theme = learning_scholarship_focus
	left_portrait = {
		character = this
	}

	right_portrait = {
		character = scope:monk
	}

	trigger = {		
		is_commanding_army = no
		is_adult = yes
		is_imprisoned = no
		has_religion = religion:christianity_religion
		# OR = {
		# 	location = {
		# 		region = world_europe_west
		# 	}
		# 	location = {
		# 		region = world_europe_south
		# 	}
		# }
	}

	immediate = {
		create_character = {
			location = root.capital_province
			age = { 25 35 }
			gender = male
			trait = education_learning_3
			trait = devoted
			faith = root.faith
			culture = root.culture
			learning = { 10 12 }
			save_scope_as = monk
		}
	}

	option = { 
		name = KoH_religiousflavour.3.a

		random = {
			chance = 50
			add_learning_skill = 1
		}
		if = {
			limit = { NOT = { has_trait = drunkard } }
			random = {
				chance = 20
				add_trait = drunkard
				send_interface_toast = {
					type = event_toast_effect_bad
					title = KoH_religiousflavour.2.a.drunkard
					left_icon = root
				}
			}
		}

		ai_chance = {
			base = 50
		}
	}

	option = { 
		name = KoH_religiousflavour.3.b

		if = {
			limit = { NOT = { has_trait = temperate } }
			random = {
				chance = 20
				add_trait = temperate
				send_interface_toast = {
					type = event_toast_effect_good
					title = KoH_religiousflavour.2.b.temperate
					left_icon = root
				}
			}
		}

		ai_chance = {
			base = 50
		}
	}
	after = {
		hidden_effect = {
			scope:monk = {
				death = {
					death_reason = death_vanished
				}
			}
		}
	}
}

KoH_religiousflavour.4 = { #Monks have healing herbs
	title = KoH_religiousflavour.4.t
	desc = KoH_religiousflavour.4.desc
	theme = learning_scholarship_focus
	left_portrait = {
		character = this
	}
	right_portrait = {
		character = scope:monk
	}
	override_background = { event_background = garden }

	trigger = {		
		is_commanding_army = no
		is_adult = yes
		is_imprisoned = no
		piety_level >= 1
		OR = {
			has_trait = ill
		}
		has_religion = religion:christianity_religion
		# OR = {
		# 	location = {
		# 		region = world_europe_west
		# 	}
		# 	location = {
		# 		region = world_europe_south
		# 	}
		# }
	}

	immediate = {
		create_character = {
			location = root.capital_province
			age = { 25 35 }
			gender = male
			trait = education_learning_3
			trait = devoted
			faith = root.faith
			culture = root.culture
			learning = { 10 12 }
			save_scope_as = monk
		}
	}

	option = { 
		name = KoH_religiousflavour.4.a

		random = {
			chance = 30
			remove_trait = ill
		}

		ai_chance = {
			base = 80
		}
	}

	option = { 
		name = KoH_religiousflavour.4.b

		if = {
			limit = { NOT = { has_trait = paranoid } }
			add_trait = paranoid
		}
	}
	after = {
		hidden_effect = {
			scope:monk = {
				death = {
					death_reason = death_vanished
				}
			}
		}
	}
}

KoH_religiousflavour.5 = { #Monks is fantastic painter
	title = KoH_religiousflavour.5.t
	desc = KoH_religiousflavour.5.desc
	theme = learning_scholarship_focus
	left_portrait = {
		character = this
	}
	right_portrait = {
		character = scope:monk
	}
	override_background = {
		event_background = farmland
	}

	trigger = {		
		is_commanding_army = no
		is_adult = yes
		is_imprisoned = no
		has_religion = religion:christianity_religion
		NOT = { has_trait = blind }
		# OR = {
		# 	location = {
		# 		region = world_europe_west
		# 	}
		# 	location = {
		# 		region = world_europe_south
		# 	}
		# }
	}

	immediate = {
		create_character = {
			location = root.capital_province
			age = { 25 35 }
			gender = male
			trait = education_learning_3
			trait = devoted
			faith = root.faith
			culture = root.culture
			learning = { 10 12 }
			save_scope_as = monk
		}
	}

	option = { 
		name = KoH_religiousflavour.5.a

		remove_short_term_gold = 10
		add_prestige = 30
	}

	option = { 
		name = KoH_religiousflavour.5.b

	}
	after = {
		hidden_effect = {
			scope:monk = {
				death = {
					death_reason = death_vanished
				}
			}
		}
	}
}

KoH_religiousflavour.6 = { #Monks is fantastic painter
	title = KoH_religiousflavour.6.t
	desc = KoH_religiousflavour.6.desc
	theme = learning_scholarship_focus
	left_portrait = {
		character = this
	}
	right_portrait = {
		character = scope:monk
	}

	trigger = {		
		is_commanding_army = no
		is_adult = yes
		is_imprisoned = no
		has_religion = religion:christianity_religion
		NOT = { has_trait = blind }
		# OR = {
		# 	location = {
		# 		region = world_europe_west
		# 	}
		# 	location = {
		# 		region = world_europe_south
		# 	}
		# }
	}

	immediate = {
		create_character = {
			location = root.capital_province
			age = { 25 35 }
			gender = male
			trait = education_learning_3
			trait = devoted
			faith = root.faith
			culture = root.culture
			learning = { 10 12 }
			save_scope_as = monk
		}
	}

	option = { 
		name = KoH_religiousflavour.6.a

		remove_short_term_gold = 10
		add_prestige = 30
	}

	option = { 
		name = KoH_religiousflavour.6.b

	}
	after = {
		hidden_effect = {
			scope:monk = {
				death = {
					death_reason = death_vanished
				}
			}
		}
	}
}

KoH_religiousflavour.7 = { #Monks is fantastic painter
	title = KoH_religiousflavour.7.t
	desc = KoH_religiousflavour.7.desc
	theme = learning_scholarship_focus
	left_portrait = {
		character = this
	}
	right_portrait = {
		character = scope:monk
	}

	trigger = {		
		is_commanding_army = no
		is_adult = yes
		is_imprisoned = no
		has_religion = religion:christianity_religion
		# OR = {
		# 	location = {
		# 		region = world_europe_west
		# 	}
		# 	location = {
		# 		region = world_europe_south
		# 	}
		# }
	}

	immediate = {
		create_character = {
			location = root.capital_province
			age = { 25 35 }
			gender = male
			trait = education_learning_3
			trait = devoted
			faith = root.faith
			culture = root.culture
			learning = { 10 12 }
			save_scope_as = monk
		}
	}

	option = { 
		name = KoH_religiousflavour.7.a

		remove_short_term_gold = 30
		add_prestige = 30
		random = {
			chance = 20
			add_learning_skill = 1
		}
	}
	option = { 
		name = KoH_religiousflavour.7.b

	}
	after = {
		hidden_effect = {
			scope:monk = {
				death = {
					death_reason = death_vanished
				}
			}
		}
	}
}

KoH_religiousflavour.8 = { #Monastery Monks"
	title = KoH_religiousflavour.8.t
	desc = KoH_religiousflavour.8.desc
	theme = learning_scholarship_focus
	left_portrait = {
		character = this
	}
	right_portrait = {
		character = scope:monk
	}

	trigger = {		
		is_commanding_army = no
		is_adult = yes
		is_imprisoned = no
		has_religion = religion:christianity_religion
		# OR = {
		# 	location = {
		# 		region = world_europe_west
		# 	}
		# 	location = {
		# 		region = world_europe_south
		# 	}
		# }
	}

	immediate = {
		create_character = {
			location = root.capital_province
			age = { 25 35 }
			gender = male
			trait = education_learning_3
			trait = devoted
			faith = root.faith
			culture = root.culture
			learning = { 10 12 }
			save_scope_as = monk
		}
	}

	option = { 
		name = KoH_religiousflavour.8.a

		add_piety = 20

		random = {
			chance = 30
			add_learning_skill = 1
		}
	}
	option = { 
		name = KoH_religiousflavour.8.b
		random_list = {
			30 = {
				if = {
					limit = { NOT = { has_trait = cynical } }
					add_trait = cynical
				}
			}
			60 = {

			}
		}
	}

	after = {
		hidden_effect = {
			scope:monk = {
				death = {
					death_reason = death_vanished
				}
			}
		}
	}
}

KoH_religiousflavour.9 = { #Child wants to be monk/nun - select child
	title = KoH_religiousflavour.9.t
	desc = KoH_religiousflavour.9.desc
	theme = learning_scholarship_focus
	left_portrait = {
		character = this
	}
	right_portrait = {
		character = scope:childforthechurch
	}

	trigger = {		
		triggerforKoH_religiousflavour9 = yes
	}

	immediate = {
		save_scope_as = parentofchild
		random_child = {
			limit = {
				is_ruler = no
				age >= 13
				NOT = { age >= 16 }
				NOT = { has_trait = cynical }
				NOT = { is_clergy = yes }
			}
			save_scope_as = childforthechurch
		}
	}

	option = { 
		name = KoH_religiousflavour.9.a
		#custom_tooltip = KoH_religiousflavour.9.a.tt 
	
		scope:childforthechurch = {
			send_child_to_clergy_effect_for_events = yes

			if = {
				limit = {
					scope:parentofchild.top_liege = {
						any_vassal_or_below = {
							has_government = theocracy_government
							primary_title.tier > tier_barony
							faith = scope:parentofchild.faith
						}
					}
				}
				scope:parentofchild.top_liege = {
					random_vassal_or_below = {
						limit = {
							has_government = theocracy_government
							primary_title.tier > tier_barony
							faith = scope:parentofchild.faith
						}
						save_scope_as = theocratic_travel_target
					}
				}
				visit_court_of = scope:theocratic_travel_target
				set_relation_guardian = scope:theocratic_travel_target 
			}
			else_if = {
				limit = {
					exists = scope:parentofchild.capital_province
				}
				move_to_pool_at = scope:parentofchild.capital_province
			}

			add_opinion = {
				target = ROOT
				opinion = 50
				modifier = grateful_opinion
			}
		}
	}

	option = { 
		name = KoH_religiousflavour.9.b
		scope:childforthechurch = {
			add_stress = major_stress_loss
			add_opinion = {
				target = ROOT
				opinion = -150
				modifier = angry_opinion
			}
		}
	}

}

KoH_religiousflavour.12 = { #Donate to local monastery
	title = KoH_religiousflavour.12.t
	desc = KoH_religiousflavour.12.desc
	theme = learning_scholarship_focus
	left_portrait = {
		character = this
	}
	right_portrait = {
		character = scope:monk
	}
	trigger = {		
		is_commanding_army = no
		is_adult = yes
		is_imprisoned = no
		has_religion = religion:christianity_religion
	}

	immediate = {
		create_character = {
			location = root.capital_province
			age = { 25 35 }
			gender = male
			trait = education_learning_3
			trait = devoted
			faith = root.faith
			culture = root.culture
			learning = { 10 12 }
			save_scope_as = monk
		}
	}

	option = { 
		name = KoH_religiousflavour.12.a
		remove_short_term_gold = 30
		add_piety = 30
	}
	
	option = { 
		name = KoH_religiousflavour.12.b
		add_piety = -30
	}
	after = {
		hidden_effect = {
			scope:monk = {
				death = {
					death_reason = death_vanished
				}
			}
		}
	}
}

KoH_religiousflavour.13 = { #Duty-Bound
	title = KoH_religiousflavour.13.t
	desc = KoH_religiousflavour.13.desc
	theme = learning_scholarship_focus
	right_portrait = {
		character = scope:Priest
	}
	lower_right_portrait = {
		character = scope:lover
	}

	trigger = {		
		has_religion = religion:christianity_religion
		any_vassal_or_below = {
			AND = {
				age >= 19
				has_government = theocracy_government
				OR = {
					has_trait = reveler_1
					has_trait = reveler_2
					has_trait = reveler_3
					has_trait = drunkard
					has_trait = lustful 
				}
			} 
		}
	}

	immediate = {
		random_vassal_or_below = {
			limit = {
				AND = {
					age >= 19
					has_government = theocracy_government
					OR = {
						has_trait = reveler_1
						has_trait = reveler_2
						has_trait = reveler_3
						has_trait = drunkard
						has_trait = lustful 
					}
				}
			}
			save_scope_as = Priest 
		}

		create_character = {
			template = beautiful_peasant_character
			age = { 17 22 }
			gender_female_chance = root_attraction_based_female_chance
			employer = scope:Priest.host
			faith = scope:Priest.host.faith
			culture = scope:Priest.host.culture
			save_scope_as = lover
		}

		scope:Priest = {
			set_relation_lover = scope:lover
		}
	}

	option = { 
		name = KoH_religiousflavour.13.a
		
		scope:Priest = {
			give_deviant_secret_or_trait_effect = yes

			if = {
				limit = { exists = dynasty }
				dynasty = {
					add_dynasty_prestige = medium_dynasty_prestige_loss
				}
			}
			add_piety = -1
			add_piety_level = -1
		}
	}
}

KoH_religiousflavour.14 = { #Duty-Bound - Varaint
	title = KoH_religiousflavour.14.t
	desc = KoH_religiousflavour.14.desc
	theme = learning_scholarship_focus
	right_portrait = {
		character = scope:Priest
	}
	lower_right_portrait = {
		character = scope:lover
	}

	trigger = {		
		has_religion = religion:christianity_religion

		exists = dynasty
		dynasty = { 
			any_dynasty_member = { 
				is_alive = yes
				age >= 18
				dynasty = root.dynasty
				has_government = theocracy_government
				OR = {
					has_trait = reveler_1
					has_trait = reveler_2
					has_trait = reveler_3
					has_trait = drunkard
					has_trait = lustful 
				}
			}
		}
	}

	immediate = {
		dynasty = { 
			every_dynasty_member = { 
				if = {
					limit = {
						is_alive = yes
						age >= 18
						AND = {
							dynasty = root.dynasty
							has_government = theocracy_government
							OR = {
								has_trait = reveler_1
								has_trait = reveler_2
								has_trait = reveler_3
								has_trait = drunkard
								has_trait = lustful 
							}
						}
					}
					save_scope_as = Priest
				} 
			}
		}

		create_character = {
			template = beautiful_peasant_character
			age = { 17 22 }
			gender_female_chance = root_attraction_based_female_chance
			employer = scope:Priest.host
			faith = scope:Priest.host.faith
			culture = scope:Priest.host.culture
			save_scope_as = lover
		}

		scope:lover = {
			set_relation_lover = scope:Priest
		}
	}

	option = { 
		name = KoH_religiousflavour.14.a
		
		scope:Priest = {
			give_deviant_secret_or_trait_effect = yes

			if = {
				limit = { exists = dynasty }
				dynasty = {
					add_dynasty_prestige = medium_dynasty_prestige_loss
				}
			}
			add_piety = -1
			add_piety_level = -1
		}
	}
}
#Waldensians in Lyon
KoH_religiousflavour.15 = {
	title = KoH_religiousflavour.15.t
	desc = KoH_religiousflavour.15.desc
	orphan = yes
	theme = faith 
	override_background = {
		event_background = market
	}
	left_portrait = {
		character = title:c_lyon.holder
	}
	right_portrait = {
		character = scope:peter
	}

	trigger = {
		this = title:c_forez.holder
	}

	immediate = {
		create_character = {
			name = "Pèire de Vaudès"
			gender_female_chance = 0
			dynasty = no
			trait = heresiarch
			location = root
			age = { 40 50 }
			learning = 18
			faith = faith:waldensian
			culture = culture:french
			save_scope_as = peter
		}

		title:c_lyon.holder = {
			save_scope_as = archbishop
		}
	}

	option = { 
		name = KoH_religiousflavour.15.a
		title:c_provence.holder = {
			trigger_event = {
				id = KoH_religiousflavour.16
				days = { 5 10 }
			}
		}

		title:c_savoie.holder = {
			trigger_event = {
				id = KoH_religiousflavour.16
				days = { 5 10 }
			}
		}
	}
	option = { 
		name = KoH_religiousflavour.15.b
		trigger_event = {
			id = KoH_religiousflavour.17
			days = { 5 10 }
		}
	}
}

KoH_religiousflavour.16 = {
	title = KoH_religiousflavour.16.t
	desc = KoH_religiousflavour.16.desc
	theme = faith 
	override_background = {
		event_background = market
	}

	immediate = {
		random_held_title = {
			limit = { tier = tier_county }
			save_scope_as = Waldensians_county
		}

		scope:Waldensians_county = {
			set_county_faith = faith:waldensian

			add_county_modifier = {
				modifier = bastion_of_waldensianism_revolt_risk_modifier
				years = 20
			}
		}
	}

	option = { 
		name = KoH_religiousflavour.16.a


	}
}

KoH_religiousflavour.17 = {
	title = KoH_religiousflavour.17.t
	desc = KoH_religiousflavour.17.desc
	theme = faith 
	override_background = {
		event_background = market
	}
	left_portrait = {
		character = scope:archbishop
	}
	right_portrait = {
		character = root
	}

	immediate = {
		title:c_lyon.holder = {
			save_scope_as = archbishop
		}

	}

	option = { 
		name = KoH_religiousflavour.17.a

		scope:archbishop = {
			add_opinion = {
			target = root
			modifier = pious_opinion
			opinion = 10
			}
		}

		add_piety = 50 

		trigger_event = {
			id = KoH_religiousflavour.18
			days = 3 
		}
	}

	option = { 
		name = KoH_religiousflavour.17.b
		custom_tooltip = KoH_religiousflavour.17.b.tt

		scope:archbishop = {
			add_opinion = {
			target = root
			modifier = temporal_condemnation_opinion
			opinion = -30
			}
		}

		trigger_event = {
			id = KoH_religiousflavour.19
			days = {10 20}
		}
	}

	option = { 
		name = KoH_religiousflavour.17.c
		custom_tooltip = KoH_religiousflavour.17.c.tt

		scope:archbishop = {
			set_relation_rival = root
		}

		set_relation_rival = scope:archbishop

		set_character_faith_with_conversion = faith:waldensian
		add_piety = major_piety_loss

		add_internal_flag = dangerous


		trigger_event = {
			id = KoH_religiousflavour.20
			days = 3 
		}

		ai_chance = {
			base = 80
		}
	}
}

KoH_religiousflavour.18 = {
	title = KoH_religiousflavour.18.t
	desc = KoH_religiousflavour.18.desc
	theme = faith 
	override_background = {
		event_background = market
	}

	immediate = {
		title:c_forez = {
			change_development_level = -2

			add_county_modifier = {
				modifier = Massacre_of_Feurs
				years = 10
			}
		}
	}

	option = { 
		name = KoH_religiousflavour.18.a	
	}
}

KoH_religiousflavour.19 = {
	title = KoH_religiousflavour.19.t
	desc = KoH_religiousflavour.19.desc
	theme = faith 
	override_background = {
		event_background = market
	}

	immediate = {
		add_excommunication_actual_effect = yes
	}

	option = { 
		name = KoH_religiousflavour.19.a	

		title:c_forez = {
			set_county_faith = faith:waldensian

			add_county_modifier = {
				modifier = KOH_Religious_Tolerance
				years = 20
			}
		}
		set_nickname_effect = { NICKNAME = nick_the_tolerant }
	}
}

KoH_religiousflavour.20 = {
	title = KoH_religiousflavour.20.t
	desc = KoH_religiousflavour.20.desc
	theme = faith 
	override_background = {
		event_background = market
	}

	immediate = {
		add_excommunication_actual_effect = yes
	}

	option = { 
		name = KoH_religiousflavour.20.a	

		add_trait = heresiarch
		add_trait = paragon

		set_nickname_effect = { NICKNAME = nick_the_waldensian }

		add_piety = 1000

		title:c_forez = {
			set_county_faith = faith:waldensian

			add_county_modifier = {
				modifier = Birthplace_of_Waldensianism
				years = 100
			}
		}

		title:c_lyon = {
			set_county_faith = faith:waldensian


			add_county_modifier = {
				modifier = Birthplace_of_Waldensianism
				years = 100
			}
		}

		faith:waldensian = {
			change_fervor = {
				value = 28
				desc = Birthplace_of_Waldensianism
			}
		}

		title:c_roma.holder = {
			add_opinion = {
				target = root
				modifier = temporal_condemnation_opinion
				opinion = -30
			}
		}

		every_ruler = {
			limit = {
				AND = {
					NOT = { this = title:c_forez.holder }
					has_religion = religion:christianity_religion
				}
			}
			trigger_event = {
				id = KoH_religiousflavour.21
				days = 10
			}
		}
	}
}

KoH_religiousflavour.21 = {
	title = KoH_religiousflavour.21.t
	desc = KoH_religiousflavour.21.desc
	theme = faith 
	override_background = {
		event_background = market
	}

	right_portrait = {
		character = title:c_forez.holder
	}

	immediate = {
		title:c_forez.holder = {
			save_scope_as = forez
		}

		title:c_roma.holder = {
			save_scope_as = pope
		}
	}

	option = { 
		name = KoH_religiousflavour.21.a	
	}
}

#cardinal names
KoH_religiousflavour.22 = {
	hidden = yes

	immediate = {
		every_living_cardinal = {
			add_prestige = 1
			if = {
				limit = {
					is_landed = no
				}
				add_trait = cardinal_priest
			}
			if = {
				limit = {
					is_landed = yes
					highest_held_title_tier >= tier_duchy
					NOT = { this = character:7853 }
				}
				add_trait = cardinal_archbishop
			}
			else_if = {
				limit = {
					is_landed = yes
					NOT = { this = character:7853 }
				}
				add_trait = cardinal_bishop
			}
		}
	}
}

#cardinal election won
KoH_religiousflavour.23 = {
	hidden = yes
	orphan = yes
	immediate = {
		send_interface_toast = {
			title = CardinalElectionWon				
			right_icon = prev
			
			custom_tooltip = HookGainedKOH
		}
	}
}

#The Pope and an Investiture Free Realm
# The Pope singles out a Kingdom with Free Investiture (unless he has already targetted one)
#Event 1
KoH_religiousflavour.24 = { 
	title = KoH_religiousflavour.24.t
	desc = KoH_religiousflavour.24.desc
	theme = learning_scholarship_focus
	left_portrait = {
		character = this
	}
	right_portrait = {
		character = scope:popewantsit
	}
	
	trigger = {		
		has_title = title:k_papal_state
		this = faith.religious_head
		is_imprisoned = no
		has_religion = religion:christianity_religion
		has_faith = faith:catholic
		current_year >= 1040
		#change_fervor = -20
		faith = { fervor >= 50 }
		exists = global_var:dictatuspapae

		any_independent_ruler = {
			OR = {
				has_realm_law = free_investiture_early
				has_realm_law = free_investiture_late
			}
			highest_held_title_tier >= tier_duchy
			has_faith = faith:catholic
			title:k_papal_state.holder = faith.religious_head

			NOR = {
				has_character_flag = pope_wants_our_law_changed
				has_character_flag = pope_respects_our_law	
			}
		}
	}

	immediate = {
		random_independent_ruler = {
			limit = {
				OR = {
					has_realm_law = free_investiture_early
					has_realm_law = free_investiture_late
				}
				highest_held_title_tier >= tier_duchy
				has_faith = faith:catholic
				title:k_papal_state.holder = faith.religious_head

				NOR = {
					has_character_flag = pope_wants_our_law_changed
					has_character_flag = pope_respects_our_law	
				}
			}
			save_scope_as = popewantsit
		}
	}

	option = { 
		name = KoH_religiousflavour.24.a
		add_character_flag = pope_currently_demanding

		if = {
			limit = {
				scope:popewantsit = {
					OR = {
						has_realm_law = free_investiture_early
						has_realm_law = free_investiture_late
					}
					highest_held_title_tier >= tier_duchy
					has_faith = faith:catholic
					faith.religious_head = PREV

					NOR = {
						has_character_flag = pope_wants_our_law_changed
						has_character_flag = pope_respects_our_law	
					}
				}
			}
			scope:popewantsit = {
				add_character_flag = pope_wants_our_law_changed

				trigger_event = {
					id = KoH_religiousflavour.25
					days = 14
				}
			}
		}
		#custom_tooltip = KoH_religiousflavour.24 #EVTTOOLTIP67001

		ai_chance = {	
			base = 100
		
		}
	}
	
	option = { 
		name = KoH_religiousflavour.24.b
		

		ai_chance = { 
			base = 0 
		}
	}
}

#King/Emperor gets the papal emissary asking them to change laws!
#Event 2
KoH_religiousflavour.25 = { 
	title = KoH_religiousflavour.25.t
	desc = KoH_religiousflavour.25.desc
	theme = learning_scholarship_focus
	left_portrait = {
		character = scope:popewantsit
	}
	right_portrait = {
		character = faith.religious_head
	}
	
	trigger = {		
		OR = {
			has_realm_law = free_investiture_early
			has_realm_law = free_investiture_late
		}
		highest_held_title_tier >= tier_duchy
		has_faith = faith:catholic
	}

	immediate = {
		save_scope_as = popewantsit

		faith.religious_head = {
			save_scope_as = popeman
		}
	}

	weight_multiplier = {
		base = 1
		modifier = {
			add = { #-1 at 5 learning, 0 at 10 learning, 1 at 15 learning etc.
				value = learning
				subtract = medium_skill_rating
				multiply = 0.2
			}
		}
	}

	option = { 
		name = KoH_religiousflavour.25.a # Fold to demand
		
		trigger = {
			OR = {
				AND = {
					is_ai = no
				}
				AND = {
					NOT = {
						has_trait = cynical
						is_ai = yes
					}
				}
			}
		}
		
		if = {
			limit = {
				has_realm_law = free_investiture_early
			}
			remove_realm_law = free_investiture_early
			add_realm_law_skip_effects = papal_investiture_early
		}
		if = {
			limit = {
				has_realm_law = free_investiture_late
			}
			remove_realm_law = free_investiture_late
			add_realm_law_skip_effects = papal_investiture_late
		}
		
		
		add_piety = 25
		faith = {
			change_fervor = {
				value = 2
				desc = increased_fervor
			}
		}

		faith.religious_head = {
			add_opinion = {
				target = PREV
				opinion = 10
				modifier = changed_investiture_law
			}
			
			trigger_event = {
				id = KoH_religiousflavour.26
				days = 1
			}
		}

		hidden_effect = {
			remove_character_flag = pope_wants_our_law_changed

			faith.religious_head = {
				remove_character_flag = pope_currently_demanding
			}
		}

		ai_chance = {
			base = 1	
			modifier = {
				factor = 8
				has_trait = zealous
			}
		}
	}

	option = { 
		name = KoH_religiousflavour.25.b # Refuse
		
		add_piety = -25
		faith = {
			change_fervor = {
				value = 2
				desc = increased_fervor
			}
		}

		add_character_flag = pope_we_refuse_law_changed

		faith.religious_head = {
			add_opinion = {
				target = PREV
				opinion = -20
				modifier = refused_changed_investiture_law
			}
			trigger_event = {
				id = KoH_religiousflavour.27
				days = 1
			}
		}
		ai_chance = { 
			base = 1 
		
			modifier = {
				factor = 1.5
				has_trait = arbitrary
			}

			modifier = {
				factor = 1.5
				has_trait = cynical
			}

			modifier = {
				factor = 1.5
				has_trait = lifestyle_reveler
			}
		}

	}

	option = { 
		name = KoH_religiousflavour.25.c ## Give gold to Pope / Bribe Pope
		trigger = { 
			gold >= 200

			OR = {
				AND = {
					is_ai = no
				}
				AND = {
					is_ai = yes
					NOT = {
						has_trait = zealous
					}
				}
			}
		}

		hidden_effect = {
			faith.religious_head = {
				remove_character_flag = pope_currently_demanding
				trigger_event = {
					id = KoH_religiousflavour.28
					days = 1
				}
			}
		}

		ai_chance = { 
			base = 1 
		
			modifier = {
				factor = 4
				has_trait = cynical
			}

			modifier = {
				factor = -3
				has_trait = greedy
			}
		}
	}

	option = { 
		name = KoH_religiousflavour.25.d ## Impress with Learning
		
		duel = {
			skill = learning
			target = scope:popeman
			# value = medium_skill_rating
			# desc = outcome_in_a_few_days
			60 = {		
				desc = KoH_religiousflavour.29.d.success
				compare_modifier = {
					value = scope:duel_value
					multiplier = 5
				}
				custom_tooltip = KoH_religiousflavour.29.d.success.tt
				scope:popeman = { trigger_event = { id = KoH_religiousflavour.29 days = 5 } } #You outwit the pope!
				
			}
			40 = {		
				desc = KoH_religiousflavour.29.d.failure
				compare_modifier = {
					value = scope:duel_value
					multiplier = -5
				}
				custom_tooltip = KoH_religiousflavour.29.d.failure.tt
				scope:popeman = { trigger_event = { id = KoH_religiousflavour.30 days = 5 } } #You fail to outwit the pope!
			}
		}

		ai_chance = { 
			base = 3
		}
	}
}

## King accepts
#Event 3
KoH_religiousflavour.26 = { 
	title = KoH_religiousflavour.26.t
	desc = KoH_religiousflavour.26.desc
	theme = learning_scholarship_focus
	left_portrait = {
		character = scope:popewantsit
	}

	right_portrait = {
		character = faith.religious_head
	}

	option = { 
		name = KoH_religiousflavour.26.a
		
		add_prestige = 100

		ai_chance = {	
			base = 100
		
		}
	}
}

## King refuses us
#Event 4
KoH_religiousflavour.27 = { 
	title = KoH_religiousflavour.27.t
	desc = KoH_religiousflavour.27.desc
	theme = learning_scholarship_focus
	left_portrait = {
		character = scope:popewantsit
	}

	right_portrait = {
		character = faith.religious_head
	}

	option = { 
		name = KoH_religiousflavour.27.a
		
		add_prestige = 100

		ai_chance = {	
			base = 100
		
		}
	}
}

## King bribes us
#Event 5
KoH_religiousflavour.28 = { 
	title = KoH_religiousflavour.28.t
	desc = KoH_religiousflavour.28.desc
	theme = learning_scholarship_focus
	left_portrait = {
		character = scope:popewantsit
	}

	right_portrait = {
		character = faith.religious_head
	}

	option = { #accept bribe
		name = KoH_religiousflavour.28.a
		
		custom_tooltip = KoH_religiousflavour.28.a.tt

		scope:popewantsit = {
			pay_short_term_gold = {
				gold = 200	# Todo: Adjust this?
				target = faith.religious_head
			}
	
			add_character_flag = pope_respects_our_law
			remove_character_flag = pope_wants_our_law_changed
		}

		scope:popewantsit = {
			send_interface_toast = {
				type = event_toast_effect_good
				title = KoH_religiousflavour.28.a.toast
				left_icon = faith.religious_head
				
			}
		}

		ai_chance = {	
			base = 1
		
			modifier = {
				add = 25
				has_trait = greedy
			}

			modifier = {
				add = 0.75
				has_trait = cynical
			}
			modifier = {
				add = 2
				has_trait = ambitious
			}
			modifier = {
				add = -1
				has_trait = craven
			}
			modifier = {
				add = -2
				has_trait = content
			}
			modifier = {
				add = -0.75
				has_trait = zealous
			}
			modifier = {
				add = 1
				has_trait = lazy
			}
			modifier = {
				add = 0.5
				has_trait = stubborn
			}
			modifier = {
				add = 0.5
				has_trait = fickle
			}
			modifier = {
				add = 1
				has_trait = greedy
			}
			modifier = {
				add = -2
				has_trait = humble
			}
			modifier = {
				add = 2
				has_trait = arrogant
			}
			modifier = {
				add = -0.5
				has_trait = just
			}
		}
	}

	option = { #decline bribe
		name = KoH_religiousflavour.28.b
		custom_tooltip = KoH_religiousflavour.28.b.tt
		add_opinion = {
			target = scope:popewantsit
			opinion = -20
			modifier = impious_opinion
		}

		scope:popewantsit = {
			send_interface_toast = {
				type = event_toast_effect_bad
				title = KoH_religiousflavour.28.b.toast
				left_icon = faith.religious_head
			}
		}

		ai_chance = {	
			base = 1
	
			modifier = {
				add = -25
				has_trait = greedy
			}
			modifier = {
				add = -0.75
				has_trait = cynical
			}
			modifier = {
				add = -2
				has_trait = ambitious
			}
			modifier = {
				add = 1
				has_trait = craven
			}
			modifier = {
				add = 2
				has_trait = content
			}
			modifier = {
				add = 0.75
				has_trait = zealous
			}
			modifier = {
				add = 1
				has_trait = lazy
			}
			modifier = {
				add = 0.5
				has_trait = stubborn
			}
			modifier = {
				add = -0.5
				has_trait = fickle
			}
			modifier = {
				add = -1
				has_trait = greedy
			}
			modifier = {
				add = 2
				has_trait = humble
			}
			modifier = {
				add = -2
				has_trait = arrogant
			}
			modifier = {
				add = 0.5
				has_trait = just
			}
		}
	}
}

# King outwits us
#Event 6
KoH_religiousflavour.29 = { 
	title = KoH_religiousflavour.29.t
	desc = KoH_religiousflavour.29.desc
	theme = learning_scholarship_focus
	left_portrait = {
		character = scope:popewantsit
	}

	right_portrait = {
		character = faith.religious_head
	}

	option = { 
		name = KoH_religiousflavour.29.a
		
		add_piety = -5

		scope:popewantsit = {
			add_character_flag = pope_respects_our_law
			remove_character_flag = pope_wants_our_law_changed
		}
		hidden_effect = {
			faith.religious_head = {
				remove_character_flag = pope_currently_demanding
				add_character_modifier = {
					modifier = public_opinion_negative
					days = 365
				}
			}
		}

		scope:popewantsit = {
			send_interface_toast = {
				type = event_toast_effect_good
				title = KoH_religiousflavour.29.b.toast
				left_icon = faith.religious_head
			}
		}

		ai_chance = {	
			base = 100
		
		}
	}
}

# King failed to outwit us
#Event 6
KoH_religiousflavour.30 = { 
	title = KoH_religiousflavour.30.t
	desc = KoH_religiousflavour.30.desc
	theme = learning_scholarship_focus
	left_portrait = {
		character = scope:popewantsit
	}

	right_portrait = {
		character = faith.religious_head
	}

	option = { 
		name = KoH_religiousflavour.30.a
		custom_tooltip = KoH_religiousflavour.30.a.tt
		add_piety = 100

		add_opinion = {
			modifier = impious_opinion
			opinion = -15
			target = scope:popewantsit
		}

		add_opinion = {
			target = scope:popewantsit
			opinion = 10
			modifier = refused_changed_investiture_law
		}

		scope:popewantsit = {
			add_character_modifier = {
				modifier = public_opinion_negative
				days = 365
			}
			add_character_flag = pope_we_refuse_law_changed
		}
		
		scope:popewantsit = {
			send_interface_toast = {
				type = event_toast_effect_bad
				title = KoH_religiousflavour.30.a.toast
				left_icon = faith.religious_head
			}
		}

		ai_chance = {	
			base = 100
		}
	}
}

## The Pope sends a delegate to a Bishop whose top liege has refused to change investiture Law
#Event 7
KoH_religiousflavour.31 = { 
	title = KoH_religiousflavour.31.t
	desc = KoH_religiousflavour.31.desc
	theme = learning_scholarship_focus
	right_portrait = {
		character = faith.religious_head
	}
	left_portrait = {
		character = scope:bishop
	}

	trigger = {		
		has_title = title:k_papal_state
		this = faith.religious_head
		is_imprisoned = no
		has_religion = religion:christianity_religion
		has_faith = faith:catholic
		current_year >= 1040
		exists = global_var:dictatuspapae
		#change_fervor = -20
		faith = { fervor >= 50 }

		any_independent_ruler = {
			OR = {
				has_realm_law = free_investiture_early
				has_realm_law = free_investiture_late
			}
			highest_held_title_tier >= tier_duchy
			has_faith = faith:catholic
			title:k_papal_state.holder = faith.religious_head

			has_character_flag = pope_we_refuse_law_changed
			NOR = { has_character_flag = pope_respects_our_law }	
		}
	}

	immediate = {
		random_independent_ruler = {
			limit = {
				OR = {
					has_realm_law = free_investiture_early
					has_realm_law = free_investiture_late
				}
				highest_held_title_tier >= tier_duchy
				has_faith = faith:catholic
				title:k_papal_state.holder = faith.religious_head
				has_character_flag = pope_we_refuse_law_changed
			}
			save_scope_as = popewantsit
		}
		if = {
			limit = {
				scope:popewantsit = {
					any_vassal = {
						NOT = { has_character_flag = pope_bribing }
						has_government = theocracy_government
						opinion_modifier = {
							who = prev
							opinion_target = scope:popewantsit
							multiplier = -1
						}
						opinion_modifier = {
							who = prev
							opinion_target = scope:popewantsit.faith.religious_head #Excommunication target
							multiplier = 1
						}
					}
				}
			}
			scope:popewantsit = {
				random_vassal = {
					limit = {
						has_government = theocracy_government
						opinion_modifier = {
							who = prev
							opinion_target = scope:popewantsit
							multiplier = 1
							min = 0
						}
						opinion_modifier = {
							who = prev
							opinion_target = scope:popewantsit.faith.religious_head #Excommunication target
							multiplier = -1
						}
					}
					save_scope_as = bishop
				}
			}
		}
	}
		

	option = { 
		name = KoH_religiousflavour.31.a
		custom_tooltip = KoH_religiousflavour.31a.tta
		custom_tooltip = KoH_religiousflavour.31a.ttb
		show_as_tooltip = {
			pay_short_term_gold = {
				target = scope:bishop
				gold = 120
			}
		}
		scope:bishop = { 
			add_character_flag = pope_bribing

			trigger_event = {
				id = KoH_religiousflavour.32
				days = 15
			}
		}

		ai_chance = {	
			base = 75

			modifier = {
				add = 25
				has_trait = zealous
			}
		}
	}
	option = { 
		name = KoH_religiousflavour.31.b
	
		remove_character_flag = pope_currently_demanding

		scope:popewantsit = {
			remove_character_flag = pope_we_refuse_law_changed
		}

		ai_chance = {	
			base = 10

			modifier = {
				add = -75
				has_trait = zealous
			}
		}
	}
}

## The Bishop receives the Papal emissary
#Event 8
KoH_religiousflavour.32 = { 
	title = KoH_religiousflavour.32.t
	desc = KoH_religiousflavour.32.desc
	theme = learning_scholarship_focus
	left_portrait = {
		character = scope:bishop
	}

	right_portrait = {
		character = faith.religious_head
	}

	option = { 
		name = KoH_religiousflavour.32.a
		
		faith.religious_head = {
			pay_short_term_gold = {
				target = scope:bishop
				gold = 120
			}
		}
		scope:bishop = {
			add_opinion = {
				target = faith.religious_head
				opinion = 20
				modifier = bishop_bribed_by_pope
			}
		}

		random_list = {
			66 = { # Suceed
				send_interface_toast = {
					type = event_toast_effect_good
					title = KoH_religiousflavour.32.a.toast # KoH_religiousflavour.2.a.drunkard
					left_icon = root
				}
			}
		
		
			33 = { # Emperror finds out
				custom_tooltip = KoH_religiousflavour.32.a.tt

				scope:popewantsit = {
					trigger_event = {
						id = KoH_religiousflavour.33
						days = { 14 16 }
					}
				}
				send_interface_toast = {
					type = event_toast_effect_bad
					title = KoH_religiousflavour.32.b.toast # KoH_religiousflavour.2.a.drunkard
					left_icon = root
				}
			}
		}

		ai_chance = {	
			base = 100
		
		}
	}
	option = { 
		name = KoH_religiousflavour.32.b

		add_prestige = 10
	}
}

## King knows of bishop getting bribed
#Event 9
KoH_religiousflavour.33 = { 
	title = KoH_religiousflavour.33.t
	desc = KoH_religiousflavour.33.desc
	theme = learning_scholarship_focus
	left_portrait = {
		character = scope:bishop
	}

	right_portrait = {
		character = faith.religious_head
	}

	option = { 
		name = KoH_religiousflavour.33.a
		
		random_list = {
			30 = {
				add_trait = cynical
			}
			1 = {
				add_trait = paranoid
			}
			60 = {

			}
		}

		add_opinion = {
			target = scope:bishop
			modifier = suspicion_opinion
			opinion = -15
		}

		add_opinion = {
			target = faith.religious_head
			modifier = suspicion_opinion
			opinion = -15
		}

		ai_chance = {	
			base = 100
		
		}
	}
	option = { 
		name = KoH_religiousflavour.33.b

		trigger = {
			has_trait = paranoid
		}

		random_list = {
			30 = { 
				imprison = {
					target = scope:bishop
					type = dungeon
				}
				add_excommunication_actual_effect = yes
				add_tyranny = 40
			}
			60 = {
				add_stress = medium_stress_loss
				add_tyranny = 40
				add_excommunication_actual_effect = yes
			}
		}
	}
}

## The Pope contacts a powerful (preferably rebellious) vassal of a liege who has refused to change investiture Law
#Event 10
KoH_religiousflavour.34 = { 
	title = KoH_religiousflavour.34.t
	desc = KoH_religiousflavour.34.desc
	theme = learning_scholarship_focus
	right_portrait = {
		character = faith.religious_head
	}
	left_portrait = {
		character = scope:powerful_vassal
	}

	trigger = {		
		has_title = title:k_papal_state
		this = faith.religious_head
		is_imprisoned = no
		has_religion = religion:christianity_religion
		has_faith = faith:catholic
		current_year >= 1040
		exists = global_var:dictatuspapae
		#change_fervor = -20
		faith = { fervor >= 50 }

		any_independent_ruler = {
			OR = {
				has_realm_law = free_investiture_early
				has_realm_law = free_investiture_late
			}
			highest_held_title_tier >= tier_duchy
			has_faith = faith:catholic
			title:k_papal_state.holder = faith.religious_head

			has_character_flag = pope_we_refuse_law_changed
			NOR = { has_character_flag = pope_respects_our_law }	
		}
	}

	immediate = {
		random_independent_ruler = {
			limit = {
				OR = {
					has_realm_law = free_investiture_early
					has_realm_law = free_investiture_late
				}
				highest_held_title_tier >= tier_county
				has_faith = faith:catholic
				title:k_papal_state.holder = faith.religious_head
				has_character_flag = pope_we_refuse_law_changed
			}
			save_scope_as = popewantsit
			primary_title = {
				save_scope_as = primarytitle
			}
		}
		if = {
			limit = {
				scope:popewantsit = {
					any_vassal = { 
						max_military_strength >= liege.max_military_strength.div2
					}
					NOT = { has_character_flag = pope_bribing }
					has_faith = scope:popewantsit.faith
					opinion_modifier = {
						who = prev
						opinion_target = scope:popewantsit
						multiplier = -1
					}
					opinion_modifier = {
						who = prev
						opinion_target = scope:popewantsit.faith.religious_head #Excommunication target
						multiplier = 1
					}
				}
			}
			scope:popewantsit = {
				random_vassal = {
					limit = {
						max_military_strength >= liege.max_military_strength.div2
						opinion_modifier = {
							who = prev
							opinion_target = scope:popewantsit
							multiplier = 1
							min = 0
						}
						opinion_modifier = {
							who = prev
							opinion_target = scope:popewantsit.faith.religious_head #Excommunication target
							multiplier = -1
						}
					}
					save_scope_as = powerful_vassal
				}
			}
		}
	}
		

	option = { 
		name = KoH_religiousflavour.34.a
		custom_tooltip = KoH_religiousflavour.34.a.tt
		custom_tooltip = KoH_religiousflavour.34a.ttb
		show_as_tooltip = {
			pay_short_term_gold = {
				target = scope:powerful_vassal
				gold = 120
			}
		}
		scope:powerful_vassal = { 
			add_character_flag = pope_bribing

			trigger_event = {
				id = KoH_religiousflavour.35
				days = 15
			}
		}

		ai_chance = {	
			base = 75

			modifier = {
				add = 25
				has_trait = zealous
			}
		}
	}
	option = { 
		name = KoH_religiousflavour.34.b
	
		remove_character_flag = pope_currently_demanding

		scope:popewantsit = {
			remove_character_flag = pope_we_refuse_law_changed
		}

		ai_chance = {	
			base = 10

			modifier = {
				add = -75
				has_trait = zealous
			}
		}
	}
}

## The vassal receives the claim
#Event 11
KoH_religiousflavour.35 = { 
	title = KoH_religiousflavour.35.t
	desc = KoH_religiousflavour.35.desc
	theme = learning_scholarship_focus
	left_portrait = {
		character = scope:powerful_vassal
	}

	right_portrait = {
		character = scope:pope
	}

	immediate = {
		faith.religious_head = {
			save_scope_as = pope
		}
	}
	
	option = { 
		name = KoH_religiousflavour.35.a
		custom_tooltip = "KoH_religiousflavour.35.a.tt"
		add_pressed_claim = liege.primary_title
		scope:powerful_vassal = {
			add_opinion = {
				target = faith.religious_head
				opinion = 20
				modifier = bishop_bribed_by_pope
			}
		}

		spawn_army = {
			uses_supply = no
			inheritable = yes
			name = event_troop_default_name
			levies = {
				value = 500
			}
			men_at_arms = {
				type = onager
				stacks = 5
			}
			men_at_arms = {
				type = picchieri
				stacks = 28
			}
			location = capital_province
		}

		scope:powerful_vassal = {
			if = {
				limit = {
					is_ai = yes
				}
				trigger_event = {
					id = KoH_religiousflavour.37
					days = { 100 365 }
				}
			}
		}

		every_ruler = {
			trigger_event = {
				id = KoH_religiousflavour.36
				days = 2
			}
		}

		ai_chance = {	
			base = 100
		
		}
	}
	option = { 
		name = KoH_religiousflavour.35.b

		add_prestige = 10
	}
}

#Inform everyone!
KoH_religiousflavour.36 = { 
	title = KoH_religiousflavour.36.t
	desc = KoH_religiousflavour.36.desc
	theme = faith

	right_portrait = {
		character = faith.religious_head
	}

	left_portrait = {
		character = scope:popewantsit
	}

	lower_left_portrait = {
		character = scope:powerful_vassal
	}

	option = { 
		name = KoH_religiousflavour.36.a

		if = {
			limit = {
				this = scope:popewantsit
			}
			scope:popewantsit = {
				add_opinion = {
					target = scope:powerful_vassal
					modifier = angry_opinion
					opinion = -150
				}
		
				add_opinion = {
					target = faith.religious_head
					modifier = angry_opinion
					opinion = -150
				}
			}
			scope:powerful_vassal = {
				add_opinion = {
					target = scope:popewantsit
					modifier = impious_opinion
					opinion = -150
				}
			}
		}

		ai_chance = {	
			base = 100
		}
	}
	after = {
		trigger_event = KoH_religiousflavour.367
	}
}

KoH_religiousflavour.367 = { 
	title = KoH_religiousflavour.367.t
	desc = KoH_religiousflavour.367.desc
	theme = faith

	right_portrait = {
		character = faith.religious_head
	}

	left_portrait = {
		character = scope:powerful_vassal
	}

	option = { 
		name = KoH_religiousflavour.367.a


		ai_chance = {	
			base = 100
		}
	}
}

#Start the war
KoH_religiousflavour.37 = { 
	title = KoH_religiousflavour.37.t
	desc = KoH_religiousflavour.37.desc
	theme = faith
	left_portrait = {
		character = scope:powerful_vassal
	}

	right_portrait = {
		character = faith.religious_head
	}

	lower_center_portrait = {
		character = scope:popewantsit
	}

	option = { 
		name = KoH_religiousflavour.37.a

		start_war = {
			cb = claim_cb
			target = scope:popewantsit
			claimant = scope:powerful_vassal
			target_title = scope:popewantsit.primary_title
		}

		ai_chance = {	
			base = 100
		
		}
	}
}

####
## Check for Cadaver Synod
#Event 1

#The Cadaver Synod



## Pope learns that a catholic ruler has a heretic advisor

scripted_trigger KoH_religiousflavour_41_valid_councillor = {
	is_available_ai_adult = yes
	NOR = {
		has_trait = chaste
		is_spouse_of = root
	}

	#We need to make sure that if we pick this councillor, there is a valid child of ROOT they can have a relationship with.
	save_temporary_scope_as = councillor
}

KoH_religiousflavour.41 = { 
	title = KoH_religiousflavour.41.t
	desc = KoH_religiousflavour.41.desc
	theme = learning_scholarship_focus
	right_portrait = {
		character = faith.religious_head
	}
	left_portrait = {
		character = scope:rulerwithheretic
	}

	trigger = {		
		has_title = title:k_papal_state
		this = faith.religious_head
		is_imprisoned = no
		has_religion = religion:christianity_religion
		has_faith = faith:catholic
		current_year >= 1040
		faith = { fervor >= 40 }

		any_independent_ruler = {
			highest_held_title_tier >= tier_duchy
			has_faith = faith:catholic
			title:k_papal_state.holder = faith.religious_head
			any_councillor = {
				NOT = { has_faith = faith:catholic } KoH_religiousflavour_41_valid_councillor = yes
			}
		}
	}

	immediate = {
		random_independent_ruler = {
			limit = {
				highest_held_title_tier >= tier_duchy
				has_faith = faith:catholic
				title:k_papal_state.holder = faith.religious_head
				any_councillor = {
					NOT = { has_faith = faith:catholic } KoH_religiousflavour_41_valid_councillor = yes
				}
			}
			save_scope_as = rulerwithheretic
		}
		if = {
			limit = {
				scope:rulerwithheretic = {
					any_councillor = {
						NOT = { has_faith = faith:catholic } KoH_religiousflavour_41_valid_councillor = yes
					}
				}
			}
			scope:rulerwithheretic = {
				random_councillor = {
					limit = {
						NOT = { has_faith = faith:catholic } KoH_religiousflavour_41_valid_councillor = yes
					}
					save_scope_as = heretic_councillor
				}
			}
		}
	}
		

	option = { 
		name = KoH_religiousflavour.41.a
		scope:rulerwithheretic = {
			trigger_event = {
				id = KoH_religiousflavour.42
				days = {15 30}
			}
		}

		ai_chance = {	
			base = 75

			modifier = {
				add = 25
				has_trait = zealous
			}
		}
	}
	option = { 
		name = KoH_religiousflavour.41.b

		ai_chance = {	
			base = 75

			modifier = {
				add = 25
				has_trait = zealous
			}
		}
	}
}

KoH_religiousflavour.42 = { 
	type = letter_event
	title = KoH_religiousflavour.42.t
	opening = KoH_religiousflavour.42.opening
	desc = KoH_religiousflavour.42.desc
	sender = {
		character = faith.religious_head
	}
	# left_portrait = {
	# 	character = scope:rulerwithheretic
	# }

	option = { 
		name = KoH_religiousflavour.42.a
		if = { #Can I fire them?
			limit = {
				scope:heretic_councillor = { can_be_fired_from_council_trigger = { COURT_OWNER = scope:rulerwithheretic } }
			}
			scope:rulerwithheretic = { fire_councillor = scope:heretic_councillor }
		}
		faith.religious_head = {
			add_opinion = {
				target = scope:rulerwithheretic
				modifier = respect_opinion
				opinion = 50
			}
		}
	
		ai_chance = {	
			base = 75
	
			modifier = {
				add = 25
				has_trait = zealous
			}
		}
	}
	option = { 
		name = KoH_religiousflavour.42.b
	
		faith.religious_head = {
			add_opinion = {
				target = scope:rulerwithheretic
				modifier = angry_opinion
				opinion = -50
			}
		}
		add_character_modifier = {
			modifier = refusedpope
			years = 3
		}
	
		ai_chance = {	
			base = 10
	
			modifier = {
				add = -75
				has_trait = zealous
			}
		}
	}
} 

## Vassal disappointed in liege having heretic advisor

KoH_religiousflavour.43 = { 
	title = KoH_religiousflavour.43.t
	desc = KoH_religiousflavour.43.desc
	theme = learning_scholarship_focus
	right_portrait = {
		character = scope:vassal
	}
	left_portrait = {
		character = scope:hereticadvisorruler
	}

	trigger = {		
		is_imprisoned = no
		has_religion = religion:christianity_religion
		has_faith = faith:catholic
		current_year >= 1040
		faith = { fervor >= 40 }

		any_independent_ruler = {
			highest_held_title_tier >= tier_duchy
			has_faith = faith:catholic
			title:k_papal_state.holder = faith.religious_head
			any_councillor = {
				NOT = { has_faith = faith:catholic }
			}
			save_temporary_scope_as = hereticadvisorruler
		}
		is_vassal_of = scope:hereticadvisorruler
	}

	immediate = {
		save_scope_as = vassal
		liege = {
			save_scope_as = hereticadvisorruler
		}
		if = {
			limit = {
				scope:hereticadvisorruler = {
					any_councillor = {
						NOT = { has_faith = faith:catholic }
					}
				}
			}
			scope:hereticadvisorruler = {
				random_councillor = {
					limit = {
						NOT = { has_faith = faith:catholic }
					}
					save_scope_as = heretic_councillor
				}
			}
		}
	}
		

	option = { 
		name = KoH_religiousflavour.43.a
		custom_tooltip = KoH_religiousflavour.43a.tta
		scope:hereticadvisorruler = {
			trigger_event = {
				id = KoH_religiousflavour.44
				days = {15 30}
			}
		}

		ai_chance = {	
			base = 75

			modifier = {
				add = 25
				has_trait = zealous
			}
		}
	}
}

KoH_religiousflavour.44 = { 
	type = letter_event
	title = KoH_religiousflavour.42.t
	desc = KoH_religiousflavour.42.desc
	opening = KoH_religiousflavour.42.opening
	sender = {
		character = scope:vassal
	}

	option = { 
		name = KoH_religiousflavour.42.a
		if = { #Can I fire them?
			limit = {
				scope:heretic_councillor = { can_be_fired_from_council_trigger = { COURT_OWNER = scope:rulerwithheretic } }
			}
			scope:hereticadvisorruler = { fire_councillor = scope:heretic_councillor }
		}
		scope:vassal = {
			add_opinion = {
				target = scope:hereticadvisorruler
				modifier = respect_opinion
				opinion = 20
			}
		}
	
		ai_chance = {	
			base = 75
	
			modifier = {
				add = 25
				has_trait = zealous
			}
		}
	}
	option = { 
		name = KoH_religiousflavour.42.b
		scope:vassal = {
			add_opinion = {
				target = scope:hereticadvisorruler
				modifier = angry_opinion
				opinion = -20
			}
		}
		add_character_modifier = {
			modifier = refusedpope
			years = 3
		}
	
		ai_chance = {	
			base = 10
	
			modifier = {
				add = -75
				has_trait = zealous
			}
		}
	}
} 

## Realm Priest disappointed in liege having heretic advisor

KoH_religiousflavour.45 = { 
	type = letter_event
	title = KoH_religiousflavour.42.t
	desc = KoH_religiousflavour.42.desc
	sender = {
		character = scope:vassal
	}
	opening = KoH_religiousflavour.42.opening

	trigger = {		
		is_available_adult = yes
		exists = cp:councillor_court_chaplain
		cp:councillor_court_chaplain = {
			opinion = {
				target = liege
				value <= -10
			}
			faith = root.faith
			is_imprisoned = no
		}
		current_year >= 1040
		faith = { fervor >= 40 }
		highest_held_title_tier >= tier_duchy
		has_faith = faith:catholic
		title:k_papal_state.holder = faith.religious_head
		any_councillor = {
			NOT = { has_faith = faith:catholic }
		}
		save_temporary_scope_as = hereticadvisorruler
	}

	immediate = {
		cp:councillor_court_chaplain = {
			save_scope_as = vassal
		}
		save_scope_as = hereticadvisorruler
		if = {
			limit = {
				scope:hereticadvisorruler = {
					any_councillor = {
						NOT = { has_faith = faith:catholic }
					}
				}
			}
			scope:hereticadvisorruler = {
				random_councillor = {
					limit = {
						NOT = { has_faith = faith:catholic }
					}
					save_scope_as = heretic_councillor
				}
			}
		}

	}
		

	option = { 
		name = KoH_religiousflavour.42.a
		if = { #Can I fire them?
			limit = {
				scope:heretic_councillor = { can_be_fired_from_council_trigger = { COURT_OWNER = scope:rulerwithheretic } }
			}
			scope:hereticadvisorruler = { fire_councillor = scope:heretic_councillor }
		}
		scope:vassal = {
			add_opinion = {
				target = scope:hereticadvisorruler
				modifier = respect_opinion
				opinion = 20
			}
		}
	
		ai_chance = {	
			base = 75
	
			modifier = {
				add = 25
				has_trait = zealous
			}
		}
	}
	option = { 
		name = KoH_religiousflavour.42.b
	
		scope:vassal = {
			add_opinion = {
				target = scope:hereticadvisorruler
				modifier = angry_opinion
				opinion = -20
			}
		}
		add_character_modifier = {
			modifier = refusedpope
			years = 3
		}
	
		ai_chance = {	
			base = 10
	
			modifier = {
				add = -75
				has_trait = zealous
			}
		}
	}
}

# # The Pope gives money to someone fighting the Infidel

KoH_religiousflavour.46 = { 
	title = KoH_religiousflavour.46.t
	desc = KoH_religiousflavour.46.desc
	theme = war
	lower_center_portrait = {
		character = scope:holywarleader
	}
	right_portrait = {
		character = scope:cardinal
	}
	left_portrait = {
		character = root
	}

	trigger = {		
		has_title = title:k_papal_state
		this = faith.religious_head
		is_imprisoned = no
		has_religion = religion:christianity_religion
		has_faith = faith:catholic
		current_year >= 1040
		faith = { fervor >= 40 }
		gold >= 400

		any_independent_ruler = {
			highest_held_title_tier >= tier_duchy
			has_faith = faith:catholic
			title:k_papal_state.holder = faith.religious_head
			OR = {
				any_character_war = {
					using_holy_war_cb_trigger = yes
					is_defender = prev
				}
				any_character_war = {
					using_holy_war_cb_trigger = yes
					is_attacker = prev
				}
			}
		}
	}

	immediate = {
		random_independent_ruler = {
			limit = {
				highest_held_title_tier >= tier_duchy
				has_faith = faith:catholic
				title:k_papal_state.holder = faith.religious_head
				OR = {
					any_character_war = {
						using_holy_war_cb_trigger = yes
						is_defender = prev
					}
					any_character_war = {
						using_holy_war_cb_trigger = yes
						is_attacker = prev
					}
				}
			}
			save_scope_as = holywarleader
		}
		random_living_cardinal = { save_scope_as = cardinal } 
	}

	option = { 
		name = KoH_religiousflavour.46.a
		show_as_tooltip = {
			faith.religious_head = {
				pay_short_term_gold = {
					target = scope:holywarleader
					gold = 120
				}
			}
		}
		
		scope:holywarleader = {
			add_opinion = {
				target = faith.religious_head
				opinion = 20
				modifier = bishop_bribed_by_pope
			}
			trigger_event = {
				id = KoH_religiousflavour.467
				days = 3
			}
		}
	
		ai_chance = {	
			base = 75
	
			modifier = {
				add = 25
				has_trait = zealous
			}
		}
	}
	option = { 
		name = KoH_religiousflavour.46.b
	

	
		ai_chance = {	
			base = 10
	
			modifier = {
				add = -75
				has_trait = zealous
			}
		}
	}
} 

KoH_religiousflavour.467 = { 
	type = letter_event
	title = KoH_religiousflavour.467.t
	desc = KoH_religiousflavour.467.desc

	sender = {
		character = faith.religious_head
	}
	opening = KoH_religiousflavour.42.opening

	option = {
		name = KoH_religiousflavour.467.a
		faith.religious_head = {
			pay_short_term_gold = {
				target = scope:holywarleader
				gold = 120
			}
		}
	}
} 

# # Leprous Courtier Departs to Join Order of Lazarus

KoH_religiousflavour.47 = { 
	title = KoH_religiousflavour.47.t
	desc = KoH_religiousflavour.47.desc
	theme = faith
	right_portrait = {
		character = scope:leper
	}
	left_portrait = {
		character = root
	}

	trigger = {		
		any_courtier_or_guest = {
			has_faith = faith:catholic
			has_trait = leper
			NOT = { has_trait = cynical}
		}
		has_faith = faith:catholic
		highest_held_title_tier >= tier_county
	}

	immediate = {
		random_courtier_or_guest = {
			limit = {
				has_faith = faith:catholic
				has_trait = leper
				NOT = { has_trait = cynical}
			}
			save_scope_as = leper
		}
	}

	option = { 
		name = KoH_religiousflavour.47.a
		
		scope:leper = {
			add_opinion = {
				target = root
				opinion = 20
				modifier = grateful_opinion
			}
			add_trait = order_member

			if = {
				limit = {
					title:c_jerusalem.holder = {
						has_faith = faith:catholic
					}
				}
				scope:leper = {
					visit_court_of = title:c_jerusalem.holder 
				}
			}
			else_if = {
				limit = {
					title:c_roma.holder = {
						has_faith = faith:catholic
					}
				}
				scope:leper = {
					visit_court_of = title:c_roma.holder
				}
			}
			else = {
				move_to_pool_at = title:c_roma.holder.capital_province
			}
		}
	
		ai_chance = {	
			base = 75
	
			modifier = {
				add = 25
				has_trait = zealous
			}
		}
	}
	option = { 
		name = KoH_religiousflavour.47.b
	
		ai_chance = {	
			base = 10
	
			modifier = {
				add = -75
				has_trait = zealous
			}
		}
	}
} 

scripted_trigger KoH_religiousflavour_48_province_trigger = {
	NOT = { religion = root.religion }
	faith = {
		faith_hostility_level = {
		target = root.faith
		value >= faith_hostile_level
		}
	}
}

#Pope Complains of Heresy Run Rampant in Ruler's Lands #1
KoH_religiousflavour.48 = { 
	title = KoH_religiousflavour.48.t
	desc = KoH_religiousflavour.48.desc
	theme = faith
	lower_center_portrait = {
		character = scope:targetedruler
	}
	right_portrait = {
		character = scope:cardinal
	}
	left_portrait = {
		character = root
	}

	trigger = {		
		has_title = title:k_papal_state
		this = faith.religious_head
		is_imprisoned = no
		has_religion = religion:christianity_religion
		has_faith = faith:catholic
		current_year >= 1040
		faith = { fervor >= 40 }

		any_independent_ruler = {
			highest_held_title_tier >= tier_duchy
			has_faith = faith:catholic
			title:k_papal_state.holder = faith.religious_head
			any_sub_realm_county = {
				KoH_religiousflavour_48_province_trigger = yes
			}
			exists = cp:councillor_court_chaplain
			NOT = {
				cp:councillor_court_chaplain = {
					is_performing_council_task = task_conversion
				}
			}
		}
	}

	immediate = {
		random_independent_ruler = {
			limit = {
				highest_held_title_tier >= tier_county
				has_faith = faith:catholic
				title:k_papal_state.holder = faith.religious_head
				any_sub_realm_county = {
					KoH_religiousflavour_48_province_trigger = yes
				}
				exists = cp:councillor_court_chaplain
				NOT = { 
					cp:councillor_court_chaplain = {
						is_performing_council_task = task_conversion
					}
				}
			}
			random_sub_realm_county = {
				limit = {
					KoH_religiousflavour_48_province_trigger = yes
				}
				save_scope_as = county
			}
			save_scope_as = targetedruler
		}
		random_living_cardinal = { save_scope_as = cardinal } 
	}

	option = { 
		name = KoH_religiousflavour.48.a
		
		scope:targetedruler = {
			trigger_event = {
				id = KoH_religiousflavour.49
				days = 3
			}
		}
	
		ai_chance = {	
			base = 75
	
			modifier = {
				add = 25
				has_trait = zealous
			}
		}
	}
	option = { 
		name = KoH_religiousflavour.48.b
	
		ai_chance = {	
			base = 10
	
			modifier = {
				add = -75
				has_trait = zealous
			}
		}
	}
} 

#Pope Complains of Heresy Run Rampant in Ruler's Lands  #2
KoH_religiousflavour.49 = { 
	title = KoH_religiousflavour.49.t
	desc = KoH_religiousflavour.49.desc
	theme = faith
	right_portrait = {
		character = scope:targetedruler
	}
	left_portrait = {
		character = faith.religious_head
	}

	option = { 
		name = KoH_religiousflavour.49.a
		
		cp:councillor_court_chaplain = {
			set_council_task = {
				task_type = task_conversion
				target = scope:county.title_province
			}
		}

		ai_chance = {	
			base = 75
	
			modifier = {
				add = 25
				has_trait = zealous
			}
		}
	}
	option = { 
		name = KoH_religiousflavour.49.b
	
		trigger_event = {
			id = KoH_religiousflavour.50
			months = 6
		}
		

		ai_chance = {	
			base = 10
	
			modifier = {
				add = -75
				has_trait = zealous
			}
			modifier = {
				add = 100
				has_trait = cynical
			}
		}
	}
} 

#Pope Complains of Heresy Run Rampant in Ruler's Lands  #3
KoH_religiousflavour.50 = { 
	title = KoH_religiousflavour.50.t
	desc = KoH_religiousflavour.50.desc
	theme = faith
	right_portrait = {
		character = scope:targetedruler
	}
	left_portrait = {
		character = faith.religious_head
	}

	trigger = {
		scope:targetedruler = {
			exists = cp:councillor_court_chaplain
			NOT = {
				cp:councillor_court_chaplain = {
					is_performing_council_task = task_conversion
				}
			}
		}
	}

	immediate = {
		scope:targetedruler = {
			primary_title = {
				save_scope_as = primary_title
			}
		}
	}

	option = { 
		name = KoH_religiousflavour.50.a
		
		scope:targetedruler = {
			add_excommunication_actual_effect = yes
		}

		ai_chance = {	
			base = 90
	
			modifier = {
				add = 25
				has_trait = zealous
			}
		}
	}
}

#Pope Demands Ruler Free Imprisoned Prince-Bishop #1
KoH_religiousflavour.51 = { 
	title = KoH_religiousflavour.51.t
	desc = KoH_religiousflavour.51.desc
	theme = faith
	left_portrait = {
		character = scope:targetedruler
	}
	right_portrait = {
		character = scope:imprisonedbishop
	}

	trigger = {		
		has_title = title:k_papal_state
		this = faith.religious_head
		is_imprisoned = no
		has_religion = religion:christianity_religion
		has_faith = faith:catholic
		current_year >= 1040
		faith = { fervor >= 40 }

		any_independent_ruler = {
			is_landed = yes
			highest_held_title_tier >= tier_duchy
			has_faith = faith:catholic
			title:k_papal_state.holder = faith.religious_head
			any_prisoner = {
				has_faith = faith:catholic
				is_imprisoned_by = prev
				OR = { 
					has_government = theocracy_government
					has_council_position = councillor_court_chaplain
				}
			}
		}
	}

	immediate = {
		random_independent_ruler = {
			limit = {
				highest_held_title_tier >= tier_duchy
				is_landed = yes
				has_faith = faith:catholic
				title:k_papal_state.holder = faith.religious_head
				any_prisoner = {
					has_faith = faith:catholic
					is_imprisoned_by = prev
					OR = { 
						has_government = theocracy_government
						has_council_position = councillor_court_chaplain
					}
				}
			}
			save_scope_as = targetedruler
		}
		scope:targetedruler = {
			random_prisoner = {
				limit = {
					is_imprisoned_by = scope:targetedruler
					has_faith = faith:catholic
					OR = { 
						has_government = theocracy_government
						has_council_position = councillor_court_chaplain
					}
				}
				save_scope_as = imprisonedbishop
			}
		}
		scope:imprisonedbishop ={
			primary_title = {
				save_scope_as = bishoptitle
			}
		}

		random_living_cardinal = {
			save_scope_as = cardinal
		}
	}

	option = { 
		name = KoH_religiousflavour.51.a
		
		scope:targetedruler = {
			trigger_event = {
				id = KoH_religiousflavour.52
				days = 3
			}
		}
	
		ai_chance = {	
			base = 75
	
			modifier = {
				add = 25
				has_trait = zealous
			}
		}
	}
	option = { 
		name = KoH_religiousflavour.51.b
	
		scope:imprisonedbishop = {
			add_opinion = {
				target = root
				modifier = angry_opinion
				opinion = -10
			}
		}

		ai_chance = {	
			base = 10
	
			modifier = {
				add = -75
				has_trait = zealous
			}
		}
	}
} 

#Pope Demands Ruler Free Imprisoned Prince-Bishop  #2
KoH_religiousflavour.52 = { 
	title = KoH_religiousflavour.52.t
	desc = KoH_religiousflavour.52.desc
	theme = faith
	right_portrait = {
		character = scope:imprisonedbishop
	}
	left_portrait = {
		character = faith.religious_head
	}

	option = { 
		name = KoH_religiousflavour.52.a
		
		scope:imprisonedbishop = {
			release_from_prison = yes
		}

		ai_chance = {	
			base = 75
	
			modifier = {
				add = 25
				has_trait = zealous
			}
		}
	}
	option = { 
		name = KoH_religiousflavour.52.b
	

		faith.religious_head = {
			trigger_event = {
				id = KoH_religiousflavour.53
				months = 1
			}
		}

		ai_chance = {	
			base = 10
	
			modifier = {
				add = -75
				has_trait = zealous
			}
			modifier = {
				add = 100
				has_trait = cynical
			}
		}
	}
} 

#Pope Demands Ruler Free Imprisoned Prince-Bishop  #3
KoH_religiousflavour.53 = { 
	hidden = yes

	immediate = {
		if = {
			limit = {
				scope:imprisonedbishop = {
					is_imprisoned = yes
					is_imprisoned_by = scope:targetedruler
				}
			}
			faith.religious_head = {
				trigger_event = KoH_religiousflavour.54
			}
		}
	}
}

KoH_religiousflavour.54 = {
	title = KoH_religiousflavour.54.t
	desc = KoH_religiousflavour.54.desc
	theme = faith
	left_portrait = {
		character = scope:targetedruler
	}
	right_portrait = {
		character = faith.religious_head
	}

	option = { 
		name = KoH_religiousflavour.54.a
		
		scope:targetedruler = {
			add_excommunication_actual_effect = yes
			hidden_effect = {
				send_interface_toast = {
					type = event_toast_effect_good
					title =  KoH_religiousflavour.54.a.toast
					left_icon = faith.religious_head
					show_as_tooltip = {
						add_excommunication_actual_effect = yes
					}
				}
			}
		}

		ai_chance = {	
			base = 90
	
			modifier = {
				add = 25
				has_trait = zealous
			}
		}
	}
}

#Murdered a Bishop
KoH_religiousflavour.55 = {
	title = KoH_religiousflavour.55.t
	desc = KoH_religiousflavour.55.desc
	theme = faith
	left_portrait = {
		character = scope:murderer
	}
	right_portrait = {
		character = faith.religious_head
	}

	immediate = { 
		scope:murderer = {
			primary_title = {
				save_scope_as = primary_title
			}
		}
	}

	option = { 
		name = KoH_religiousflavour.55.a
		
		scope:murderer = {
			add_excommunication_actual_effect = yes
			hidden_effect = {
				send_interface_toast = {
					type = event_toast_effect_good
					title =  KoH_religiousflavour.54.a.toast
					left_icon = faith.religious_head
					show_as_tooltip = {
						add_excommunication_actual_effect = yes
					}
				}
			}
		}

		ai_chance = {	
			base = 90
	
			modifier = {
				add = 250
				has_trait = zealous
			}
		}
	}
}

#Pope Excommunicates Ruler for Declaring War Against Prince-Bishop
KoH_religiousflavour.56 = {
	title = KoH_religiousflavour.56.t
	desc = KoH_religiousflavour.56.desc
	theme = faith
	left_portrait = {
		character = scope:BishopAttacker
	}
	lower_right_portrait = {
		character = scope:BishopyDefender
	}
	right_portrait = {
		character = scope:Pope
	}

	immediate = {
		every_ruler = {
			limit = {
				is_at_war_with = scope:BishopyDefender		
				any_character_war = {
					is_war_leader = scope:attacker
					is_participant = scope:BishopyDefender
				}
			}
			save_scope_as = BishopAttacker
		}

		title:k_papal_state.holder = {
			save_scope_as = Pope
		}

		random_living_cardinal = {
			save_scope_as = cardinal
		}
	}

	option = { 
		name = KoH_religiousflavour.56.a
		
		scope:BishopAttacker = {
			show_as_tooltip = {
				every_character_war = {
					limit = {
						is_attacker = scope:BishopAttacker
						is_defender = scope:BishopyDefender
					}
					every_war_attacker = {
						add_excommunication_actual_effect = yes
					}
				}
			}
			trigger_event = {
				id = KoH_religiousflavour.57
				days = 3
			}
			
		}

		ai_chance = {	
			base = 90
	
			modifier = {
				add = 250
				has_trait = zealous
			}
		}
	}
	option = { 
		name = KoH_religiousflavour.56.b

		ai_chance = {	
			base = 10
	
			modifier = {
				add = -75
				has_trait = zealous
			}
		}
	}
}

KoH_religiousflavour.57 = {
	title = KoH_religiousflavour.57.t
	desc = KoH_religiousflavour.57.desc
	theme = faith
	left_portrait = {
		character = scope:BishopAttacker
	}
	lower_right_portrait = {
		character = scope:BishopyDefender
	}
	right_portrait = {
		character = scope:Pope
	}

	immediate = {
		every_ruler = {
			limit = {
				is_at_war_with = scope:BishopyDefender		
				any_character_war = {
					is_war_leader = scope:attacker
					is_participant = scope:BishopyDefender
				}
			}
			save_scope_as = BishopAttacker
		}

		title:k_papal_state.holder = {
			save_scope_as = Pope
		}
	}

	option = { 
		name = KoH_religiousflavour.57.a
		
		scope:BishopAttacker = {
			every_character_war = {
				limit = {
					is_attacker = scope:BishopAttacker
					is_defender = scope:BishopyDefender
				}
				every_war_attacker = {
					add_excommunication_actual_effect = yes
				}
			}
		}


		ai_chance = {	
			base = 1
		}
	}
}

#Christmas! 
KoH_religiousflavour.58 = {#christmas
	type = character_event
	title = KoH_religiousflavour.58.t
	desc = KoH_religiousflavour.58.desc
	theme = family
	override_background = { event_background = TCT_christmas }
	left_portrait = {
		character = scope:family
		animation = happiness
	}
	
	right_portrait = {
		character = root
		animation = ecstasy
	}

	# widgets = {
	# 	widget = {
	# 		gui = "window_activity_jank_start_widget"
	# 		container = "custom_widgets_container"
	# 		controller = default
	# 		setup_scope = { }
	# 	}
	# }

	immediate = {
		#play_music_cue = CK2_songs_of_yuletide 
		if = {
			limit = {
				is_married = yes
			}
			spouse = {
				save_scope_as = family
			}
		}
		else = {
			limit = {
				any_child = {
					count >= 1
				}
			}
			random_child = {
				save_scope_as = family
			}
		}
		root.capital_province = {
			save_scope_as = provincefun
		}
	}

	option = { #wassailing
		name = KoH_religiousflavour.58.a
		add_stress = medium_stress_loss
	}
	option = { #feast
		name = KoH_religiousflavour.58.b
		open_view_data = {
			view = activity_list_detail_host_window
			data = activity_type:activity_feast
		}
		add_character_flag = {
			flag = hosting_christmas_or_saint_day
			days = 10
		}
		custom_tooltip = KoH_religiousflavour_58_b_tt
	}	

	option = { #family
		name = KoH_religiousflavour.58.c
		every_close_or_extended_family_member = {
			limit = {
				NOT = { this = root }
			}
			add_opinion = {
				modifier = KOH_christmas_opinion
				target = root
			}
		}
	}
}

#KoH_religiousflavour.59 #christmas

#KoH_religiousflavour.60 #christmas

#KoH_religiousflavour.61 #christmas

#KoH_religiousflavour.62 #christmas

KoH_religiousflavour.63 = {
	type = character_event
	title = KoH_religiousflavour.63.t
	desc = KoH_religiousflavour.63.desc
	theme = faith
	#override_background = { event_background = TCT_christmas }
	left_portrait = {
		character = scope:family
		animation = happiness
	}
	
	right_portrait = {
		character = root
		animation = ecstasy
	}

	immediate = {
		global_var:TCT_saint_day_dummychar = {
			var:TCT_saint_day_saint = {
				save_scope_as = localsaint
			}
		}
		
		if = {
			limit = {
				is_married = yes
			}
			spouse = {
				save_scope_as = family
			}
		}
		else = {
			limit = {
				any_child = {
					count >= 1
				}
			}
			random_child = {
				save_scope_as = family
			}
		}
		root.capital_province = {
			save_scope_as = provincefun
		}
	}

	option = { #wassailing
		name = KoH_religiousflavour.58.a
		add_stress = medium_stress_loss
	}
	option = { #feast
		name = KoH_religiousflavour.58.b
		capital_province = {
			spawn_activity = {
				type = activity_feast
				owner = root
			}
		}	
	}	

	option = { #family
		name = KoH_religiousflavour.58.c
		every_close_or_extended_family_member = {
			limit = {
				NOT = { this = root }
			}
			add_opinion = {
				modifier = KOH_saintdaysaint_opinion
				target = root
			}
		}
	}
}

#Ending a Pilgrimage to a Saintly Tomb
KoH_religiousflavour.250 = { 
	title = KoH_religiousflavour.250.t
	desc = KoH_religiousflavour.250.desc
	theme = learning_scholarship_focus
	orphan = yes 
	left_portrait = {
		character = root
	}
	right_portrait = {
		character = scope:localsaint
		animation = personality_rational
	}
	
	immediate = {
		if = {
			limit = {
				location.county = {
					has_variable_list = faith_saints_and_capital
				}
			}
			save_scope_as = saintlocation
		}
		scope:saintlocation = {
			random_in_list = {
				variable = faith_saints_and_capital
				save_scope_as = localsaint
			}
		}
		play_music_cue = Trinity_4
	}

	option = { 
		name = KoH_religiousflavour.300.a

	}
}

#Saint related - finds nearby saint
KoH_religiousflavour.300 = { 
	title = KoH_religiousflavour.300.t
	desc = KoH_religiousflavour.300.desc
	theme = learning_scholarship_focus
	orphan = yes 
	left_portrait = {
		character = scope:popewantsit
	}
	right_portrait = {
		character = scope:localsaint
		animation = personality_rational
	}

	trigger = {
		has_nearby_saint_site = yes
	}

	immediate = {
		capital_county.duchy = {
			random_in_de_jure_hierarchy = {
				continue = {
					tier > tier_county
				}
				limit = {
					tier = tier_county
					has_variable_list = faith_saints_and_capital
				}
				save_scope_as = saintlocation
			}
				
			scope:saintlocation = {
				random_in_list = {
					variable = faith_saints_and_capital
					save_scope_as = localsaint
				}
			}
		}
	}

	option = { 
		name = KoH_religiousflavour.300.a

	}
}

KoH_religiousflavour.400 = {
	title = KoH_religiousflavour.400.t
	desc = KoH_religiousflavour.400.desc
	theme = learning_scholarship_focus
	left_portrait = {
		character = scope:deadpope
	}
	right_portrait = {
		character = title:k_papal_state.holder
		animation = personality_honorable
		triggered_outfit = {
			trigger = { exists = global_var:cfp_is_loaded }
			outfit_tags = { cardinal_outfit }
		}
		triggered_outfit = {
			trigger = { NOT = { exists = global_var:cfp_is_loaded } }
			outfit_tags = { bishop_outfit }
		}
		hide_info = yes
	}
	lower_center_portrait = {
		character = scope:cardinal1
		animation = ecstasy
		triggered_outfit = {
			trigger = { exists = global_var:cfp_is_loaded }
			outfit_tags = { cardinal_outfit }
		}
		triggered_outfit = {
			trigger = { NOT = { exists = global_var:cfp_is_loaded } }
			outfit_tags = { bishop_outfit }
		}
	}
	lower_left_portrait = {
		character = scope:cardinal2
		animation = content
		triggered_outfit = {
			trigger = { exists = global_var:cfp_is_loaded }
			outfit_tags = { cardinal_outfit }
		}
		triggered_outfit = {
			trigger = { NOT = { exists = global_var:cfp_is_loaded } }
			outfit_tags = { bishop_outfit }
		}
	}
	lower_right_portrait = {
		character = scope:cardinal3
		animation = sadness
		triggered_outfit = {
			trigger = { exists = global_var:cfp_is_loaded }
			outfit_tags = { cardinal_outfit }
		}
		triggered_outfit = {
			trigger = { NOT = { exists = global_var:cfp_is_loaded } }
			outfit_tags = { bishop_outfit }
		}
	}

	immediate = {
		random_living_cardinal = {
			save_scope_as = cardinal1
		}
		random_living_cardinal = {
			limit = { NOT = { this = scope:cardinal1 } }
			save_scope_as = cardinal2
		}
		random_living_cardinal = {
			limit = { NOT = { this = scope:cardinal1 this = scope:cardinal2 } }
			save_scope_as = cardinal3
		}
	}

	option = { 
		name = KoH_religiousflavour.400.a
		open_view_data = {
			view = royal_court
			player = root
		}
		custom_tooltip = court_maintenance.0010.a.tooltip
		trigger_event = {
			id = KoH_religiousflavour.4001
		}

		ai_chance = {
			base = 50
		}
	}
}

KoH_religiousflavour.4001 = {
	type = court_event
	title = KoH_religiousflavour.4001.t
	desc = KoH_religiousflavour.4001.desc
	theme = court
	override_background = { event_background = throne_room }

	right_portrait = {
		character = title:k_papal_state.holder
		animation = personality_honorable
		triggered_outfit = {
			trigger = { exists = global_var:cfp_is_loaded }
			outfit_tags = { cardinal_outfit }
		}
		triggered_outfit = {
			trigger = { NOT = { exists = global_var:cfp_is_loaded } }
			outfit_tags = { bishop_outfit }
		}
		hide_info = yes
	}


	court_scene = {
		button_position_character = scope:cardinal4 
		court_owner = root
		court_event_force_open = yes
		should_pause_time = yes
		roles = {
		    scope:newpope = {
				group = event_group
				animation = worried
				outfit_tags = { bishop_outfit }
		    }
			scope:cardinal2 = {
				group = event_group
				animation = worried
				
		    }
			scope:cardinal3 = {
				group = event_group
				animation = worried
				
		    }
			scope:cardinal4 = {
				group = event_group
				animation = worried
				
		    }
			scope:cardinal5 = {
				group = event_group
				animation = worried
				
		    }
			scope:cardinal6 = {
				group = event_group
				animation = worried
				
		    }
			scope:cardinal7 = {
				group = event_group
				animation = worried
		
		    }
		}
	}

	widget = {
		gui = "event_window_widget_event_chain_progress"
		container = "custom_widgets_container"
		controller = event_chain_progress
	}

	immediate = {
		save_scope_as = newpope
		add_character_flag = {
			flag = wearing_cardinal
			days = 3
		}
		if = {
			limit = {
				exists = var:duplicatenameexists
			}
			var:duplicatenameexists = {
				save_scope_as = duplicatedname
			}
		}

		if = {
			limit = {
				has_nickname = nick_cardinal
			}
			remove_nickname = yes
		}

		random_living_cardinal = {
			save_scope_as = cardinal1
		}

		random_living_cardinal = {
			limit = { NOT = { this = scope:cardinal1 } }
			save_scope_as = cardinal2
			court_event_character_flag_effect = yes
		}

		random_living_cardinal = {
			limit = { NOT = { this = scope:cardinal1 this = scope:cardinal2 } }
			save_scope_as = cardinal3
			court_event_character_flag_effect = yes
		}

		random_living_cardinal = {
			limit = { NOT = { this = scope:cardinal1 this = scope:cardinal2 this = scope:cardinal3 } }
			save_scope_as = cardinal4
			court_event_character_flag_effect = yes
		}
		
		random_living_cardinal = {
			limit = { NOT = { this = scope:cardinal1 this = scope:cardinal2 this = scope:cardinal3 this = scope:cardinal4 } }
			save_scope_as = cardinal5
			court_event_character_flag_effect = yes
		}

		random_living_cardinal = {
			limit = { NOT = { this = scope:cardinal1 this = scope:cardinal2 this = scope:cardinal3 this = scope:cardinal4 this = scope:cardinal5 } }
			save_scope_as = cardinal6
			court_event_character_flag_effect = yes
		}

		random_living_cardinal = {
			limit = { NOT = { this = scope:cardinal1 this = scope:cardinal2 this = scope:cardinal3 this = scope:cardinal4 this = scope:cardinal5 this = scope:cardinal6 }}
			save_scope_as = cardinal7
			court_event_character_flag_effect = yes
		}

		# Tracking for how many petitioners have come through.
		set_variable = {
			name = num_petitioners
			value = 2
		}
		# Start a counting variable for widget progress.
		set_variable = {
			name = petitioner_current_progress
			value = 0
		}
		# Widget setup.
		## Set the total length of the chain.
		save_scope_value_as = {
			name = event_chain_length
			value = 3
		}
		## Manually set the current widget length.
		### Due to code-side shenanigans, we do this a bit awkwardly.
		save_scope_value_as = {
			name = event_chain_progress
			value = 1
		}
	}

	option = { 
		name = KoH_religiousflavour.4001.a
		
		if = {
			limit = {
				this = character:2010
			}
			trigger_event = KoH_religiousflavour.600
		}
		else = {
			trigger_event = KoH_religiousflavour.5725
		}	

		ai_chance = {
			base = 50
		}
	}
}

#SELECT A NAME 
#Papal Naming!
KoH_religiousflavour.5725 = {
	type = character_event
	title = KoH_religiousflavour.5725.t
	desc = {
		first_valid = {
			#If we're renaming ourself
			triggered_desc = {
				trigger = {
					root = scope:child
				}
				desc = KoH_religiousflavour.5725.desc.me
			}
			#If we're renaming someone else
			triggered_desc = {
				desc = birth.9004.desc
			}
		}
	}
	theme = family
	override_background = { event_background = relaxing_room }
	right_portrait = {
		character = scope:child
		animation = happiness
	}
	#NAMING WIDGET
	widgets = {
		widget = {
			gui = "event_window_widget_event_chain_progress"
			container = "custom_widgets_container"
			controller = event_chain_progress
		}
		widget = {
			is_shown = {
				allow_naming_on_birth_of_child_trigger = { CHILD = scope:child }
			}
			gui = "event_window_widget_name_pope"
			container = "dynamic_birth_name"
			controller = name_character
			setup_scope = {
				scope:child = { save_scope_as = name_character_target }
			}
		}
	}

	court_scene = {
		button_position_character = scope:cardinal4 
		court_owner = root
		court_event_force_open = yes
		should_pause_time = yes
		roles = {
		    scope:newpope = {
				group = event_group
				animation = worried
				
		    }
			scope:cardinal2 = {
				group = event_group
				animation = worried
				
		    }
			scope:cardinal3 = {
				group = event_group
				animation = worried
				
		    }
			scope:cardinal4 = {
				group = event_group
				animation = worried
				
		    }
			scope:cardinal5 = {
				group = event_group
				animation = worried
				
		    }
			scope:cardinal6 = {
				group = event_group
				animation = worried
				
		    }
			scope:cardinal7 = {
				group = event_group
				animation = worried
		
		    }
		}
	}

	immediate = {
		save_scope_as = child

		if = {
			limit = {
				title:k_papal_state.holder = { is_ai = yes }
			}
			title:k_papal_state.holder = {
				random_list = {
					1 = {
						change_first_name = Alexander
					}
					1 = {
						change_first_name = Anastasius
					}
					1 = {
						change_first_name = Caelestinus
					}
					1 = {
						change_first_name = Callistus
					}
					1 = {
						change_first_name = Clemens
					}
					1 = {
						change_first_name = Eugenius
					}
					1 = {
						change_first_name = Leo
					}
					1 = {
						change_first_name = Gregorius
					}
					1 = {
						change_first_name = Hadrianus
					}
					1 = {
						change_first_name = Honorius
					}
					1 = {
						change_first_name = Innocentius
					}
					1 = {
						change_first_name = Ioannes
					}
					1 = {
						change_first_name = Lucius
					}
					1 = {
						change_first_name = Marinus
					}
					1 = {
						change_first_name = Martinus
					}
					1 = {
						change_first_name = Nicolaus
					}
					1 = {
						change_first_name = Sergius
					}
					1 = {
						change_first_name = Silvester
					}
					1 = {
						change_first_name = Stephanus
					}
					1 = {
						change_first_name = Urbanus
					}
					1 = {
						change_first_name = Victor
					}
				}
			}
		}

		# Tracking for how many petitioners have come through.
		set_variable = {
			name = num_petitioners
			value = 2
		}
		# Start a counting variable for widget progress.
		set_variable = {
			name = petitioner_current_progress
			value = 0
		}
		# Widget setup.
		## Set the total length of the chain.
		save_scope_value_as = {
			name = event_chain_length
			value = 3
		}
		## Manually set the current widget length.
		### Due to code-side shenanigans, we do this a bit awkwardly.
		save_scope_value_as = {
			name = event_chain_progress
			value = 2
		}
	}
	#Go ahead
	option = {
		name = birth.9004.a
		trigger_event = KoH_religiousflavour.401
	}
	after = {
		if = {
			limit = {
				exists = character:2010
				this = character:2010
			}
			change_first_name = Gregorius
		}
	}
}

KoH_religiousflavour.401 = {
	type = court_event
	title = KoH_religiousflavour.401.t
	desc = KoH_religiousflavour.401.desc
	theme = court
	override_background = { event_background = throne_room }

	right_portrait = {
		character = title:k_papal_state.holder
		animation = personality_honorable
		triggered_outfit = {
			trigger = { exists = global_var:cfp_is_loaded }
			outfit_tags = { cardinal_outfit }
		}
		triggered_outfit = {
			trigger = { NOT = { exists = global_var:cfp_is_loaded } }
			outfit_tags = { bishop_outfit }
		}
	}

	court_scene = {
		button_position_character = scope:cardinal4 
		court_owner = root
		court_event_force_open = yes
		should_pause_time = yes
		roles = {
		    scope:newpope= {
				group = event_group
				animation = worried
		    }
			scope:cardinal2 = {
				group = event_group
				animation = worried
				
		    }
			scope:cardinal3 = {
				group = event_group
				animation = worried
				
		    }
			scope:cardinal4 = {
				group = event_group
				animation = worried
				
		    }
			scope:cardinal5 = {
				group = event_group
				animation = worried
				
		    }
			scope:cardinal6 = {
				group = event_group
				animation = worried
				
		    }
			scope:cardinal7 = {
				group = event_group
				animation = worried

		    }
		}
	}

	immediate = {
		# Clean up the ol' variable.
		remove_variable = petitioner_current_progress
		# Update the widget one last time.
		save_scope_value_as = {
			name = event_chain_progress
			value = 3
		}
		remove_character_flag = wearing_cardinal
	}

	widget = {
		gui = "event_window_widget_event_chain_progress"
		container = "custom_widgets_container"
		controller = event_chain_progress
	}

	option = { 
		name = KoH_religiousflavour.401.a

		ai_chance = {
			base = 50
		}
	}
	after = {
		every_ruler = {
			limit = {
				has_faith = faith:catholic
				primary_title.tier >= tier_county
				NOT = { this = faith.religious_head }
				NOT = {
					has_title = title:k_papal_state
				}
			}
			trigger_event = {
				id = KoH_religiousflavour.402
				days = {5 15}
			}
		}
	}
}

KoH_religiousflavour.402 = {
	title = KoH_religiousflavour.402.t
	desc = KoH_religiousflavour.402.desc
	theme = learning_scholarship_focus
	left_portrait = {
		character = title:k_papal_state.holder
		animation = personality_honorable
	}
	right_portrait = {
		character = scope:cardinal4
		animation = ecstasy
	}

	option = { 
		name = KoH_religiousflavour.402.a

		ai_chance = {
			base = 50
		}
	}
}
    
#Handing out county to Clergy
KoH_religiousflavour.499 = {
	hidden = yes

	immediate = {
		every_held_title = {
			limit = { tier = tier_county NOT = { root.capital_county = this } }
			add_to_list = personally_held_counties_list
		}

		ordered_in_list = {
			list = personally_held_counties_list
			max = countydonationclery_cap_value
			order_by = { add = development_level }
			# Grab three options.
			if = {
				limit = {
					NOT = { exists = scope:clergycounty_1 root.capital_county = this }
				}
				save_scope_as = clergycounty_1
			}
			else_if = {
				limit = {
					NOR = {
						root.capital_county = this
						this = scope:clergycounty_1
						exists = scope:clergycounty_2
					}
				}
				save_scope_as = clergycounty_2
			}
			else_if = {
				limit = {
					NOR = {
						root.capital_county = this
						this = scope:clergycounty_1
						this = scope:clergycounty_2
						exists = scope:clergycounty_3
					}
				}
				save_scope_as = clergycounty_3
			}
			else_if = {
				limit = {
					NOR = {
						root.capital_county = this
						this = scope:clergycounty_1
						this = scope:clergycounty_2
						this = scope:clergycounty_3
						exists = scope:clergycounty_4
					}
				}
				save_scope_as = clergycounty_4
			}
			else_if = {
				limit = {
					NOR = {
						root.capital_county = this
						this = scope:clergycounty_1
						this = scope:clergycounty_2
						this = scope:clergycounty_3
						this = scope:clergycounty_4
						exists = scope:clergycounty_5
					}
				}
				save_scope_as = clergycounty_5
			}
			else_if = {
				limit = {
					NOR = {
						this = root.capital_county
						this = scope:clergycounty_1
						this = scope:clergycounty_2
						this = scope:clergycounty_3
						this = scope:clergycounty_4
						this = scope:clergycounty_5
						exists = scope:clergycounty_6
					}
				}
				save_scope_as = clergycounty_6
			}
			else_if = {
				limit = {
					NOR = {
						this = root.capital_county
						this = scope:clergycounty_1
						this = scope:clergycounty_2
						this = scope:clergycounty_3
						this = scope:clergycounty_4
						this = scope:clergycounty_5
						this = scope:clergycounty_6
						exists = scope:clergycounty_7
					}
				}
				save_scope_as = clergycounty_7
			}
			else_if = {
				limit = {
					NOR = {
						this = root.capital_county
						this = scope:clergycounty_1
						this = scope:clergycounty_2
						this = scope:clergycounty_3
						this = scope:clergycounty_4
						this = scope:clergycounty_5
						this = scope:clergycounty_6
						this = scope:clergycounty_7
						exists = scope:clergycounty_8
					}
				}
				save_scope_as = clergycounty_8
			}
			else_if = {
				limit = {
					NOR = {
						this = root.capital_county
						this = scope:clergycounty_1
						this = scope:clergycounty_2
						this = scope:clergycounty_3
						this = scope:clergycounty_4
						this = scope:clergycounty_5
						this = scope:clergycounty_6
						this = scope:clergycounty_7
						this = scope:clergycounty_8
						exists = scope:clergycounty_9
					}
				}
				save_scope_as = clergycounty_9
			}
		}
		trigger_event = KoH_religiousflavour.500
	}
}

KoH_religiousflavour.500 = { 
	title = KoH_religiousflavour.500.t
	desc = {
		first_valid = {
			triggered_desc = {
				trigger = {
					has_trait = cynical
				}
				desc = KoH_religiousflavour.500.desc.cynical
			}
			triggered_desc = {
				trigger = {
					NOT = { has_trait = cynical }
				}
				desc = KoH_religiousflavour.500.desc
			}
		}
	}

	theme = learning_scholarship_focus
	left_portrait = {
		character = root
	}

	option = { 
		name = KoH_religiousflavour.500.a
		trigger = {
			exists = scope:clergycounty_1
		}
		custom_tooltip = KoH_religiousflavour.500.a.tt
		hidden_effect = {
			scope:clergycounty_1 = {
				save_scope_as = countyfortheocracy
			}

			create_character = {
				template = priest_character_template
				location = root.capital_province
				save_scope_as = template_priest
			}

			create_title_and_vassal_change = {
				type = granted
				save_scope_as = title_change
				add_claim_on_loss = no
			}
			scope:countyfortheocracy = {
				change_title_holder = {
					holder = scope:template_priest
					change = scope:title_change
				}
			}
			resolve_title_and_vassal_change = scope:title_change
			scope:template_priest = {
				add_realm_law = bishop_theocratic_succession_law
				change_government = theocracy_government
			}
		}
		add_piety = 300
		rot_get_pope_of_target = {
			TARGET = root
		}
		scope:pope_of_target = {
			add_opinion = {
				target = root
				modifier = grantedlandtoclergy
				opinion = 10
			}
		}
		add_character_modifier = {
			modifier = donatedlandtoclergy
			years = 5
		}

		ai_chance = {
			base = 100
		}
	}
	option = { 
		name = KoH_religiousflavour.500.b
		trigger = {
			exists = scope:clergycounty_2
		}
		custom_tooltip = KoH_religiousflavour.500.a.tt
		hidden_effect = {
			scope:clergycounty_2 = {
				save_scope_as = countyfortheocracy
			}

			create_character = {
				template = priest_character_template
				location = root.capital_province
				save_scope_as = template_priest
			}

			create_title_and_vassal_change = {
				type = granted
				save_scope_as = title_change
				add_claim_on_loss = no
			}
			scope:countyfortheocracy = {
				change_title_holder = {
					holder = scope:template_priest
					change = scope:title_change
				}
			}
			resolve_title_and_vassal_change = scope:title_change
			scope:template_priest = {
				add_realm_law = bishop_theocratic_succession_law
				change_government = theocracy_government
			}
		}
		add_piety = 300
		rot_get_pope_of_target = {
			TARGET = root
		}
		scope:pope_of_target = {
			add_opinion = {
				target = root
				modifier = grantedlandtoclergy
				opinion = 10
			}
		}
		add_character_modifier = {
			modifier = donatedlandtoclergy
			years = 5
		}
		
	}
	option = { 
		name = KoH_religiousflavour.500.c
		trigger = {
			exists = scope:clergycounty_3
		}
		custom_tooltip = KoH_religiousflavour.500.a.tt
		hidden_effect = {
			scope:clergycounty_3 = {
				save_scope_as = countyfortheocracy
			}

			create_character = {
				template = priest_character_template
				location = root.capital_province
				save_scope_as = template_priest
			}

			create_title_and_vassal_change = {
				type = granted
				save_scope_as = title_change
				add_claim_on_loss = no
			}
			scope:countyfortheocracy = {
				change_title_holder = {
					holder = scope:template_priest
					change = scope:title_change
				}
			}
			resolve_title_and_vassal_change = scope:title_change
			scope:template_priest = {
				add_realm_law = bishop_theocratic_succession_law
				change_government = theocracy_government
			}
		}
		add_piety = 300
		rot_get_pope_of_target = {
			TARGET = root
		}
		scope:pope_of_target = {
			add_opinion = {
				target = root
				modifier = grantedlandtoclergy
				opinion = 10
			}
		}
		add_character_modifier = {
			modifier = donatedlandtoclergy
			years = 5
		}
	}
	option = { 
		name = KoH_religiousflavour.500.d
		trigger = {
			exists = scope:clergycounty_4
		}
		custom_tooltip = KoH_religiousflavour.500.a.tt
		hidden_effect = {
			scope:clergycounty_4 = {
				save_scope_as = countyfortheocracy
			}

			create_character = {
				template = priest_character_template
				location = root.capital_province
				save_scope_as = template_priest
			}

			create_title_and_vassal_change = {
				type = granted
				save_scope_as = title_change
				add_claim_on_loss = no
			}
			scope:countyfortheocracy = {
				change_title_holder = {
					holder = scope:template_priest
					change = scope:title_change
				}
			}
			resolve_title_and_vassal_change = scope:title_change
			scope:template_priest = {
				add_realm_law = bishop_theocratic_succession_law
				change_government = theocracy_government
			}
		}
		add_piety = 300
		rot_get_pope_of_target = {
			TARGET = root
		}
		scope:pope_of_target = {
			add_opinion = {
				target = root
				modifier = grantedlandtoclergy
				opinion = 10
			}
		}
		add_character_modifier = {
			modifier = donatedlandtoclergy
			years = 5
		}
		
	}

	option = { 
		name = KoH_religiousflavour.500.dd
		trigger = {
			exists = scope:clergycounty_5
		}
		custom_tooltip = KoH_religiousflavour.500.a.tt
		hidden_effect = {
			scope:clergycounty_5 = {
				save_scope_as = countyfortheocracy
			}

			create_character = {
				template = priest_character_template
				location = root.capital_province
				save_scope_as = template_priest
			}

			create_title_and_vassal_change = {
				type = granted
				save_scope_as = title_change
				add_claim_on_loss = no
			}
			scope:countyfortheocracy = {
				change_title_holder = {
					holder = scope:template_priest
					change = scope:title_change
				}
			}
			resolve_title_and_vassal_change = scope:title_change
			scope:template_priest = {
				add_realm_law = bishop_theocratic_succession_law
				change_government = theocracy_government
			}
		}
		add_piety = 300
		rot_get_pope_of_target = {
			TARGET = root
		}
		scope:pope_of_target = {
			add_opinion = {
				target = root
				modifier = grantedlandtoclergy
				opinion = 10
			}
		}
		add_character_modifier = {
			modifier = donatedlandtoclergy
			years = 5
		}
	}

	option = { 
		name = KoH_religiousflavour.500.ee
		trigger = {
			exists = scope:clergycounty_6
		}

		trigger_event = KoH_religiousflavour.501
		
	}

	option = { 
		name = KoH_religiousflavour.500.e
		
	}
}

KoH_religiousflavour.501 = {
	title = KoH_religiousflavour.500.t
	desc = KoH_religiousflavour.500.desc
	theme = learning_scholarship_focus
	left_portrait = {
		character = root
	}

	option = { 
		name = KoH_religiousflavour.500.g
		trigger = {
			exists = scope:clergycounty_6
		}
		custom_tooltip = KoH_religiousflavour.500.a.tt
		hidden_effect = {
			scope:clergycounty_6 = {
				save_scope_as = countyfortheocracy
			}

			create_character = {
				template = priest_character_template
				location = root.capital_province
				save_scope_as = template_priest
			}

			create_title_and_vassal_change = {
				type = granted
				save_scope_as = title_change
				add_claim_on_loss = no
			}
			scope:countyfortheocracy = {
				change_title_holder = {
					holder = scope:template_priest
					change = scope:title_change
				}
			}
			resolve_title_and_vassal_change = scope:title_change
			scope:template_priest = {
				add_realm_law = bishop_theocratic_succession_law
				change_government = theocracy_government
			}
		}
		add_piety = 300
		rot_get_pope_of_target = {
			TARGET = root
		}
		scope:pope_of_target = {
			add_opinion = {
				target = root
				modifier = grantedlandtoclergy
				opinion = 10
			}
		}
		add_character_modifier = {
			modifier = donatedlandtoclergy
			years = 5
		}
		
	}
	option = { 
		name = KoH_religiousflavour.500.h
		trigger = {
			exists = scope:clergycounty_7
		} 
		custom_tooltip = KoH_religiousflavour.500.a.tt
		hidden_effect = {
			scope:clergycounty_7 = {
				save_scope_as = countyfortheocracy
			}

			create_character = {
				template = priest_character_template
				location = root.capital_province
				save_scope_as = template_priest
			}

			create_title_and_vassal_change = {
				type = granted
				save_scope_as = title_change
				add_claim_on_loss = no
			}
			scope:countyfortheocracy = {
				change_title_holder = {
					holder = scope:template_priest
					change = scope:title_change
				}
			}
			resolve_title_and_vassal_change = scope:title_change
			scope:template_priest = {
				add_realm_law = bishop_theocratic_succession_law
				change_government = theocracy_government
			}
		}
		add_piety = 300
		rot_get_pope_of_target = {
			TARGET = root
		}
		scope:pope_of_target = {
			add_opinion = {
				target = root
				modifier = grantedlandtoclergy
				opinion = 10
			}
		}
		add_character_modifier = {
			modifier = donatedlandtoclergy
			years = 5
		}
		
	}
	option = { 
		name = KoH_religiousflavour.500.i
		trigger = {
			exists = scope:clergycounty_8
		} 
		custom_tooltip = KoH_religiousflavour.500.a.tt
		hidden_effect = {
			scope:clergycounty_8 = {
				save_scope_as = countyfortheocracy
			}

			create_character = {
				template = priest_character_template
				location = root.capital_province
				save_scope_as = template_priest
			}

			create_title_and_vassal_change = {
				type = granted
				save_scope_as = title_change
				add_claim_on_loss = no
			}
			scope:countyfortheocracy = {
				change_title_holder = {
					holder = scope:template_priest
					change = scope:title_change
				}
			}
			resolve_title_and_vassal_change = scope:title_change
			scope:template_priest = {
				add_realm_law = bishop_theocratic_succession_law
				change_government = theocracy_government
			}
		}
		add_piety = 300
		rot_get_pope_of_target = {
			TARGET = root
		}
		scope:pope_of_target = {
			add_opinion = {
				target = root
				modifier = grantedlandtoclergy
				opinion = 10
			}
		}
		add_character_modifier = {
			modifier = donatedlandtoclergy
			years = 5
		}
		
	}
	option = { 
		name = KoH_religiousflavour.500.j
		trigger = {
			exists = scope:clergycounty_9
		} 
		custom_tooltip = KoH_religiousflavour.500.a.tt
		hidden_effect = {
			scope:clergycounty_9 = {
				save_scope_as = countyfortheocracy
			}

			create_character = {
				template = priest_character_template
				location = root.capital_province
				save_scope_as = template_priest
			}

			create_title_and_vassal_change = {
				type = granted
				save_scope_as = title_change
				add_claim_on_loss = no
			}
			scope:countyfortheocracy = {
				change_title_holder = {
					holder = scope:template_priest
					change = scope:title_change
				}
			}
			resolve_title_and_vassal_change = scope:title_change
			scope:template_priest = {
				add_realm_law = bishop_theocratic_succession_law
				change_government = theocracy_government
			}
		}
		add_piety = 300
		rot_get_pope_of_target = {
			TARGET = root
		}
		scope:pope_of_target = {
			add_opinion = {
				target = root
				modifier = grantedlandtoclergy
				opinion = 10
			}
		}
		add_character_modifier = {
			modifier = donatedlandtoclergy
			years = 5
		}
	}
	option = { 
		name = KoH_religiousflavour.500.k
		trigger_event = KoH_religiousflavour.500
	}

	option = { 
		name = KoH_religiousflavour.500.m
		
	}
}


#Election of Pope Gregory VII
KoH_religiousflavour.600 = {
	title = KoH_religiousflavour.600.t
	desc = KoH_religiousflavour.600.desc
	theme = faith
	right_portrait = {
		character = title:k_papal_state.holder
		animation = personality_honorable
		triggered_outfit = {
			trigger = { exists = global_var:cfp_is_loaded }
			outfit_tags = { cardinal_outfit }
		}
		triggered_outfit = {
			trigger = { NOT = { exists = global_var:cfp_is_loaded } }
			outfit_tags = { bishop_outfit }
		}
		hide_info = yes
	}

	widgets = {
		widget = {
			gui = "event_window_widget_event_chain_progress"
			container = "custom_widgets_container"
			controller = event_chain_progress
		}
	}
	
	trigger = {
		exists = character:2010
		character:2010 = {
			is_alive = yes
		}
	}

	immediate = {
		# Widget setup.
		## Set the total length of the chain.
		save_scope_value_as = {
			name = event_chain_length
			value = 3
		}
		## Manually set the current widget length.
		### Due to code-side shenanigans, we do this a bit awkwardly.
		save_scope_value_as = {
			name = event_chain_progress
			value = 2
		}
	}

	option = {
		name = KoH_religiousflavour.600.a
		trigger_event = KoH_religiousflavour.401
		hidden_effect = {
			if = {
				limit = {
					exists = character:2010
					this = character:2010
				}
				change_first_name = Gregorius
			}
		}
	}
}

#Non_events

KoH_religiousflavour.799 = { 
	title = KoH_religiousflavour.799.t
	desc = KoH_religiousflavour.799.desc
	theme = learning_scholarship_focus
	left_portrait = {
		character = scope:cardinal
	}
	right_portrait = {
		character = scope:popeman
	}

	immediate = {
		faith = {
			religious_head = {
				save_scope_as = popeman
			}
		}
		random_living_cardinal = {
			save_scope_as = cardinal
		}
	}

	option = { 
		name = KoH_religiousflavour.799.a
		dictatuspapae = yes

		every_ruler = {
			limit = {
				has_faith = faith:catholic
				primary_title.tier >= tier_county
				NOT = { this = faith.religious_head }
			}
			trigger_event = {
				id = KoH_religiousflavour.800
				days = {5 15}
			}
		}

		ai_chance = {	
			base = 100
		}
	}
}

KoH_religiousflavour.800 = { 
	title = KoH_religiousflavour.800.t
	desc = KoH_religiousflavour.800.desc
	theme = learning_scholarship_focus
	left_portrait = {
		character = scope:popewantsit
	}
	right_portrait = {
		character = scope:popeman
	}

	immediate = {
		faith = {
			religious_head = {
				save_scope_as = popeman
			}
		}
		play_music_cue = Trinity_1
	}

	option = { 
		name = KoH_religiousflavour.800.a

		ai_chance = {	
			base = 100
		}
	}
}

KoH_religiousflavour.802 = {
	hidden = yes

	immediate = {
		every_in_global_list = {
			variable = rulersthathaveinvestiture
			add_realm_law_skip_effects = free_investiture_late
		}
	}
}

KoH_religiousflavour.801 = {
	hidden = yes

	immediate = {
		update_cardinal_window = yes
	}
}

#
#Launching a Crusade

KoH_religiousflavour.803 = {
	title = KoH_religiousflavour.803.t
	desc = KoH_religiousflavour.803.desc
	theme = learning_scholarship_focus
	left_portrait = {
		character = scope:pope
	}

	immediate = {
		faith.religious_head = {
			save_scope_as = pope
			add_character_modifier = {
				modifier = public_opinion_positive
				days = 10
			}
		}
		title:k_orthodox.holder = {
			save_scope_as = eastern_patriarch
		}
		play_music_cue = Trinity_3
	}

	option = {
		name = KoH_religiousflavour.803.a
		
	}
}

KoH_religiousflavour.805 = {
	hidden = yes

	trigger = {
		OR = {
			has_trait = cardinal_archbishop
			has_trait = cardinal_bishop
			has_trait = cardinal_priest
		}
	}

	immediate = {
		if = {
			limit = {
				has_trait = cardinal_archbishop
				highest_held_title_tier < tier_duchy
				is_landed = yes
			}
			remove_trait = cardinal_archbishop
			add_trait = cardinal_bishop
		}
		if = {
			limit = {
				has_trait = cardinal_bishop
				is_landed = no
			}
			remove_trait = cardinal_bishop
			add_trait = cardinal_priest
		}
	}

	option = {
		name = KoH_religiousflavour.803.a
		
	}
}

KoH_religiousflavour.806 = {
	hidden = yes

	trigger = {
		OR = {
			has_trait = cardinal_archbishop
			has_trait = cardinal_bishop
			has_trait = cardinal_priest
		}
	}

	immediate = {
		if = {
			limit = {
				has_trait = cardinal_bishop
				highest_held_title_tier >= tier_duchy
			}
			remove_trait = cardinal_bishop
			add_trait = cardinal_archbishop
		}
		if = {
			limit = {
				has_trait = cardinal_priest
				is_landed = yes
			}
			remove_trait = cardinal_priest
			add_trait = cardinal_bishop
		}
	}
}


KoH_religiousflavour.807 = {
	hidden = yes

	immediate = {
		if = {
			limit = {
				faith = {
					has_doctrine = doctrine_independent_papacy_head
					religion_tag = christianity_religion
				}	
				NOT = {
					faith.religious_head = {
						has_title = title:k_papal_state
					}
				}
			}
			faith = {
				remove_doctrine = doctrine_independent_papacy_head
				add_doctrine = doctrine_spiritual_head
			}
			trigger_event = faith_creation.0002
		}
	}
}